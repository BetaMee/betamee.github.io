<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.4 'Cabin Condensed','georgia',sans-serif;box-sizing:border-box;overflow-y:scroll;-webkit-font-smoothing:antialiased;letter-spacing:.05em;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.87);font-family:'Cabin Condensed','georgia',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";letter-spacing:.03em;}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:48px;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.8rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.5rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;color:inherit;font-family:'Patua One',sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}ul{margin-left:1.4rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.4rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;list-style-position:outside;list-style-image:none;line-height:1.6rem;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;line-height:1.6rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.4rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;font-size:1rem;line-height:1.4rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}blockquote{margin-left:-1.4rem;margin-right:1.4rem;margin-top:0;padding-bottom:10px;padding-left:1.1375rem;padding-right:0;padding-top:10px;margin-bottom:1.4rem;font-size:1rem;line-height:1.6rem;color:hsla(0,0%,0%,0.6);border-left:0.2625rem solid #cbcbcb;background-color:#f8f8f8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.4rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.4rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.4rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.4rem;margin-bottom:calc(1.4rem / 2);margin-top:calc(1.4rem / 2);}li > ul{margin-left:1.4rem;margin-bottom:calc(1.4rem / 2);margin-top:calc(1.4rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.4rem / 2);}code{font-size:0.85rem;line-height:1.4rem;}kbd{font-size:0.85rem;line-height:1.4rem;}samp{font-size:0.85rem;line-height:1.4rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.93333rem;padding-right:0.93333rem;padding-top:0.7rem;padding-bottom:calc(0.7rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}a{color:#358ccb;}a:hover{color:#3498DB;}@media only screen and (max-width:480px){blockquote{margin-left:-1.05rem;padding-left:0.7875rem;margin-right:0;}}</style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><meta name="generator" content="Gatsby 2.15.16"/><title data-react-helmet="true">十二棵橡树</title><link data-react-helmet="true" rel="icon" type="image/png" href="/static/favicon-9bf81a2b82f5028f3f4b92f88cb575ba.ico" sizes="16x16"/><style data-href="/commons.e89828e853cfecff4e83.css">body{margin:0;width:100%}*{box-sizing:border-box}center{margin:20px 0;font-weight:700;color:#333}table tr td strong{min-width:50px}h1 .anchor svg,h2 .anchor svg,h3 .anchor svg,h4 .anchor svg,h5 .anchor svg,h6 .anchor svg{visibility:unset!important}pre[class*=language-]:after,pre[class*=language-]:before{box-shadow:unset!important}p>code{color:#c92c2c;background-color:#fff5f5!important}.gatsby-resp-image-wrapper{cursor:pointer}.gatsby-resp-image-background-image,.gatsby-resp-image-image{border-radius:.3em}.gatsby-highlight{margin-bottom:1.4rem}code[class*=language-],pre[class*=language-]{color:#000;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{position:relative;margin:.5em 0;overflow:visible;padding:0}pre[class*=language-]>code{position:relative;border-left:10px solid #358ccb;box-shadow:-1px 0 0 0 #358ccb,0 0 0 1px #dfdfdf;background-color:#fdfdfd;background-image:-webkit-gradient(linear,left top,left bottom,color-stop(50%,transparent),color-stop(50%,rgba(69,142,209,.04)));background-image:linear-gradient(transparent 50%,rgba(69,142,209,.04) 0);background-size:3em 3em;background-origin:content-box;background-attachment:local}code[class*=language]{max-height:inherit;height:inherit;padding:0 1em;display:block;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdfdfd;box-sizing:border-box;margin-bottom:1em}:not(pre)>code[class*=language-]{position:relative;padding:.2em;border-radius:.3em;color:#c92c2c;border:1px solid rgba(0,0,0,.1);display:inline;white-space:normal}pre[class*=language-]:after,pre[class*=language-]:before{content:"";z-index:-2;display:block;position:absolute;bottom:.75em;left:.18em;width:40%;height:20%;max-height:13em;box-shadow:0 13px 8px #979797;-webkit-transform:rotate(-2deg);transform:rotate(-2deg)}:not(pre)>code[class*=language-]:after,pre[class*=language-]:after{right:.75em;left:auto;-webkit-transform:rotate(2deg);transform:rotate(2deg)}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#7d8b99}.token.punctuation{color:#5f6364}.token.boolean,.token.constant,.token.deleted,.token.function-name,.token.number,.token.property,.token.symbol,.token.tag{color:#c92c2c}.token.attr-name,.token.builtin,.token.char,.token.function,.token.inserted,.token.selector,.token.string{color:#2f9c0a}.token.entity,.token.operator,.token.url,.token.variable{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.class-name,.token.keyword{color:#1990b8}.token.important,.token.regex{color:#e90}.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.important{font-weight:400}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.namespace{opacity:.7}@media screen and (max-width:767px){pre[class*=language-]:after,pre[class*=language-]:before{bottom:14px;box-shadow:none}}.token.cr:before,.token.lf:before,.token.tab:not(:empty):before{color:#e0d7d1}pre[class*=language-].line-numbers.line-numbers{padding-left:0}pre[class*=language-].line-numbers.line-numbers code{padding-left:3.8em}pre[class*=language-].line-numbers.line-numbers .line-numbers-rows{left:0}pre[class*=language-][data-line]{padding-top:0;padding-bottom:0;padding-left:0}pre[data-line] code{position:relative;padding-left:4em}pre .line-highlight{margin-top:0}.layout-module--header--1orMk{padding:0 20%;background-color:#693476;height:80px;display:flex;flex-direction:row;justify-content:space-between;align-items:center;box-shadow:0 0 8px 2px rgba(0,0,0,.2)}.layout-module--title--28C2S{font-size:24px;color:#e1d0e6}.layout-module--menu--Ech1f{font-size:20px}.layout-module--menu--Ech1f a{text-decoration:none;color:#e1d0e6;padding:0 5px}.layout-module--menu--Ech1f a:hover{color:#fff}.layout-module--footer--1-u4U{height:200px;padding:0 20%;border-bottom:10px solid #693476;background-color:#fafafa;display:flex;flex-direction:column;justify-content:center}.layout-module--contact--1Z-dZ a{margin-right:6px;font-size:20px;color:#cf91e2}.layout-module--contact--1Z-dZ{margin-bottom:16px}.layout-module--siteInfo--WbGrj{font-size:20px}@media screen and (max-width:376px){.layout-module--header--1orMk{height:unset;padding:unset;background-color:unset;flex-direction:column}.layout-module--header--1orMk .layout-module--title--28C2S{padding:20px 10px;width:100%;display:flex;justify-content:center;color:#693476}.layout-module--header--1orMk .layout-module--menu--Ech1f{padding:20px 10px;width:100%;background-color:#693476;display:flex;justify-content:center}.layout-module--footer--1-u4U{padding:0 5%}}</style><link href="//fonts.googleapis.com/css?family=Patua+One:400|Cabin+Condensed:400,700" rel="stylesheet" type="text/css"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><style data-href="/styles.0a7157188c5a4343fc29.css">.list-module--main--_HL7O{margin:0 20%}.list-module--catalog--ToZZ4{min-height:400px;display:flex;flex-direction:column;margin:30px 0 10px}.list-module--catalog--ToZZ4 .list-module--item--2P8EQ{margin-top:10px}.list-module--catalog--ToZZ4 .list-module--year--fuRyw{font-size:46px}.list-module--catalog--ToZZ4 .list-module--link--1G28D{display:flex;flex-direction:column}.list-module--catalog--ToZZ4 .list-module--link--1G28D a{font-size:20px;color:#333;display:inline-block;margin-bottom:10px;text-decoration:none;border-bottom:1px solid #ddd}.list-module--catalog--ToZZ4 .list-module--date--1rprK{margin-right:10px;color:#999;font-style:italic}.list-module--catalog--ToZZ4 .list-module--newcontent--2jgkA{padding:1px 5px;background-color:#693476;border-radius:4px;color:#fff;margin-left:10px;font-size:20px}.list-module--pagination--4wgvY{margin:30px 0 60px}.list-module--paginationItem--127RG{color:#333;width:35px;height:35px;display:inline-block;text-align:center;line-height:35px;font-size:18px;margin-right:10px}.list-module--itemSelected--3HOvN{background-color:#cf91e2}@media screen and (max-width:376px){.list-module--main--_HL7O{margin:0 5%}}.viewer-module--viewer--3ba3_{position:fixed;top:0;left:0;z-index:100;width:100vw;height:100vh;background-color:rgba(0,0,0,.6);display:flex;flex-direction:column;justify-content:center;align-items:center}.viewer-module--viewer--3ba3_ .viewer-module--container--9MBxc{width:70%;height:80%;position:relative}.viewer-module--viewer--3ba3_ .viewer-module--container--9MBxc .viewer-module--img--9w_7t{border-radius:4px;box-shadow:inset 0 0 0 400px #fff;-o-object-fit:contain;object-fit:contain;height:100%;width:100%}.viewer-module--viewer--3ba3_ .viewer-module--container--9MBxc .viewer-module--des--3lo9I{color:#fff;text-align:center;font-size:20px;font-weight:700}.viewer-module--viewer--3ba3_ .viewer-module--container--9MBxc .viewer-module--icon--1vJ-_{cursor:pointer;margin:5px;position:absolute;top:0;right:0;width:30px;height:30px}.blog-module--content--R6Wfi{margin:60px 20% 80px}.blog-module--heading--2q6UV{margin-bottom:30px}.blog-module--title--3NoN5{font-weight:700;margin-bottom:15px}.blog-module--info--U7riw{color:#666;margin-bottom:5px}.blog-module--info--U7riw span{margin-right:5px}.blog-module--tags--20J6V a{color:#666;margin-right:5px}@media screen and (max-width:420px){.blog-module--content--R6Wfi{margin:60px 5% 80px;padding-left:10px}}.tag-module--content--1DHrR{margin:60px 20% 80px;min-height:400px}.tag-module--heading--15Jbn{margin-bottom:40px}.tag-module--link--3DsMn a{font-size:20px;color:#333;display:inline-block;margin-bottom:10px;text-decoration:none;border-bottom:1px solid #ddd}@media screen and (max-width:376px){.tag-module--content--1DHrR{margin:60px 5% 80px;min-height:400px}}._404-module--container--2kCC_{min-height:400px;margin:60px auto 80px;display:flex;flex-direction:column;justify-content:center;align-items:center}._404-module--container--2kCC_ span{font-size:40px;font-weight:700}.about-module--content--1y3Xq{margin:60px 20% 80px;min-height:400px}@media screen and (max-width:420px){.about-module--content--1y3Xq{margin:30px 5%;padding-left:10px}}</style><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link as="script" rel="preload" href="/component---src-templates-blog-template-tsx-a2d7125bc98516a07fae.js"/><link as="script" rel="preload" href="/styles-607a73e244ee0b08b1e5.js"/><link as="script" rel="preload" href="/commons-fdd99c7d38d0b81fffeb.js"/><link as="script" rel="preload" href="/app-aeaacb0f871062c77e7c.js"/><link as="script" rel="preload" href="/webpack-runtime-2e5e8a041a29d1b31b0e.js"/><link as="fetch" rel="preload" href="/page-data/content/React-React 状态管理使用指南/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="layout-module--layout--2CAqk"><div class="layout-module--header--1orMk"><div class="layout-module--title--28C2S">十二棵橡树</div><div class="layout-module--menu--Ech1f"><a href="/">主页</a><a title="I Love You a Thousands Times" href="/about">WHO AM I?</a></div></div><div class="blog-module--content--R6Wfi"><div class="blog-module--heading--2q6UV"><h1 class="blog-module--title--3NoN5">React 状态管理使用指南</h1><div class="blog-module--info--U7riw"><span>橡树上</span><span>2019-08-11</span></div><div class="blog-module--tags--20J6V"><a href="/tag/React_Usage">#<!-- -->React_Usage</a></div></div><div><h2 id="目录"><a href="#%E7%9B%AE%E5%BD%95" aria-label="目录 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录</h2>
<!-- toc -->
<ul>
<li><a href="#1-%E5%BC%95%E8%A8%80">1. 引言</a></li>
<li><a href="#2-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B9%8B-redux-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">2. 状态管理之 Redux 解决方案</a></li>
<li><a href="#3-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B9%8B-mobx-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">3. 状态管理之 MobX 解决方案</a></li>
<li><a href="#4-%E8%BF%99%E4%B8%AA-example-%E9%95%BF%E5%95%A5%E6%A0%B7">4. 这个 example 长啥样</a></li>
<li><a href="#5-Classic-React-App-with-Redux">5. Classic React App with Redux</a></li>
<li><a href="#6-Classic-React-App-with-Mobx">6. Classic React App with Mobx</a></li>
<li><a href="#7-React-Hooks-App-with-Redux">7. React Hooks App with Redux</a></li>
<li><a href="#8-React-Hooks-App-with-Mobx">8. React Hooks App with Mobx</a></li>
<li><a href="#9-%E6%80%BB%E7%BB%93">9. 总结</a></li>
<li>
<p><a href="#%E5%8F%82%E8%80%83">参考</a></p>
<!-- tocstop -->
</li>
</ul>
<h2 id="1-引言"><a href="#1-%E5%BC%95%E8%A8%80" aria-label="1 引言 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 引言</h2>
<p>在日趋复杂的 Web 应用中，状态管理一直是一个很重要的话题。React 技术栈中也衍生出了不少解决方案，如 Redux、Mobx，并且随着 React Hooks 的发布，带来全新的代码编写模式，在状态管理库的使用上也出现了很多新变化。</p>
<p>为了指明 React 状态管理，我写了几个 examples，并比较一下其中的使用差异。</p>
<p>开发同一个 Todo App，但使用方式分为以下四种：</p>
<ul>
<li>使用类模式的 React + Redux</li>
<li>使用类模式的 React + Mobx</li>
<li>使用 Hooks 模式的 React + Redux</li>
<li>使用 Hooks 模式的 React + Mobx</li>
</ul>
<p>全部代码发布在 Github 的这个仓库 <a href="https://github.com/BetaMee/react-usage-examples">GitHub - BetaMee/react-usage-examples: React Usage Examples</a> 上，可供参考。</p>
<h2 id="2-状态管理之-redux-解决方案"><a href="#2-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B9%8B-redux-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-label="2 状态管理之 redux 解决方案 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 状态管理之 Redux 解决方案</h2>
<p>Redux 是很火的一个技术解决方案，甫一推出就备受关注。Redux 由 <a href="http://facebook.github.io/flux/">Flux</a> 演变而来，但受 Elm 的启发，避开了 Flux 的复杂性。它提供了一套简单但有效的 API，提供可预测化的状态管理。但在学习难度上非常陡峭，因为它带来新的概念和约定，只有理解通了，才可以更好的应用它。</p>
<p>要理解 Redux，可以分为以下几个点：</p>
<blockquote>
<ol>
<li>所有的 state 都以一个对象树的形式存储在一个单一的 store 中</li>
<li>UI 是这个 state 树某一时刻状态的映射</li>
<li>改变 state 树的唯一方式是触发一个 action，一个描述发生什么的对象</li>
<li>至于对 state 树的具体改变操作，是由叫 reducers 的纯函数来实现</li>
<li>更新后的 state 树又映射为新的 UI</li>
</ol>
</blockquote>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 105.51470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB93GpHRFWBQf/xAAbEAEAAgIDAAAAAAAAAAAAAAABERIAAhAhMf/aAAgBAQABBQKe5qZUtuCHmRx//8QAFhEAAwAAAAAAAAAAAAAAAAAAASAx/9oACAEDAQE/ARU//8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQIBAT8BY//EABwQAAEDBQAAAAAAAAAAAAAAABAAASIREiExQf/aAAgBAQAGPwKik4u6paOR/8QAHhABAAICAQUAAAAAAAAAAAAAAQARECExQVFhcYH/2gAIAQEAAT8hTzlw2xfMNlzpntKbSAADjG3d8x//2gAMAwEAAgADAAAAEG/IPP/EABcRAQADAAAAAAAAAAAAAAAAAAEAEBH/2gAIAQMBAT8QAjY3/8QAGBEAAgMAAAAAAAAAAAAAAAAAARARITH/2gAIAQIBAT8QKBS1f//EABsQAQEBAQEAAwAAAAAAAAAAAAERACFREDFB/9oACAEBAAE/EDQ57L01QZf19ZABolE1OXmYzHp5NIiACefFCIPmBCG//9k='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Redux Flow"
        title="Redux Flow"
        src="/static/32d1d59087ce53b4542d2189b76a3876/971c4/redux-flow.jpg"
        srcset="/static/32d1d59087ce53b4542d2189b76a3876/9fb78/redux-flow.jpg 250w,
/static/32d1d59087ce53b4542d2189b76a3876/48a11/redux-flow.jpg 500w,
/static/32d1d59087ce53b4542d2189b76a3876/971c4/redux-flow.jpg 1000w,
/static/32d1d59087ce53b4542d2189b76a3876/a15de/redux-flow.jpg 1088w"
        sizes="(max-width: 1000px) 100vw, 1000px"
        loading="lazy"
      />
    </span></p>
<center>图 2.1 Redux Flow</center>
<p>由上可以总结为<strong>Redux 三大原则：</strong></p>
<blockquote>
<ul>
<li>单一数据源</li>
<li>state 是只读的</li>
<li>使用纯函数来执行修改</li>
</ul>
</blockquote>
<p>理通上述概念基本上可以入门 Redux 了。但只有上述概念无法解决 Web 应用更复杂的场景，如异步加载数据更新界面。</p>
<p>这就需要涉及到 Redux 中的<strong>中间件</strong>概念。</p>
<p>使用中间件，我们可以在 state 变化的时候对数据进行<em>监控、截获、更改</em>，还可以拓展异步操作。这就给了我们很大的自由，充分发挥 Redux 的潜力。</p>
<p>Redux 的中间件实质上是一个函数，是对<code>store.dispatch</code>方法进行了改造，在发出 Action 和执行 Reducer 这两步之间，添加了特定功能。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 105.51470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB93Gsx1RVgUH/xAAbEAEAAgIDAAAAAAAAAAAAAAABERIAAhAhMf/aAAgBAQABBQKe5qZUtuCHmRx//8QAFhEAAwAAAAAAAAAAAAAAAAAAASAx/9oACAEDAQE/ARU//8QAFREBAQAAAAAAAAAAAAAAAAAAASD/2gAIAQIBAT8BY//EABsQAAEEAwAAAAAAAAAAAAAAABAAESEiARIx/9oACAEBAAY/AmVsjZpVuGR//8QAHRABAAICAgMAAAAAAAAAAAAAAQARECExUWGBsf/aAAgBAQABPyFPOXC2i+YbLn1iU2kAAHGNu3rH/9oADAMBAAIAAwAAABBfyDz/xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAEDAQE/EAI2N//EABgRAAIDAAAAAAAAAAAAAAAAAAEQESEx/9oACAECAQE/ECgUtX//xAAaEAEBAQADAQAAAAAAAAAAAAABEQAhMVFB/9oACAEBAAE/EDQ49l5NEMv11kAGiUTPYWZkC8nk0iIAJ5nUIg+YEIb/2Q=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="redux-flow-middleware"
        title="redux-flow-middleware"
        src="/static/0caa678bb06618e7568a58a23317d788/971c4/redux-flow-middleware.jpg"
        srcset="/static/0caa678bb06618e7568a58a23317d788/9fb78/redux-flow-middleware.jpg 250w,
/static/0caa678bb06618e7568a58a23317d788/48a11/redux-flow-middleware.jpg 500w,
/static/0caa678bb06618e7568a58a23317d788/971c4/redux-flow-middleware.jpg 1000w,
/static/0caa678bb06618e7568a58a23317d788/a15de/redux-flow-middleware.jpg 1088w"
        sizes="(max-width: 1000px) 100vw, 1000px"
        loading="lazy"
      />
    </span></p>
<center>图 2.2 Redux Flow Middleware</center>
<p>Redux 社区已经发展了很多成熟的中间件，如 redux-thunk、redux-soga，只需要按需使用即可。</p>
<p>具体可参考：<a href="https://redux.js.org/introduction/ecosystem#middleware">redux#ecosystem#middleware</a> 和 中文版本的 <a href="http://cn.redux.js.org/docs/introduction/Ecosystem.html">cnredux#ecosystem</a></p>
<h2 id="3-状态管理之-mobx-解决方案"><a href="#3-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B9%8B-mobx-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-label="3 状态管理之 mobx 解决方案 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 状态管理之 MobX 解决方案</h2>
<p>与 Redux 相似的，前端出现的另一个状态管理方案是 MobX。</p>
<p>MobX 的官网是这样介绍的：</p>
<blockquote>
<p>MobX 是一个经过战火洗礼的库，它通过透明的函数响应式编程 (transparently applying functional reactive programming - TFRP) 使得状态管理变得简单和可扩展。MobX背后的哲学很简单:
<em>任何源自应用状态的东西都应该自动地获得。</em>
其中包括UI、数据序列化、服务器通讯，等等。</p>
</blockquote>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;"
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.32835820895522%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABf0lEQVQoz1WQz4vTQBTH86968u7fIKLgwYM3TwsilGU96EUXxfUg7HZRcME22xYhP5ofTTNpk6ZJJmk+vkmpsA+Gee/7vvOZN2PR5Xy+9nn82uHJGxf7b8KhSnk2uubRq0tenN/QNxV2eMvl7IKrxUe+zN4TZD6HTUBzN6L5dUYX/saEBS1je8vzdwtenjs4UQl9y9nXCU9HY95+mw5GR825ca/46f9g7H4nqzKod+jZJ/T0A916cQT2nKITUCrTbOFQS33qyN7KJRx4EMbT64eaeK2yLNnmOcswRinFvtyRbzcEQYDjOsSrWLSCNE1IkogwXJJla0rRlGirKCARzybLMCwrTVOiKOLPZMJsPme9TonjleSLQXM9T2BK4C6T6RT7/h7fX6IE4Hn+UbNtyb1hIKtpGnKZ0IDNXtf1sEytBFRVFVpriqIYLl7JKsRnNOM3ECVe0zcsy7y8bbuh0G1L3x//br/fD7BTbQDlbifPL/9rpl9VNVrOtvr4n/8AvcULBRTpm10AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="mobx-flow"
        title="mobx-flow"
        src="/static/7c7e6d63765099c40c9aabfebc23e712/e11df/mobx-flow.png"
        srcset="/static/7c7e6d63765099c40c9aabfebc23e712/5039d/mobx-flow.png 250w,
/static/7c7e6d63765099c40c9aabfebc23e712/d19c0/mobx-flow.png 500w,
/static/7c7e6d63765099c40c9aabfebc23e712/e11df/mobx-flow.png 1000w,
/static/7c7e6d63765099c40c9aabfebc23e712/a0105/mobx-flow.png 1407w"
        sizes="(max-width: 1000px) 100vw, 1000px"
        loading="lazy"
      />
    </span></p>
<center>图 3-1 MobX Flow</center>
<p>其实相比 Redux 的强规则约定，MobX 明显更简单灵活，MobX 的核心原理是<strong>通过 action  触发 state 的变化，进而触发 state 的衍生对象（Computed value &#x26; Reactions）</strong>。开发者只需要定义需要 Observe 的数据和由此衍生的数据（Computed value）或者操作 (Reactions），剩下的更新自然就交给 MobX 去做就可以了。</p>
<p>MobX 和 Redux 比较大概体现出这些差异：</p>
<blockquote>
<ol>
<li>Redux 是函数式而 MobX 是面向对象</li>
<li>Redux 的 state 每次返回新的数据，理想状态是 immutable 的，MobX 则至始至终保持一份引用</li>
<li>Redux 可支持数据回朔，MobX 由于只有一份引用，无法支持回朔</li>
<li>Redux 约定单一数据源，MobX 可以将 state 树拆分进多个 store 中</li>
<li>Redux 需要中间件处理异步，MobX 可以直接使用 async/await 来处理</li>
</ol>
</blockquote>
<p>总之，两者相比，MobX 确实比 Redux 上手更容易些，并且不需要写很多样板代码，但 Redux 的这种“复杂”不一定是无用的，强约定的规则可以为大型项目，复杂数据状态管理提供可靠的支持，而 MobX 在某些场景下确实可以比 Redux 项目提供更高效的选择。</p>
<p>但也不能简单地就将 Redux 复杂化，MobX 简单化，还是要看适合的场景。我们应该更关注它们解决什么问题，它们解决问题的关注点，或者说实现方式是什么，它们的优缺点还有什么，哪一个更适合当前项目，以及项目未来发展。</p>
<h2 id="4-这个-example-长啥样"><a href="#4-%E8%BF%99%E4%B8%AA-example-%E9%95%BF%E5%95%A5%E6%A0%B7" aria-label="4 这个 example 长啥样 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 这个 example 长啥样</h2>
<p>我们做的这个 Todo 只涉及到简单的增删功能：</p>
<p><img src="./attachments/todoapp.gif" alt="todoapp"></p>
<h2 id="5-classic-react-app-with-redux"><a href="#5-classic-react-app-with-redux" aria-label="5 classic react app with redux permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Classic React App with Redux</h2>
<p>接下来我将具体介绍四个 example 的用法，并从中学习<strong>项目的组织模式、代码的编写模式</strong>，看一看 React 的状态管理库的应用发展。</p>
<p>第一个是 Classic React App with Redux，是使用“传统”的类模式 + Redux 进行开发的。这个模式在 Redux 刚推出时就有了。</p>
<p>我们通过 create-react-app 脚手架来搭建我们的启动应用，这将会节省我们很多时间：</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">npx create-react-app classicreactwithredux --typescript</code></pre></div>
<p>这里使用的是 Typescript 模版，整个应用都将以 TS 来开发，所以这也是个学习 TS 的一个练手机会。</p>
<p>以下是整个应用的代码文件：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">├── README.md
├── package.json
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
├── src // 源码文件，所有的代码在这里
│   ├── App.css
│   ├── App.test.tsx
│   ├── App.tsx // App 入口
│   ├── components // UI 组件
│   │   ├── TodoAdd.tsx
│   │   ├── TodoCounter.tsx
│   │   ├── TodoView.tsx
│   │   ├── TodoViewList.tsx
│   │   ├── assets
│   │   │   ├── delete.svg
│   │   │   ├── select.svg
│   │   │   └── select2.svg
│   │   └── styles
│   │       ├── TodoAdd.css
│   │       ├── TodoCounter.css
│   │       ├── TodoView.css
│   │       └── TodoViewList.css
│   ├── containers // 容器组件
│   │   ├── TodoAddContainer.ts
│   │   ├── TodoCounterContainer.ts
│   │   └── TodoViewListContainer.ts
│   ├── index.css
│   ├── index.tsx // 整个应用的入口文件
│   ├── interfaces // 定义的 ts 接口文件
│   │   ├── component.ts
│   │   └── index.ts
│   ├── react-app-env.d.ts
│   ├── serviceWorker.ts
│   └── store // 这里放置 store 文件
│       ├── store.ts
│       └── todo // 按角色划分 state 树，一个文件夹一个角色
│           ├── actions.ts
│           ├── index.ts
│           ├── reducers.ts
│           └── types.ts
├── tsconfig.json
└── yarn.lock</code></pre></div>
<p><code>index.tsx</code> 作为入口文件，承担着全局初始化工作的任务，可以将初始化 store 、render app 等任务放在这里。</p>
<p>我们通过 <code>react-redux</code> 提供的 <code>Provider</code> 包裹 <code>App</code> 组件，将 store 数据注入全局应用，下面的组件可以通过一定方式获取 redux 的数据。后续我会介绍如何在 container 组件中使用。</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> configureStore <span class="token keyword">from</span> <span class="token string">'./store/store'</span>
<span class="token comment">// 初始化 redux store</span>
<span class="token keyword">const</span> AppStore <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>AppStore<span class="token punctuation">}</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

serviceWorker<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>在 <code>configureStore</code> 函数中，执行的是组合 root state、加载中间件任务，所有对 redux 的配置基本上都在这里：</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  createStore<span class="token punctuation">,</span>
  combineReducers
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> todoReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./todo/'</span><span class="token punctuation">;</span>

<span class="token comment">// 根 rootReducer</span>
<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todoReducer<span class="token punctuation">:</span> todoReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 导出store 类型</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> AppState <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> rootReducer<span class="token operator">></span>

<span class="token keyword">const</span> <span class="token function-variable function">configureStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 组合中间件，这个例子没有用到</span>
  <span class="token comment">// const middlewares = [thunkMiddleware];</span>
  <span class="token comment">// const middleWareEnhancer = applyMiddleware(...middlewares);</span>
  <span class="token comment">// 创建 store</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> store<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> configureStore

<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./todo'</span></code></pre></div>
<p>这里我们对 Redux 的 state 按<strong>角色</strong>划分，如这里的状态数据 todo，我们在 todo 的文件夹下配置 <code>action</code>、<code>reducers</code> 项，然后统一导出：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">│       └── todo // 按角色划分 state 树，一个文件夹一个角色
│           ├── actions.ts
│           ├── index.ts
│           ├── reducers.ts
│           └── types.ts</code></pre></div>
<p>这个的好处就是依赖清晰，后续扩展很方便，比如再增加一个新的状态数据，只需要新增文件夹，把这个“<strong>角色</strong>”的逻辑写清楚就可以了。</p>
<p>当然，Redux 不只是可以按照角色划分，也可以按照<strong>功能</strong>划分，如所有的 <code>actions</code> 统一放到 action 文件夹下， <code>reducers</code> 放到 renduers 文件夹下:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">// 示例：按功能拆分文件夹
│       └── actions
│           ├── index.ts
│       └── renduers
│           ├── index.ts
│       └── types
│           ├── index.ts</code></pre></div>
<p>接下来，我们看一下 todo 文件下，是如何编写 Reducer 和 Action 逻辑的：</p>
<p><strong>reducers.ts:</strong></p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  TodoReducerType<span class="token punctuation">,</span>
  TodoActionType
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token constant">ADD_TODO</span><span class="token punctuation">,</span>
  <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
  <span class="token constant">SELECT_TODO</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span>

<span class="token comment">// 初始化状态</span>
<span class="token keyword">const</span> initalState<span class="token punctuation">:</span> TodoReducerType <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> todoReducer <span class="token operator">=</span> <span class="token punctuation">(</span>state <span class="token operator">=</span> initalState<span class="token punctuation">,</span> action<span class="token punctuation">:</span> TodoActionType<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TodoReducerType</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">ADD_TODO</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token punctuation">:</span> action<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        finished<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>

    <span class="token keyword">case</span> <span class="token constant">REMOVE_TODO</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

    <span class="token keyword">case</span> <span class="token constant">SELECT_TODO</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>todo<span class="token punctuation">,</span>
            finished<span class="token punctuation">:</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>finished
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> todo
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>actions.ts:</strong></p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token constant">ADD_TODO</span><span class="token punctuation">,</span>
  <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
  <span class="token constant">SELECT_TODO</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  TodoActionType
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./types'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TodoActionType</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">ADD_TODO</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> name
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> removeTodo <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TodoActionType</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> id
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> selectTodo <span class="token operator">=</span> <span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">TodoActionType</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">SELECT_TODO</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> id
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>这两个文件决定了每个角色 state 以下两个关键点，这是使用 Redux 的精髓：</p>
<blockquote>
<ol>
<li>action 纯函数：描述如何改变状态（是什么）</li>
<li>reducer 纯函数：描述具体改变状态的逻辑（怎么做）</li>
</ol>
</blockquote>
<p>其中 <code>actions.ts</code> 中的函数是我们需要导入到 UI 组件中去的，才能发挥作用。</p>
<p>那么我们是如何将 <code>actions</code>（操作） 和 <code>state</code>（状态）具体导入到组件中去呢？</p>
<p>这就是 container 文件夹下的 container 组件需要回答的问题:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">│   ├── containers // 容器组件
│   │   ├── TodoAddContainer.ts
│   │   ├── TodoCounterContainer.ts
│   │   └── TodoViewListContainer.ts</code></pre></div>
<p>其实不要被 Redux 中所谓的<strong>容器组件</strong>、<strong>UI 组件</strong>概念迷惑，这其实就是一个连接 Redux 和 React 组件的中间步骤而已。</p>
<p>这里以 <code>TodoViewListContainer.ts</code> 为例：</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Dispatch
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">import</span> TodoViewList <span class="token keyword">from</span> <span class="token string">'../components/TodoViewList'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  AppState<span class="token punctuation">,</span>
  TodoActionType<span class="token punctuation">,</span>

  removeTodo<span class="token punctuation">,</span>
  selectTodo
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/store'</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">:</span> AppState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> state<span class="token punctuation">.</span>todoReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">:</span> Dispatch<span class="token operator">&lt;</span>TodoActionType<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">removeTodoById</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">removeTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">selectTodoById</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">selectTodo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoViewList<span class="token punctuation">)</span></code></pre></div>
<p>其中，<code>TodoViewList</code> 是具体的 React 组件，<code>mapStateToProps</code>、<code>mapDispatchToProps</code> 如其名字所示，是将 action 和 state 作为 React 的 <code>props</code> 往下导入。</p>
<p>然后在 <code>TodoViewList</code> 组件中，我们这样使用：</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> TodoView <span class="token keyword">from</span> <span class="token string">'./TodoView'</span>
<span class="token keyword">import</span> <span class="token string">'./styles/TodoViewList.css'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  IViewListProp
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../interfaces'</span>

<span class="token keyword">const</span> TodoViewList<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IViewListProp</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = ({
  todos,
  selectTodoById,
  removeTodoById
}) => (
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewlist<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoView</span></span>
        <span class="token attr-name">todo</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
        <span class="token attr-name">selectTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>selectTodoById<span class="token punctuation">}</span></span>
        <span class="token attr-name">removeTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>removeTodoById<span class="token punctuation">}</span></span>
        <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
)

export default TodoViewList</span></code></pre></div>
<p>这就是 React 和 Redux 的结合使用，到这一步基本完成所有的工作了，后续只要 state 有变化，组件就会发生更新，而<strong>要使 state 发生变化，唯一的途径是传入的 action 函数</strong>。这样，整个应用依赖清晰，数据流变化清晰可调控，对于排查问题非常方便。</p>
<h2 id="6-classic-react-app-with-mobx"><a href="#6-classic-react-app-with-mobx" aria-label="6 classic react app with mobx permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. Classic React App with Mobx</h2>
<p>接下来我们看看使用类模式 + MobX 架构的 Todo 应用。</p>
<p>先整体看一下这里的文件结构：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">├── README.md
├── package.json
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
├── src // 源码
│   ├── App.css
│   ├── App.test.tsx
│   ├── App.tsx
│   ├── components // UI 组件
│   │   ├── TodoAdd.tsx
│   │   ├── TodoCounter.tsx
│   │   ├── TodoView.tsx
│   │   ├── TodoViewList.tsx
│   │   ├── assets
│   │   │   ├── delete.svg
│   │   │   ├── select.svg
│   │   │   └── select2.svg
│   │   └── styles
│   │       ├── TodoAdd.css
│   │       ├── TodoCounter.css
│   │       ├── TodoView.css
│   │       └── TodoViewList.css
│   ├── index.css
│   ├── index.tsx // 入口
│   ├── interfaces // 定义的 ts 接口
│   │   ├── base.ts
│   │   └── index.ts
│   ├── react-app-env.d.ts
│   ├── serviceWorker.ts
│   └── store // 存放 mobx store
│       ├── TodoListStore.ts
│       └── index.ts
├── tsconfig.json
└── yarn.lock</code></pre></div>
<p>和 Redux 的最大区别在于，Redux 是面向函数式的思维，而 MobX 是<strong>面向对象</strong>的思维。我们来看一下在 MobX 中是如何定义 store 的：</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  observable<span class="token punctuation">,</span>
  computed<span class="token punctuation">,</span>
  action
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ITodo
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../interfaces'</span>

<span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
  id <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  @observable name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  @observable finished <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TodoListStore</span> <span class="token punctuation">{</span>
  @observable todos<span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ITodo<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  @computed <span class="token keyword">get</span> <span class="token function">finishedTodoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>finished<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  @computed <span class="token keyword">get</span> <span class="token function">totalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
  @action
  <span class="token keyword">public</span> <span class="token function-variable function">finishTodoById</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        todo<span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>finished
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  @action
  <span class="token keyword">public</span> <span class="token function-variable function">addNewTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Todo</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  @action
  <span class="token keyword">public</span> <span class="token function-variable function">removeTodoById</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 找到某一项的位置</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoListStore</code></pre></div>
<p>我们定义一个类，里面封装<strong>状态 + 函数</strong>，给状态打上 <code>@observable</code> 装饰器，给函数打上 <code>@action</code> 装饰器。因为 MobX 在约束上很自由，只要触动 <code>@observable</code> 的数据就会发生更新，但这样的话就会发生滥用<strong>通过状态直接更新</strong>的操作，不容易追踪数据变化流程。比如在组件中随手的一个：<code>this.props.todos.push(...)</code>，这就会触发整个应用数据更新。</p>
<p>所以 MobX 推荐使用严格模式，我们只能通过被 <code>@action</code> 状态装饰过的函数来变更状态，这个和 Redux 中通过 action 函数来变更状态思路是一致，保证数据变化可追踪调控。</p>
<p>与 Redux 另一个不同点，是在 MobX 中我们直接可以编写<strong>计算过</strong>的 <code>@computed</code> 数据逻辑，在 Redux 中，我们只能通过获取的 state 手动计算，而在 MobX 中，通过 <code>@computed</code> 装饰的 <code>get</code> 函数可以一直获取最新的计算值。这也是 MobX 的理念：<strong>任何源自应用状态的东西都应该自动地获得</strong>。</p>
<p>由于 MobX 不像 Redux 约定单一数据源，所以我们要拓展状态也很简单，继续添加新的类，封装好需要 <code>@observable</code> 的状态、 <code>@computed</code> 的状态以及对应于数据更新的 <code>@action</code> 函数。</p>
<p>在组件接入 MobX 的过程也比 Redux 要简单很多。</p>
<p>首先是在入口组件中配置：</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  TodoListStore
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  Provider
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>

<span class="token comment">// 状态</span>
<span class="token keyword">const</span> rootStore <span class="token operator">=</span> <span class="token punctuation">{</span>
  todoListStore<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">TodoListStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 

<span class="token comment">// 通过 Provider/inject 来注入，react 16.8 + 可以使用 hooks + context 来注入</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">rootStore</span><span class="token punctuation">}</span></span> <span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>然后在需要使用 MobX 状态的组件中使用 <code>mobx-react</code> 包中的 <code>observer</code> 和 <code>inject</code> 高阶函数将数据注入：</p>
<p><strong>App.tsx:</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  observer<span class="token punctuation">,</span>
  inject
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>

<span class="token keyword">import</span> TodoAdd <span class="token keyword">from</span> <span class="token string">'./components/TodoAdd'</span>
<span class="token keyword">import</span> TodoViewList <span class="token keyword">from</span> <span class="token string">'./components/TodoViewList'</span>
<span class="token keyword">import</span> TodoCounter <span class="token keyword">from</span> <span class="token string">'./components/TodoCounter'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> IAppProp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./interfaces'</span>

<span class="token comment">// ! @inject 高阶方法注入会和 Typescript 有冲突，原因在于 TS 会检查外部调用传进来的 props 接口，</span>
<span class="token comment">// ! 但是 inject 相当于中间注入，避开了检查，这就导致 TS 报错。</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IAppProp</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = inject('todoListStore')(observer(({ todoListStore }) => </span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Classic React App ( mobx )</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoAdd</span></span>
        <span class="token attr-name">addNewTodo</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>addNewTodo<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoViewList</span></span>
        <span class="token attr-name">todos</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>todos<span class="token punctuation">}</span></span>
        <span class="token attr-name">finishTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>finishTodoById<span class="token punctuation">}</span></span>
        <span class="token attr-name">removeTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>removeTodoById<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoCounter</span></span>
        <span class="token attr-name">finishedCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>finishedTodoCount<span class="token punctuation">}</span></span>
        <span class="token attr-name">totalCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoListStore<span class="token operator">!</span><span class="token punctuation">.</span>totalCount<span class="token punctuation">}</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token plain-text">))

export default App;</span></code></pre></div>
<p><strong>TodoViewList.tsx:</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react'</span>

<span class="token keyword">import</span> TodoView <span class="token keyword">from</span> <span class="token string">'./TodoView'</span>
<span class="token keyword">import</span> <span class="token string">'./styles/TodoViewList.css'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  IViewListProp
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../interfaces'</span>

@observer
<span class="token keyword">class</span> <span class="token class-name">TodoViewList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>IViewListProp<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      removeTodoById<span class="token punctuation">,</span>
      finishTodoById<span class="token punctuation">,</span>
      todos
    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewlist<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoView</span></span>
            <span class="token attr-name">todo</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
            <span class="token attr-name">finishTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>finishTodoById<span class="token punctuation">}</span></span>
            <span class="token attr-name">removeTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>removeTodoById<span class="token punctuation">}</span></span>
            <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>
          <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoViewList</code></pre></div>
<p>这里相比 Redux 复杂的“容器组件”概念来说，简单很多，只要在需要 MobX 状态的组件中使用 <code>@observer</code> 装饰器就可以了。简单明了。</p>
<h2 id="7-react-hooks-app-with-redux"><a href="#7-react-hooks-app-with-redux" aria-label="7 react hooks app with redux permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7. React Hooks App with Redux</h2>
<p>React 16.8 的发布带来了全新的 Hooks API，给 React 生态圈带来很多新思路。这里我们看看如何结合 Hooks + Redux 编写一样的应用，和类模式 + Redux 相比有何优势。</p>
<p>应用结构：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">├── README.md
├── package.json
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
├── src // 源码
│   ├── App.css
│   ├── App.test.tsx
│   ├── App.tsx
│   ├── components
│   │   ├── TodoAdd.tsx
│   │   ├── TodoCounter.tsx
│   │   ├── TodoView.tsx
│   │   ├── TodoViewList.tsx
│   │   ├── assets
│   │   │   ├── delete.svg
│   │   │   ├── select.svg
│   │   │   └── select2.svg
│   │   └── styles
│   │       ├── TodoAdd.css
│   │       ├── TodoCounter.css
│   │       ├── TodoView.css
│   │       └── TodoViewList.css
│   ├── index.css
│   ├── index.tsx
│   ├── interfaces
│   │   ├── base.ts
│   │   └── index.ts
│   ├── react-app-env.d.ts
│   ├── serviceWorker.ts
│   └── store // redux store
│       ├── store.tsx
│       └── todo
│           ├── actions.ts
│           ├── index.ts
│           ├── reducers.ts
│           └── types.ts
├── tsconfig.json
└── yarn.lock</code></pre></div>
<p>我们发现一个很大的区别，和 Classic React App with Redux 相比这里没有了 container 文件夹了！也就是说我们不需要使用 container 接入 Redux 了。</p>
<p>是的，原因在于这里我们使用的是 Context API + Hooks API。</p>
<p>Context API 来替代原有的 <code>react-redux</code> 包中 <code>Provider</code> 组件来全局注入数据。<code>Provider</code> 组件本质上也是用的 React Context API，只是以前不怎么受官方推崇，React 16 出来后，Context API 才正式被认可，使用方式上也变得更简单了。而另一方面， Hooks 中直接内置了对 Redux 的支持，这样就不用安装额外的 Redux 包了。</p>
<p>事实上，这个应用只用到了 React 自身的特性，没有安装任何外部依赖库：</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@types/jest"</span><span class="token operator">:</span> <span class="token string">"24.0.15"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/node"</span><span class="token operator">:</span> <span class="token string">"12.6.8"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react"</span><span class="token operator">:</span> <span class="token string">"16.8.23"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react-dom"</span><span class="token operator">:</span> <span class="token string">"16.8.5"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"^16.8.6"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"^16.8.6"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"3.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"3.5.3"</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>Hooks 出现的意义在于可以共享业务逻辑，所以这个应用中最核心的文件在于 store 文件夹下的 <code>store.tsx</code>:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  TodoReducerType<span class="token punctuation">,</span>
  TodoActionType<span class="token punctuation">,</span>

  initalTodoState<span class="token punctuation">,</span>
  todoReducer
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./todo'</span>

<span class="token keyword">type</span> combineDispatchsType <span class="token operator">=</span> React<span class="token punctuation">.</span>Dispatch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoActionType</span></span><span class="token punctuation">></span></span><span class="token plain-text">

// 将所有的 dispatch 组合
const combineDispatchs = (dispatchs: Array</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>combineDispatchsType</span><span class="token punctuation">></span></span><span class="token plain-text">) => (obj: TodoActionType) => </span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  i <span class="token operator">&lt;</span> dispatchs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dispatchs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token plain-text">

// 根组件状态
const AppState = </span><span class="token punctuation">{</span>
  todoState<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> TodoReducerType<span class="token punctuation">,</span>
  dispatch<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> ReturnType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeof</span> <span class="token attr-name">combineDispatchs</span><span class="token punctuation">></span></span><span class="token plain-text">
}

// Context
export const ContextStore = React.createContext(AppState)

const HookContextProvider: React.FC = ({ children }) => </span><span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>todoState<span class="token punctuation">,</span> todoDispatch<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span>
    todoReducer<span class="token punctuation">,</span>
    initalTodoState
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ContextStore.Provider</span></span>
      <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        todoState<span class="token punctuation">,</span>
        dispatch<span class="token punctuation">:</span> <span class="token function">combineDispatchs</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          todoDispatch
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ContextStore.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token plain-text">

export default HookContextProvider</span></code></pre></div>
<p>这个文件干了这些事：</p>
<blockquote>
<ol>
<li>定义包含 state 和 action 的 AppState</li>
<li>使用 AppState 初始化 React.createContext，生成全局的 ContextStore</li>
<li>使用 React.useReducer 生成具体的 todoState、todoDispatch</li>
<li>通过 ContextStore.Provider 组件将 todoState、todoDispatch 注入整个应用</li>
</ol>
</blockquote>
<p>可以看到,<code>todoState</code>、<code>todoDispatch</code> 才是整个代码的重点，因为这里包含着整个应用的 state 和 action，而生成 state 和 action 的 <code>React.useReducer</code> 中的参数：<code>todoReducer</code>、<code>initalTodoState</code>，就是正常的 Redux 模式中的 <code>Reducer</code> 函数，事实上，这里的 todo 文件夹就是原封不动将类模式那个 todo 文件夹搬过来的。核心概念都是一样的。</p>
<p>这也说明了，React 通过 Hooks API 将 Redux 概念整个地吸收进来了。</p>
<p>而在组件中，我们使用也很方便：</p>
<p><strong>TodoViewList.tsx:</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  useContext
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> TodoView <span class="token keyword">from</span> <span class="token string">'./TodoView'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ContextStore
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/store'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  <span class="token constant">SELECT_TODO</span><span class="token punctuation">,</span>
  <span class="token constant">REMOVE_TODO</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store/todo'</span>

<span class="token keyword">import</span> <span class="token string">'./styles/TodoViewList.css'</span>

<span class="token keyword">const</span> TodoViewList<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    todoState<span class="token punctuation">,</span>
    dispatch
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ContextStore<span class="token punctuation">)</span>
  <span class="token comment">// 发起 action 操作</span>
  <span class="token keyword">const</span> <span class="token function-variable function">selectTodoById</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">SELECT_TODO</span><span class="token punctuation">,</span>
    id
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">removeTodoById</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">REMOVE_TODO</span><span class="token punctuation">,</span>
    id
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewlist<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>todoState<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoView</span></span>
          <span class="token attr-name">todo</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
          <span class="token attr-name">selectTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>selectTodoById<span class="token punctuation">}</span></span>
          <span class="token attr-name">removeTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>removeTodoById<span class="token punctuation">}</span></span>
          <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoViewList</code></pre></div>
<p>只需要使用 <code>const { todoState, dispatch } = useContext(ContextStore)</code>，非常方便。</p>
<h2 id="8-react-hooks-app-with-mobx"><a href="#8-react-hooks-app-with-mobx" aria-label="8 react hooks app with mobx permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8. React Hooks App with Mobx</h2>
<p>相比起 Hooks 吸收了 Redux，MobX 并没有直接被 Hooks 化，还是需要外部的依赖。</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@types/jest"</span><span class="token operator">:</span> <span class="token string">"24.0.15"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/node"</span><span class="token operator">:</span> <span class="token string">"12.6.8"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react"</span><span class="token operator">:</span> <span class="token string">"16.8.23"</span><span class="token punctuation">,</span>
    <span class="token property">"@types/react-dom"</span><span class="token operator">:</span> <span class="token string">"16.8.5"</span><span class="token punctuation">,</span>
    <span class="token property">"mobx"</span><span class="token operator">:</span> <span class="token string">"^5.13.0"</span><span class="token punctuation">,</span>
    <span class="token property">"mobx-react-lite"</span><span class="token operator">:</span> <span class="token string">"^1.4.1"</span><span class="token punctuation">,</span>
    <span class="token property">"react"</span><span class="token operator">:</span> <span class="token string">"^16.8.6"</span><span class="token punctuation">,</span>
    <span class="token property">"react-dom"</span><span class="token operator">:</span> <span class="token string">"^16.8.6"</span><span class="token punctuation">,</span>
    <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"3.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"3.5.3"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>值得一提的是，<code>mobx-react-lite</code> 这个包是 <code>mobx-react</code> 的精简，是为了跟进 Hooks 而发布的，也就是只能在 React 16.8+ 中使用，不兼容类模式。根据官方说法，lite 包最终还是会合并进 <code>mobx-react</code> 中的。</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">├── README.md
├── package.json
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── manifest.json
├── src // 源码
│   ├── App.css
│   ├── App.test.tsx
│   ├── App.tsx
│   ├── components // UI 组件
│   │   ├── TodoAdd.tsx
│   │   ├── TodoCounter.tsx
│   │   ├── TodoView.tsx
│   │   ├── TodoViewList.tsx
│   │   ├── assets
│   │   │   ├── delete.svg
│   │   │   ├── select.svg
│   │   │   └── select2.svg
│   │   └── styles
│   │       ├── TodoAdd.css
│   │       ├── TodoCounter.css
│   │       ├── TodoView.css
│   │       └── TodoViewList.css
│   ├── index.css
│   ├── index.tsx
│   ├── interfaces
│   │   ├── base.ts
│   │   └── index.ts
│   ├── react-app-env.d.ts
│   ├── serviceWorker.ts
│   └── store // mobx store
│       ├── index.ts
│       └── useTodoStore.tsx
├── tsconfig.json
└── yarn.lock</code></pre></div>
<p>这里直接说重点，整个应用的重点在 store 文件夹下的 <code>useTodoStore.tsx</code>：</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  useContext
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  useLocalStore
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react-lite'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  observable
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ITodo
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../interfaces'</span>

<span class="token comment">// 定义 store shape</span>
<span class="token keyword">const</span> <span class="token function-variable function">createStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  todos<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">as</span> ITodo<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 或者 Array&lt;ITodo></span>
  <span class="token keyword">get</span> <span class="token function">finishedTodoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>finished<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">totalCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">finishTodoById</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        todo<span class="token punctuation">.</span>finished <span class="token operator">=</span> <span class="token operator">!</span>todo<span class="token punctuation">.</span>finished
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">addNewTodo</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// *新增 observable Todo 对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      name<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
      finished<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">removeTodoById</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 找到某一项的位置</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=></span> todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> TTodoStore <span class="token operator">=</span> ReturnType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeof</span> <span class="token attr-name">createStore</span><span class="token punctuation">></span></span><span class="token plain-text">


// 创建 context
const TodoStoreContext = React.createContext&lt;TTodoStore | null>(null)

// 创建 Provider，通过 React.Context 来注入
const TodoStoreProvider: React.FC = ({ children }) => </span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useLocalStore</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoStoreContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TodoStoreContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token plain-text">

// 创建 Hook
const useTodoStore = () => </span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>TodoStoreContext<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'You have forgot to use StoreProvider, shame on you.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> store
<span class="token punctuation">}</span><span class="token plain-text">

export </span><span class="token punctuation">{</span>
  TodoStoreProvider<span class="token punctuation">,</span>
  useTodoStore
<span class="token punctuation">}</span></code></pre></div>
<p>这里，<code>TodoStoreProvider</code> 组件是 Context 的封装，使用 <code>useLocalStore</code> 生成 MobX store，而 <code>useTodoStore</code> Hook 是对于 <code>useContext</code> 的封装，所以，在组件中使用也就变得很方便：</p>
<p><strong>App.tsx:</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> TodoAdd <span class="token keyword">from</span> <span class="token string">'./components/TodoAdd'</span>
<span class="token keyword">import</span> TodoViewList <span class="token keyword">from</span> <span class="token string">'./components/TodoViewList'</span>
<span class="token keyword">import</span> TodoCounter <span class="token keyword">from</span> <span class="token string">'./components/TodoCounter'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  TodoStoreProvider
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store'</span>

<span class="token keyword">const</span> App<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoStoreProvider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">React Hooks App ( mobx )</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoAdd</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoViewList</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TodoStoreProvider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p><strong>TodoViewList.tsx:</strong></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  observer
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mobx-react-lite'</span>

<span class="token keyword">import</span> TodoView <span class="token keyword">from</span> <span class="token string">'./TodoView'</span>
<span class="token keyword">import</span> <span class="token string">'./styles/TodoViewList.css'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  useTodoStore
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store'</span>

<span class="token keyword">const</span> TodoViewList<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span> <span class="token operator">=</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> todoStore <span class="token operator">=</span> <span class="token function">useTodoStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewlist<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>todoStore<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TodoView</span></span>
          <span class="token attr-name">todo</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span>
          <span class="token attr-name">finishTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoStore<span class="token punctuation">.</span>finishTodoById<span class="token punctuation">}</span></span>
          <span class="token attr-name">removeTodoById</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>todoStore<span class="token punctuation">.</span>removeTodoById<span class="token punctuation">}</span></span>
          <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>
        <span class="token punctuation">/></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> TodoViewList</code></pre></div>
<p>个人觉得，比起 React Hooks App with Redux 这个例子，使用方式要复杂一点，但比类模式要简约不少，定义的 <code>useTodoStore</code> 可以在任何组件中使用，如果后续要拓展的话，完全可以照着再写一个 <code>useXXXStore</code>。</p>
<h2 id="9-总结"><a href="#9-%E6%80%BB%E7%BB%93" aria-label="9 总结 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9. 总结</h2>
<p>四个 example 写下来，我的个人感受：</p>
<ol>
<li>Hooks 确实比类模式简化很多，是 React 技术栈的未来趋势</li>
<li>MobX 也不一定比 Redux 简约，比如 Hooks 下 MobX 接入也稍显麻烦，不像 Redux 那样直接内化为官方 API</li>
<li>Redux 的 reducer 和 action 的功能可以由类模式无痛迁移到 Hooks 中</li>
<li>Typescript 是真的 power！中央决定了，以后就由你当我的主力语言了！</li>
</ol>
<h2 id="参考"><a href="#%E5%8F%82%E8%80%83" aria-label="参考 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考</h2>
<ul>
<li><a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367">Dan Abramov - You Might Not Need Redux</a></li>
<li><a href="https://cn.mobx.js.org/">MobX 中文官网</a></li>
<li><a href="https://mobx-react.js.org">MobX with React</a></li>
<li><a href="https://dev.to/ryands17/using-mobx-with-react-hooks-52h5">Using MobX with React Hooks</a></li>
<li><a href="https://medium.com/@Whien/%E9%80%8F%E9%81%8E-react-usecontext-%E8%88%87-usereducer-%E4%BE%86%E5%81%9A-global-state-manager-bed30fb1f08b">透過 React CreateContext 搭配 React useContext 與 useReducer 來做 Global State Manager</a></li>
</ul></div></div><div class="layout-module--footer--1-u4U"><div class="layout-module--contact--1Z-dZ"><a href="https://github.com/BetaMee" target="_blank" rel="noopener noreferrer">Github</a><a href="https://twitter.com/gongxq" target="_blank" rel="noopener noreferrer">Twitter</a><a href="https://weibo.com/2909438360" target="_blank" rel="noopener noreferrer">Weibo</a><a href="https://www.instagram.com/gongxq95" target="_blank" rel="noopener noreferrer">Instagram</a></div><div class="layout-module--siteInfo--WbGrj">Copyright © 橡树上 2019</div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/content/React-React 状态管理使用指南/";window.webpackCompilationHash="f887d2ea5e63cb3611e0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-aeaacb0f871062c77e7c.js"],"component---src-templates-blog-list-tsx":["/component---src-templates-blog-list-tsx-c8ed0aa8d8c7cfeef20c.js"],"component---src-templates-blog-template-tsx":["/component---src-templates-blog-template-tsx-a2d7125bc98516a07fae.js"],"component---src-templates-tag-template-tsx":["/component---src-templates-tag-template-tsx-804757eb374231d0cdd7.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-375cab65ac17551be3cc.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-b882ab29d6859d4bdc47.js"]};/*]]>*/</script><script src="/webpack-runtime-2e5e8a041a29d1b31b0e.js" async=""></script><script src="/app-aeaacb0f871062c77e7c.js" async=""></script><script src="/commons-fdd99c7d38d0b81fffeb.js" async=""></script><script src="/styles-607a73e244ee0b08b1e5.js" async=""></script><script src="/component---src-templates-blog-template-tsx-a2d7125bc98516a07fae.js" async=""></script></body></html>