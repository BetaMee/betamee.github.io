{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/WebFrontEnd-Commit 规范与 CHANGELOG 生成/","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"7bc51beb-44e1-5675-9bf0-245224f2f4ca","html":"<h2 id=\"目录\"><a href=\"#%E7%9B%AE%E5%BD%95\" aria-label=\"目录 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目录</h2>\n<!-- TOC -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#commit-%E8%A7%84%E8%8C%83\">Commit 规范</a></li>\n<li><a href=\"#commit-%E6%A0%A1%E9%AA%8C%E5%B7%A5%E5%85%B7\">Commit 校验工具</a></li>\n<li><a href=\"#changelog-%E7%94%9F%E6%88%90\">CHANGELOG 生成</a></li>\n<li>\n<p><a href=\"#%E5%8F%82%E8%80%83\">参考</a></p>\n<!-- /TOC -->\n</li>\n</ul>\n<h2 id=\"前言\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>Git 是我们开发项目中日常接触到的工具，使用 Git 我们需要根据改动的内容提交不同的信息，然后 push 到远程仓库中。在团队协作中，如果每个人提交的信息都不一样，甚至很随意的如\"update\"、\"fix bug\"这类毫无含义的信息，这对于后期的维护产生很多困扰，一旦需要甩锅和回退的时候，很难定位到当初的提交 Commit。所以为了写好 Git Commit Message，我们需要一个合理的规范。</p>\n<p>一个好的提交规范可以：</p>\n<ul>\n<li>正确传达出每一份 Commit 影响到的代码改动</li>\n<li>可以通过 Commit 历史信息追溯项目开发改动过程</li>\n<li>可以直接从 Commit 历史信息中过滤生成 CHANGELOG.md</li>\n<li>可以由相应的 Commit 直接触发自动化构建部署流程</li>\n</ul>\n<p>本文将分两部分介绍这一块知识，一个是 Commit 规范校验，另一个是由 Commit 信息生成 CHANGELOG.md。</p>\n<h2 id=\"commit-规范\"><a href=\"#commit-%E8%A7%84%E8%8C%83\" aria-label=\"commit 规范 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Commit 规范</h2>\n<p>对于如何规范 Commit，社区里有比较好的实践是 Angular 团队的规范, 继而衍生了 Conventional Commits specification。 很多工具也是基于此规范, 它的 message 格式如下:</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n&lt;BLANK LINE&gt;\n&lt;body&gt;\n&lt;BLANK LINE&gt;\n&lt;footer&gt;</code></pre></div>\n<p>我们在书写 Commit 的时候，分为三大部分，用空行分割：</p>\n<blockquote>\n<ul>\n<li>标题行：必须，描述主要修改类型和内容</li>\n<li>主题内容：可选，详细描述为什么修改, 做了什么样的修改, 以及开发的思路等等</li>\n<li>页尾注释：可选，放 Breaking Changes 或 Closed Issues</li>\n</ul>\n</blockquote>\n<p>而 type 部分是由固定的类型指定，主要有：</p>\n<blockquote>\n<ul>\n<li>feat: 新特性新功能</li>\n<li>fix: 修改的 BUG</li>\n<li>refactor: 代码重构</li>\n<li>chore: 项目相关修改, 比如构建流程, 依赖管理</li>\n<li>docs: 文档修改</li>\n<li>style: 代码格式修改, 注意不是 css 修改</li>\n<li>test: 测试用例修改</li>\n<li>hotfix: 紧急发布的修改</li>\n</ul>\n</blockquote>\n<p>scope 部分是描述出改动的范围，比如改动了路由部分、或者某个组件。</p>\n<p>subject 简明扼要描述本次提交的内容，首字母无需大写，结尾不需要使用<code>.</code>，并且以动词开头，如 <code>change</code>、<code>fix</code>。</p>\n<p>body 则详细描述本次提交，比如此次变更的动机，如需换行，则使用 <code>|</code>。</p>\n<p>footer 描述与之关联的 issue 或 break change。</p>\n<p>通过以上的规范写出来的 Commit，就像一份邮件，可以清楚描述出每一次的改动内容。</p>\n<h2 id=\"commit-校验工具\"><a href=\"#commit-%E6%A0%A1%E9%AA%8C%E5%B7%A5%E5%85%B7\" aria-label=\"commit 校验工具 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Commit 校验工具</h2>\n<p>有了规范，那么自然就有相应的工具来帮助我们进行校验，就如 eslint、stylelint 之类的流程工具。</p>\n<p>我用的是 <a href=\"https://github.com/conventional-changelog\">conventional-changelog</a> 社区的 <a href=\"https://github.com/conventional-changelog/commitlint\">commitlint</a> 工具，来帮助我们在校验项目每一个 Commit。</p>\n<p>要让你的项目实现这个功能，需要安装以下依赖包：</p>\n<blockquote>\n<ul>\n<li>@commitlint/cli</li>\n<li>@commitlint/config-conventional</li>\n<li>husky</li>\n</ul>\n</blockquote>\n<p><code>@commitlint/config-conventional</code> 是社区使用广泛的规范配置包，里面应用的是我们上一节讨论的规范，你也可以根据自己团队编写属于自己的规范，就像 <code>eslint</code> 一样，可以自由拓展。</p>\n<p>在项目的全局文件夹中新添 <code>commitlint.config.js</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// commitlint.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">extends</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@commitlint/config-conventional'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  rules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至于 rules 的配置可以参考<a href=\"https://commitlint.js.org/#/reference-rules\">官网</a>。</p>\n<p>然后再在 <code>packages.json</code> 中添加 <code>husky</code> 配置，这个才是连接 Git 的工具：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"husky\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"hooks\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"commit-msg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commitlint -E HUSKY_GIT_PARAMS\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上配置后，就可以愉快地开启 Commit 校验了，如果写得不规范，<code>husky</code> 直接给你打回来：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.00419727177335%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHMuJAr/8QAFxABAAMAAAAAAAAAAAAAAAAAAgABA//aAAgBAQABBQKDZCr2Sn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAAREQ/9oACAEBAAY/AiKZ/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERITGR/9oACAEBAAE/IWafrcofVzh//9oADAMBAAIAAwAAABB/7//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EGf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAITFR/9oACAEBAAE/EC7L2GaNg6VwFST/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"commit no standard\"\n        title=\"commit no standard\"\n        src=\"/static/4a7bd9952da84c2b44c98066cdb0d4ed/7e3f6/commit-no-standard.jpg\"\n        srcset=\"/static/4a7bd9952da84c2b44c98066cdb0d4ed/74ce1/commit-no-standard.jpg 250w,\n/static/4a7bd9952da84c2b44c98066cdb0d4ed/c635c/commit-no-standard.jpg 500w,\n/static/4a7bd9952da84c2b44c98066cdb0d4ed/7e3f6/commit-no-standard.jpg 1000w,\n/static/4a7bd9952da84c2b44c98066cdb0d4ed/db64a/commit-no-standard.jpg 1500w,\n/static/4a7bd9952da84c2b44c98066cdb0d4ed/5943d/commit-no-standard.jpg 1906w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"changelog-生成\"><a href=\"#changelog-%E7%94%9F%E6%88%90\" aria-label=\"changelog 生成 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CHANGELOG 生成</h2>\n<p>如果你的项目 Commit 写得非常规范，可以使用工具来读取 Git Commit 自动生成 CHANGELOG.md，我调研了很多工具，最后发现 <a href=\"https://github.com/conventional-changelog\">conventional-changelog</a> 社区的 <a href=\"https://github.com/conventional-changelog/standard-version\">standard-version</a> 还算符合我的要求。为什么是 <em>还算</em> 呢？因为这个工具有 BUG...</p>\n<p>先安装：<code>yarn add standard-version</code>，然后配置 npm script：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"release\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"release:minor\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version --release-as minor &amp;&amp; git push --follow-tags\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"release:major\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version --release-as major &amp;&amp; git push --follow-tags\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token property\">\"release:patch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"standard-version --release-as patch &amp;&amp; git push --follow-tags\"</span></code></pre></div>\n<p>这里的 <code>minor</code>、<code>major</code>、<code>patch</code>，是指 Semver 规范版本号，这个后面我会再整理一篇文章出来，整理一下语义化版本号的知识。每一个正式软件版本可以用<code>minor.major.patch</code>来表示，使用 <code>release:minor</code> 可以将当前项目由 <code>1.0.0</code> 升级到 <code>2.0.0</code>，相似的，<code>release:major</code> 升级次版本号，<code>release:patch</code> 升级小版本号。</p>\n<p>通过这样的命令，<code>standard-version</code> 可以帮助我们生成一份 CHANGELOG.md、升级版本、发布新的 tag、发布 Github release。非常自动化：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.0382513661202%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHkLmwg/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwADAAAAAAAAAAAAAAAAABFhARCB/9oACAEBAAE/IXBweRU7r//aAAwDAQACAAMAAAAQmC//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPxCn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQEBAQEAAAAAAAAAAAAAAQARITFB/9oACAEBAAE/EN59S47epCQ7k6mpMb//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"changelog\"\n        title=\"changelog\"\n        src=\"/static/15072875962de24b34f002e9b158300a/7e3f6/changelog.jpg\"\n        srcset=\"/static/15072875962de24b34f002e9b158300a/74ce1/changelog.jpg 250w,\n/static/15072875962de24b34f002e9b158300a/c635c/changelog.jpg 500w,\n/static/15072875962de24b34f002e9b158300a/7e3f6/changelog.jpg 1000w,\n/static/15072875962de24b34f002e9b158300a/db64a/changelog.jpg 1500w,\n/static/15072875962de24b34f002e9b158300a/da749/changelog.jpg 1830w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>特别注明以下，红框中就是 <code>standard-version@7.0.0</code> 的 BUG，暂时无法更改其内容...</p>\n<h2 id=\"参考\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://juejin.im/post/5bd2debfe51d457abc710b57\">规范你的 commit message 并且根据 commit 自动生成 CHANGELOG.md</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/34223150\">优雅的提交你的 Git Commit Message</a></li>\n<li><a href=\"http://jartto.wang/2018/07/08/git-commit/\">你可能会忽略的 Git 提交规范</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html\">Commit message 和 Change log 编写指南</a></li>\n<li><a href=\"https://github.com/conventional-changelog\">conventional-changelog · GitHub</a></li>\n<li><a href=\"https://juejin.im/entry/5b97cea65188255c7f5e96a4\">Angular 工具篇之规范化Git版本管理</a></li>\n</ul>","fields":{"slug":"/content/WebFrontEnd-Commit 规范与 CHANGELOG 生成/"},"frontmatter":{"title":"Commit 规范与 CHANGELOG 生成","category":"WebFrontEnd","tags":"Web_Deep 工程化 Git","date":"2019-09-17"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/content/WebFrontEnd-Commit 规范与 CHANGELOG 生成/"}}}