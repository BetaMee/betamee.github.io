{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/WebFrontEnd-JavaScript 浮点数运算/","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"3075d617-b84a-5d0f-8b39-48bc558b5af0","html":"<h2 id=\"目录\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E5%BD%95\" aria-label=\"目录 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目录</h2>\n<!-- toc -->\n<ul>\n<li><a href=\"#%E8%B5%B7%E5%9B%A0\">起因</a></li>\n<li><a href=\"#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2\">进制转换</a></li>\n<li><a href=\"#%E6%B5%AE%E7%82%B9%E6%95%B0\">浮点数</a></li>\n<li><a href=\"#js-%E4%B8%AD%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%AE%A1%E7%AE%97\">js 中的浮点数计算</a></li>\n<li><a href=\"#%E6%95%B4%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98\">整数的精度问题</a></li>\n<li>\n<p><a href=\"#%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%B2%BE%E7%A1%AE%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BF%90%E7%AE%97%E5%87%BD%E6%95%B0\">设计一个精确的浮点数运算函数</a></p>\n<ul>\n<li><a href=\"#%E6%B5%AE%E7%82%B9%E5%B0%8F%E6%95%B0%E5%88%A4%E6%96%AD\">浮点小数判断</a></li>\n<li><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E5%8A%A0%E6%B3%95%E5%87%BD%E6%95%B0\">精确的加法函数</a></li>\n<li><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E5%87%8F%E6%B3%95%E5%87%BD%E6%95%B0\">精确的减法函数</a></li>\n<li><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E4%B9%98%E6%B3%95%E5%87%BD%E6%95%B0\">精确的乘法函数</a></li>\n<li><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E9%99%A4%E6%B3%95%E5%87%BD%E6%95%B0\">精确的除法函数</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>\n<!-- tocstop -->\n<h2 id=\"起因\" style=\"position:relative;\"><a href=\"#%E8%B5%B7%E5%9B%A0\" aria-label=\"起因 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>起因</h2>\n<p>在 JavaScript 作数学计算的时候，经常会遇到这样的问题：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 加法 =====================</span>\n<span class=\"token comment\">// 0.1 + 0.2 = 0.30000000000000004</span>\n<span class=\"token comment\">// 0.7 + 0.1 = 0.7999999999999999</span>\n<span class=\"token comment\">// 0.2 + 0.4 = 0.6000000000000001</span>\n<span class=\"token comment\">// 2.22 + 0.1 = 2.3200000000000003</span>\n\n<span class=\"token comment\">// 减法 =====================</span>\n<span class=\"token comment\">// 1.5 - 1.2 = 0.30000000000000004</span>\n<span class=\"token comment\">// 0.3 - 0.2 = 0.09999999999999998</span>\n\n<span class=\"token comment\">// 乘法 =====================</span>\n<span class=\"token comment\">// 19.9 * 100 = 1989.9999999999998</span>\n<span class=\"token comment\">// 19.9 * 10 * 10 = 1990</span>\n<span class=\"token comment\">// 1306377.64 * 100 = 130637763.99999999</span>\n<span class=\"token comment\">// 1306377.64 * 10 * 10 = 130637763.99999999</span>\n<span class=\"token comment\">// 0.7 * 180 = 125.99999999999999</span>\n<span class=\"token comment\">// 9.7 * 100 = 969.9999999999999</span>\n<span class=\"token comment\">// 39.7 * 100 = 3970.0000000000005</span>\n\n<span class=\"token comment\">// 除法 =====================</span>\n<span class=\"token comment\">// 0.3 / 0.1 = 2.9999999999999996</span>\n<span class=\"token comment\">// 0.69 / 10 = 0.06899999999999999</span></code></pre></div>\n<p>这种不太精确的值原因在于，在 JavaScript 中整数和浮点数都是属于 <em>Number</em> 类型，所有数字都是以 64 位浮点数（double float）形式存储，即便整数也是如此。</p>\n<p>它的实现遵循 IEEE 754 标准，使用 64 位固定长度来表示，也就是标准的 double 双精度浮点数（相关的还有 float 32 位单精度）。</p>\n<p>在解决这个问题前，先理解一下进制的知识、浮点数的概念以及计算机内部是如何存储这些值的。</p>\n<h2 id=\"进制转换\" style=\"position:relative;\"><a href=\"#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2\" aria-label=\"进制转换 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>进制转换</h2>\n<p>计算机中都是以二进制存储数据的，我们举一些常见的十进制和二进制转换例子。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 十进制</span>\n<span class=\"token number\">100.3</span>\n<span class=\"token comment\">// 二进制</span>\n<span class=\"token number\">1100100.0100110011001100110011001100110011001100110011</span>（<span class=\"token number\">1001</span>无限循环）\n\n<span class=\"token comment\">// 十进制</span>\n<span class=\"token number\">0.1</span>\n<span class=\"token comment\">// 二进制</span>\n<span class=\"token number\">0.0001100110011001</span><span class=\"token operator\">...</span><span class=\"token punctuation\">(</span><span class=\"token number\">1001</span>无限循环<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 十进制</span>\n<span class=\"token number\">0.2</span>\n<span class=\"token comment\">// 二进制</span>\n<span class=\"token number\">0.0011001100110011</span><span class=\"token operator\">...</span><span class=\"token punctuation\">(</span><span class=\"token number\">1001</span>无限循环<span class=\"token punctuation\">)</span></code></pre></div>\n<p>由于计算机内部的存储不可能是无限的位数，必然会有取舍。假设一个 8 位的存储器都用来存这些数据（不考虑正负等其他情况），那么多于 8 位以外的值将会被舍弃，舍弃的原则是第九位<strong>0 舍 1 进</strong>：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 现实值</span>\n<span class=\"token number\">0001100110011001.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token comment\">// 放在计算机的存储器中，第九位 0 舍 1 进</span>\n<span class=\"token number\">00011010</span></code></pre></div>\n<p>这说明了进制的转换，或者说计算器存储数据本身是有一定的误差的。</p>\n<h2 id=\"浮点数\" style=\"position:relative;\"><a href=\"#%E6%B5%AE%E7%82%B9%E6%95%B0\" aria-label=\"浮点数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>浮点数</h2>\n<p>那么什么是浮点数呢？</p>\n<p>上面的案例中提到，使用一个 8 位的存储器，最多只能存 $2^8 = 256$ （0 -255）个值，就算使用 32 位，64 位存储器，也最多能放$2^{32}$、$2^{64}$，这离现实中使用的场景差距远着呢。</p>\n<p>为了解决这个问题，引入一种<em>科学计数法</em>的数学工具，就是用简洁的方式来表示世间各种各样的数据，它的公式如下表示：</p>\n<p>$$d.dddd \\times \\beta^ e( 0 \\leqslant di &#x3C; \\beta)$$</p>\n<p>其中：$d.ddd$ 为尾数、$\\beta$为基数、$e$ 为加权指数。</p>\n<p>比如，我们常用的十进制 $1901.23$，用科学计数法来表示：$1.90123 \\times 10^2$。</p>\n<p>同样的，二进制也可以用科学计数法来表示，比如 $1001.1101$，可以写成这样: $1.0011101 \\times 2^{11}$。</p>\n<p>不要被这里的 11 误解，它是二进制的，等于十进制的 3，也就是说左移 3 位。</p>\n<p>有了这个规则，进入到计算中的浮点数存储器，根据 IEEE 745 标准，计算机内部有单精度、双精度、拓展双精度等实现：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 676px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.399999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAqUlEQVQI1x2Pyw6DMAwE+f8fQ5wAIXHgIUISkkADtClU5LSNfbBkWauZdXYcB87zhHMW0zTBGINhGLAsC/q+hxAC4zhCa422baGUgpQSZVnyvu875yi/riuyqqoQY4RIsG3b8E7wzyfA+xeu64KzFiF8WfQ8kW9aafzuO90Dw5qmYTHBszzPuQHNPEtYa9I4ttsEIxGZqT19471H13Xckva6rlEUBedJ+gej69wkvAlgnQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3a5a6295.png\"\n        title=\"3a5a6295.png\"\n        src=\"/static/6179acd912d87d7a8789fa1d87bf0281/9bb7a/3a5a6295.png\"\n        srcset=\"/static/6179acd912d87d7a8789fa1d87bf0281/63868/3a5a6295.png 250w,\n/static/6179acd912d87d7a8789fa1d87bf0281/0b533/3a5a6295.png 500w,\n/static/6179acd912d87d7a8789fa1d87bf0281/9bb7a/3a5a6295.png 676w\"\n        sizes=\"(max-width: 676px) 100vw, 676px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>需要特别注意的是，扩展双精度类型没有隐含位，因此它的有效位数与尾数位数一致，而单精度类型和双精度类型均有一个隐含位，因此它的有效位数比位数位数多一个。</p>\n</blockquote>\n<p>它其实也是根据这个数学工具来摆放数据的：</p>\n<p>$$(-1)^S \\times 2^{E-bias} \\times 1.M$$</p>\n<p>存储的是 SEM 组成的二进制。</p>\n<p>其中：</p>\n<ol>\n<li>S 为 sign，是符号位，S = 0 为正， S = 1 为负</li>\n<li>1.M 是二进制的<strong>有效数字</strong>，IEEE 754规定，在计算机内部保存这个值时，默认这个数的第一位总是 1，因此可以被舍去，只保存后面的 M 部分</li>\n<li>E 是<strong>指数</strong>，一个无符号整数</li>\n<li>bias 是<strong>指数偏移</strong>，用于确定浮点数偏执，E - bias 后才是加权值</li>\n</ol>\n<p>IEEE 754 规定，对于 32 位的浮点数，最高的1位是符号位 S，接着的 8 位是指数 E，剩下的 23 位为有效数字 M。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAyklEQVQY02NgYGBghWI2IOYCYg4G7ACkhgVK4wYrz55U7z03L63l4sS4tnOTE+rP9yfsXzYt9umMeZF3Z8+JujtrTtT5CZMSTnT3Jp+bMDH+4qTJ8UCxyHuz50Tenjk78ub0mdEbq2slQJbJCIuwMxz78MZ+6addS2d9XjFz3uc1s6Z8WjH7yo5l874vXT3n/YqVc94uXT7v3bIVc98vXzkHSM/5uGLVHCB7Ngi/Wbp89uslS+ftamrWBhrIIyEgyM8A9SqlgBnGAAA7Pl0HpvuKwgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"c8092105.png\"\n        title=\"c8092105.png\"\n        src=\"/static/626a3326a4a2dad36b7aaec9e2fe43df/0b533/c8092105.png\"\n        srcset=\"/static/626a3326a4a2dad36b7aaec9e2fe43df/63868/c8092105.png 250w,\n/static/626a3326a4a2dad36b7aaec9e2fe43df/0b533/c8092105.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>对于 64 位的浮点数，最高的 1 位是符号位 S，接着的11位是指数 E，剩下的 52 位为有效数字 M。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAtElEQVQY02NggABGIBYDYl4G/ACkhh+viqyWWrWsBaUZWctKkrNXlSct6a6P2VffHLm9sSlqJxDvAOLtDY1gekVpWdLykrLk3U0tkSCxXU3NUTsamkA4EsiOW1lWrsIw98guy/az07Z0Xp26uuXipI075/ZvuT5h6voLkyavvzRpyvqLQPr8xElAesr6S5OnrIPi9RcmTl5/efJUMA1UsxaId+1pbvUAOZIH6mWY19kYyAfsAKLnXE8psmORAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"c8938d30.png\"\n        title=\"c8938d30.png\"\n        src=\"/static/8bd047fab30984fb6ec9aca0cbec4f9d/0b533/c8938d30.png\"\n        srcset=\"/static/8bd047fab30984fb6ec9aca0cbec4f9d/63868/c8938d30.png 250w,\n/static/8bd047fab30984fb6ec9aca0cbec4f9d/0b533/c8938d30.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>这里第三第四点需要整体理解一下。在内存中，存储的是 E 指数的二进制，它是一个无符号整数，这意味着，如果 E 为 8 位，它的取值范围为 0 ~ 255；如果 E 为 11 位，它的取值范围为 0 ~ 2047。但是，由于科学计数法中的指数是可以出现负数的，所以这里需要减去 bias 值，所以IEEE 754 规定，E 的真实值必须再减去一个中间数，对于 32 位浮点数（有 8 位 E 空间），这个中间数是 127；对于 64 位浮点数（有 11 位 E 空间），这个中间数是 1023。</p>\n<p>举个例子，1.1011 x 2^10 这个二进制的数的权为 10（十进制的 10）， 表示左移了 10 位，那么存在 32 位的 E 空间中需要加上 127，保存为 10 + 127 = 137，其二进制数为：10001001</p>\n<p>然后，指数E还可以再分成三种情况：</p>\n<ol>\n<li>E 不全为 0 或不全为 1。这时，浮点数就采用上面的规则表示，即指数E的计算值减去127（或1023），得到真实值，再将有效数字M前加上第一位的1。</li>\n<li>E 全为 0。这时，浮点数的指数 E 等于 1-127（或者 1-1023），有效数字 M 不再加上第一位的1，而是还原为 0.xxxxxx 的小数。这样做是为了表示 ±0，以及接近于 0 的很小的数字。</li>\n<li>E 全为 1。这时，如果有效数字 M 全为 0，表示 ± 无穷大（正负取决于符号位 s）；如果有效数字 M 不全为 0，表示这个数不是一个数（NaN）。</li>\n</ol>\n<h2 id=\"js-中的浮点数计算\" style=\"position:relative;\"><a href=\"#js-%E4%B8%AD%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%AE%A1%E7%AE%97\" aria-label=\"js 中的浮点数计算 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>js 中的浮点数计算</h2>\n<p>学习了上面的理论知识（晕），现在来看 JavaScript 中的运算过程。</p>\n<p>下图展示了 JavaScript 中的存储方式，也就是 64 位浮点数的规则，跟上面的理论知识是一样的。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQoz4WR3W6DMAyF+/7vxsUmhICNFpW/Eig0gbSBhpwlETAYF7NkxcdBhy/2CTqUUljC1Fv9t/ff3WkR5KlQ6sSsRUvwqjOMrFk/nqbJ1m3bIs9zdF13MF0Nc64QPWazpgA9f4LfYtDoA+9nt6MihMBxHJRluf5kQ2hLsBG4C0Byag2HtrR0w6OytekboqqqUOs0pk3TWG2ID4QVl4hID5p+o4l9VBcfoyYbXxz12QNNQnyFAVzXRRAEYIyBcw7f9+F5HqSUe8NWKNx6iYHW4OUVfRFjMITsDk4S219ml2WZpaOUWm0oV8L59Sh6hSsDRj2Stzbp0xC8uNhTakpstiuEQJIkSNN0t+HdlpfGmnrYv3o63E/TsWfiBzVkbBWbAWAHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"55e1bc8c.png\"\n        title=\"55e1bc8c.png\"\n        src=\"/static/75412f36f6d4d60f5033e28f8051468e/00d43/c42cdeb1.png\"\n        srcset=\"/static/75412f36f6d4d60f5033e28f8051468e/63868/c42cdeb1.png 250w,\n/static/75412f36f6d4d60f5033e28f8051468e/0b533/c42cdeb1.png 500w,\n/static/75412f36f6d4d60f5033e28f8051468e/00d43/c42cdeb1.png 1000w,\n/static/75412f36f6d4d60f5033e28f8051468e/c1b63/c42cdeb1.png 1200w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>复盘 0.1 + 0.2 = 0.30000000000000004 这个经典问题：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 0.1 和 0.2 都转化成二进制后再进行运算</span>\n<span class=\"token number\">0.00011001100110011001100110011001100110011001100110011010</span> <span class=\"token operator\">+</span>\n<span class=\"token number\">0.0011001100110011001100110011001100110011001100110011010</span> <span class=\"token operator\">=</span>\n<span class=\"token number\">0.0100110011001100110011001100110011001100110011001100111</span>\n\n<span class=\"token comment\">// 转成十进制正好是 0.30000000000000004</span></code></pre></div>\n<p>总结一下误差产生的根本原因：对因<strong>浮点数小数位的限制而截断</strong>的二进制数字进行了运算，再转换为十进制，这就造成了一定的误差！</p>\n<p>这里还有另外一个有趣的地方，由于浮点数的不精确，0.1 其实也不是真正的 0.1:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token number\">0.1</span><span class=\"token punctuation\">.</span><span class=\"token function\">toPrecision</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.1000000000000000</span>\n<span class=\"token number\">0.1</span><span class=\"token punctuation\">.</span><span class=\"token function\">toPrecision</span><span class=\"token punctuation\">(</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.100000000000000005551</span>\n<span class=\"token number\">0.1</span><span class=\"token punctuation\">.</span><span class=\"token function\">toPrecision</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.10000000000000000555111512312578</span>\n\n<span class=\"token number\">0.3</span><span class=\"token punctuation\">.</span><span class=\"token function\">toPrecision</span><span class=\"token punctuation\">(</span><span class=\"token number\">25</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0.2999999999999999888977698</span></code></pre></div>\n<p>这是因为 M 固定长度是 52 位，再加上省略的一位，最多可以表示的数是 2^53 = 9007199254740992，对应科学计数尾数是 9.007199254740992，这也是 JavaScript 最多能表示的精度。它的长度是 16，所以默认使用 toPrecision(16) 来做精度运算，超过的精度会自动做凑整处理。</p>\n<h2 id=\"整数的精度问题\" style=\"position:relative;\"><a href=\"#%E6%95%B4%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98\" aria-label=\"整数的精度问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>整数的精度问题</h2>\n<p>上面提到的 JavaScript 能表示的最大值，实际上 JavaScript 安全整数范围为：</p>\n<ul>\n<li>最大 (2^53 - 1)，Number.MAX<em>SAFE</em>INTEGER，9007199254740991</li>\n<li>最小 -(2^53 - 1)，Number.MIN<em>SAFE</em>INTEGER，-9007199254740991</li>\n</ul>\n<p>超过这个范围的数会有问题：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">19571992547450991</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 19571992547450990</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">19571992547450991</span><span class=\"token operator\">===</span><span class=\"token number\">19571992547450992</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> true</span></code></pre></div>\n<p>本质上都是因为 64 位浮点数存储的问题。</p>\n<p>当然，新的 es 特性中，引入了 bigint 类型，可以处理更大的数，这个留待有需要再去研究。</p>\n<h2 id=\"设计一个精确的浮点数运算函数\" style=\"position:relative;\"><a href=\"#%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%B2%BE%E7%A1%AE%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BF%90%E7%AE%97%E5%87%BD%E6%95%B0\" aria-label=\"设计一个精确的浮点数运算函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设计一个精确的浮点数运算函数</h2>\n<h3 id=\"浮点小数判断\" style=\"position:relative;\"><a href=\"#%E6%B5%AE%E7%82%B9%E5%B0%8F%E6%95%B0%E5%88%A4%E6%96%AD\" aria-label=\"浮点小数判断 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>浮点小数判断</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n* 严格判断 a + b === c\n* a、b、c 都为浮点小数，如 0.1 + 0.2 === 0.3\n*/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">check</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> c</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> digits <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Math.pow(指数，幂指数)</span>\n  <span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> digits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">return</span> a<span class=\"token operator\">*</span>m <span class=\"token operator\">+</span> b<span class=\"token operator\">*</span>m <span class=\"token operator\">===</span> c<span class=\"token operator\">*</span>m\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"精确的加法函数\" style=\"position:relative;\"><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E5%8A%A0%E6%B3%95%E5%87%BD%E6%95%B0\" aria-label=\"精确的加法函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>精确的加法函数</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n ** 加法函数，用来得到精确的加法结果\n ** 说明：javascript的加法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的加法结果。\n ** 调用：accAdd(arg1,arg2)\n ** 返回值：arg1加上arg2的精确结果\n **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">accAdd</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        r1 <span class=\"token operator\">=</span> arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        r1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        r2 <span class=\"token operator\">=</span> arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        r2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    c <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">abs</span><span class=\"token punctuation\">(</span>r1 <span class=\"token operator\">-</span> r2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    m <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> cm <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>r1 <span class=\"token operator\">></span> r2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            arg1 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            arg2 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> cm<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            arg1 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> cm<span class=\"token punctuation\">;</span>\n            arg2 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        arg1 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        arg2 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>arg1 <span class=\"token operator\">+</span> arg2<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> m<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"精确的减法函数\" style=\"position:relative;\"><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E5%87%8F%E6%B3%95%E5%87%BD%E6%95%B0\" aria-label=\"精确的减法函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>精确的减法函数</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n ** 减法函数，用来得到精确的减法结果\n ** 说明：javascript的减法结果会有误差，在两个浮点数相减的时候会比较明显。这个函数返回较为精确的减法结果。\n ** 调用：accSub(arg1,arg2)\n ** 返回值：arg1加上arg2的精确结果\n **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">accSub</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        r1 <span class=\"token operator\">=</span> arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        r1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        r2 <span class=\"token operator\">=</span> arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        r2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    m <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//last modify by deeka //动态控制精度长度</span>\n    n <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>r1 <span class=\"token operator\">>=</span> r2<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> r1 <span class=\"token operator\">:</span> r2<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>arg1 <span class=\"token operator\">*</span> m <span class=\"token operator\">-</span> arg2 <span class=\"token operator\">*</span> m<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"精确的乘法函数\" style=\"position:relative;\"><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E4%B9%98%E6%B3%95%E5%87%BD%E6%95%B0\" aria-label=\"精确的乘法函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>精确的乘法函数</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n ** 乘法函数，用来得到精确的乘法结果\n ** 说明：javascript的乘法结果会有误差，在两个浮点数相乘的时候会比较明显。这个函数返回较为精确的乘法结果。\n ** 调用：accMul(arg1,arg2)\n ** 返回值：arg1乘以 arg2的精确结果\n **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">accMul</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> m <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> s1 <span class=\"token operator\">=</span> arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> s2 <span class=\"token operator\">=</span> arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        m <span class=\"token operator\">+=</span> s1<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        m <span class=\"token operator\">+=</span> s2<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>s1<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>s2<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"精确的除法函数\" style=\"position:relative;\"><a href=\"#%E7%B2%BE%E7%A1%AE%E7%9A%84%E9%99%A4%E6%B3%95%E5%87%BD%E6%95%B0\" aria-label=\"精确的除法函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>精确的除法函数</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/** \n ** 除法函数，用来得到精确的除法结果\n ** 说明：javascript的除法结果会有误差，在两个浮点数相除的时候会比较明显。这个函数返回较为精确的除法结果。\n ** 调用：accDiv(arg1,arg2)\n ** 返回值：arg1除以arg2的精确结果\n **/</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">accDiv</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg1<span class=\"token punctuation\">,</span> arg2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> t1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> t2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> r1<span class=\"token punctuation\">,</span> r2<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        t1 <span class=\"token operator\">=</span> arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        t2 <span class=\"token operator\">=</span> arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">with</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        r1 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg1<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        r2 <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>arg2<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>r1 <span class=\"token operator\">/</span> r2<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token function\">pow</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> t2 <span class=\"token operator\">-</span> t1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://www.html.cn/archives/7340\">JavaScript 浮点数运算的精度问题-WEB前端开发</a></li>\n<li><a href=\"https://www.cnblogs.com/jikexianfeng/p/6407017.html\">程序员必知之浮点数运算原理详解 - 极客先锋 - 博客园</a></li>\n<li><a href=\"http://0.30000000000000004.com/\">Floating Point Math</a></li>\n<li><a href=\"https://www.ruanyifeng.com/blog/2010/06/ieee_floating-point_representation.html\">浮点数的二进制表示 - 阮一峰的网络日志</a></li>\n</ul>","fields":{"slug":"/content/WebFrontEnd-JavaScript 浮点数运算/"},"frontmatter":{"title":"JavaScript 浮点数运算","category":"WebFrontEnd","tags":"JavaScript 语言特性","date":"2020-09-06"}}},"pageContext":{"slug":"/content/WebFrontEnd-JavaScript 浮点数运算/"}},"staticQueryHashes":["3649515864"]}