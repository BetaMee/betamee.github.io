{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/Node-使用readline开发一个简单的nodejs命令行工具/","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"35deecf5-e2b5-5059-9714-fc783ee47c19","html":"<h2 id=\"前言\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>自从开了这个博客后，时不时需要完善下博客的功能。很早以前其实我也有一个博客，不过那个用的是 <a href=\"https://hexo.io/\">Hexo</a> 傻瓜式的框架，总觉得欠缺点什么，所以自从发现了 <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a> 这个静态页面生成器后，就彻底喜欢上了这个工具。</p>\n<p>这个工具的好处在于它提供了一套处理数据的接口，使用 graphql 进行查询，至于你用这个数据怎么玩，怎么展示，它不管，最终生成的是一个个静态页面。这就给了我非常高的自由度，可以自由定义页面、组件、功能。</p>\n<p>现在的这个 <a href=\"https://github.com/BetaMee/betamee.github.io\">GitHub 仓库</a>就是我用 Gatsby 进行开发的源码，所有的博客文章都在 <code>/content</code> 文件夹下。上周呢，我新增了 TravisCI 进行自动部署，它会在它自己的服务器上跑 <code>yarn run build</code>，然后将生成的 <code>public</code> 文件夹下的内容自动 deploy 到 <code>master</code> 分支上。 </p>\n<p>到这一步，基本上已经很自动化了，不过还有一个比较难办的问题，就是每次新增一个新的文件，都需要手动添加文件夹、添加新文件、添加新的 meta 信息。所以我想着自己搞一个命令行工具来解决这个痛点。这就是本次介绍的内容：<strong>使用readline开发一个简单的nodejs命令行工具</strong>。</p>\n<p>具体源码可见：<a href=\"https://github.com/BetaMee/betamee.github.io/blob/source-code/scripts/initblog.ts\">BetaMee/betamee.github.io</a></p>\n<h2 id=\"readline-对象\"><a href=\"#readline-%E5%AF%B9%E8%B1%A1\" aria-label=\"readline 对象 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>readline 对象</h2>\n<p>这里用到的第一个 nodejs api 是 <a href=\"https://nodejs.org/dist/latest-v10.x/docs/api/readline.html\">readeline</a>。</p>\n<p>这个 API 提供一个可以操纵 terminal 的接口：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> rl <span class=\"token operator\">=</span> readline<span class=\"token punctuation\">.</span><span class=\"token function\">createInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    input<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">,</span>\n    output<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">,</span>\n    prompt<span class=\"token punctuation\">:</span> QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>通过给定的 <code>input</code>、<code>output</code> 参数，readline 可以获取 Readable stream 和 Writeable stream。这里的 <code>process.stdin</code>、<code>process.stdout</code>，也就是标准输入输出，可以在命令行中获取输入的数据。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.84583901773534%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACLUlEQVQoz52R7UuTYRTGnz8hPxRFYR9KzJrBKJkSmeFsmqlhC9dm+NYLLbOJbXNjS1sQWiaSSRqlsjSzjVla4AtuamGD6Et/SCFRze15nl/bs1IJE+zAxX0451zXOec+QtNxDVfychg0FvL5ch51OWqMJjOvn4/jH5pgdGic4Sd+nnZ46bvrpcv5CNe1LqwN3VgtPXjsvbQ5HnPPPcCdlkGEvQey0erO8MbXz+RMgInAK7zDLwhNz/NxMcy74DzBmRChyRDh+TDByTlmpxeYm/3A7Mx7FhfC9Pe8pMXah8fVj6A6eARTZR0RYnyRYUmCSPz9/k0ktvSVaBzLP38gyiL/Mt/IFPbrD7ntik+oyiqg3tGezMjyKtYxOR5fC0mUlPio9y02831u2vsQ8vVmLO5OJEkiISP9RdoICU7C/CPTNFu68bjjK2tyT2N2P1AK1ptiY8EkJxAI0tHuo7PDjxA0HGbUUb/STf6PCVtb26gxWXnWO4XwqSqL9gtGYqK4aUHxN8fhvEXqnkNUV91AyEzLoNxQG0/GlKTyl5sUtDe3sjNVRfr+bISULSkU6opWDpssThwniY0O/2flJquLfWotWbllCLu2baVYp1O6rXaV1kBe8ZdjEpGoqAglEI1GFUFnSxuawmrSM48i7N6xnYy0NE7kayk9VUZpSTkmfQUXzxmwVRu5qi+hodLIQON5xpw12GuMFJw8S+UlGxW1jRSXGcjJL0d9TI9KU8Qv3rgQRnAJb6sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f8214d5253ea1c3641a91e36c82a3f99/5d675/std.png\"\n        srcset=\"/static/f8214d5253ea1c3641a91e36c82a3f99/1abb1/std.png 250w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/7217d/std.png 500w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/5d675/std.png 1000w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/48e1d/std.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>命令行</center>\n<p>初始化后，我们就可以使用 <code>rl</code> 实例对象进行操作了。</p>\n<p>首先调用方法出提示：<code>rl.prompt()</code>：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.84583901773534%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACUUlEQVQoz5WP7UuTYRSHnz8hPxRFYR9imKmQlEw/aJbWNFNDJs5p+EIJrbKJzunY0gxCSUUySSW0WGriUFQSFV+njSSiEKMwoiI/VQQKLdv2PFePc74khXjgd3O4zznX+R2h8KQSXXQEj7QqZvOiyQ0PJV17md62XmyP+3li7aPtgY2WGivN1VbqTPcxX6vDkF+PQd9AhbGRytJm7lhauV32EEERFM4plZo+Wyuj4z2MDPTT3mljYmyaF44Znk1M45hyMDVqZ3LYzvjQJCOyhgcnGRyYwGF/TktDF2WGJirMLQhBRyPJSdXyeX6Wubfz2KfneP/pC0sfF1j+8R334iIu9y+cHidO509ESWQjJO/b1T6E8fo9bpllh0FKFUV6M0sf3vH1zTwDHa+YeT0H3xZ87VtC/pQkyStRXIV3Wp9SrKvhhrEJIUatQ2+plbvEv+dEaX3wf1oD2jqGKdHXU2GRT1ZGnUdnubvaJBfdHgmPL98euHpDd/cY1VVd1FbbEMY0x+ksvbq+bTvIvxyWl1eSk2HA2jiE8DIrjKqLWtmZZ8dAj2+m1HQT/0PHyM4qQghRBJKiyZWLbm9xZetOgcaScvb7BxNwJBzBb5cfcap4uYFNDmWwT9ImbY21kwsNZg6HxhIWlYxwYM9uElQq77aNreImSev5b7fIssvjBa3I5XJ5gaaySpRx2QSERCIc3LeXQIWCMzGxJJ1LJikxhQx1GpfSNRRna7miTiQ/U0trwQV6TDkYc7ScPptKZl4xabkFJCRriIhJIfSEmmBlPH8AmgYMDnWge04AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f9d9c8ee4313133e65071feac25ae91c/5d675/prompt.png\"\n        srcset=\"/static/f9d9c8ee4313133e65071feac25ae91c/1abb1/prompt.png 250w,\n/static/f9d9c8ee4313133e65071feac25ae91c/7217d/prompt.png 500w,\n/static/f9d9c8ee4313133e65071feac25ae91c/5d675/prompt.png 1000w,\n/static/f9d9c8ee4313133e65071feac25ae91c/48e1d/prompt.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>然后注册 <code>line</code> 事件和 <code>close</code> 事件：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">rl<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理输入事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理关闭事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code>line</code> 事件只会在键盘输入 <code>\\r\\n</code> 、<code>\\r</code> 、<code>\\n</code> 才会触发回调函数，也就是我们习惯上常用的 <code>Enter</code> 键或者是 <code>Return</code> 键。</p>\n<p>在 <code>line</code> 事件的回调函数中，才是我们需要关注的部分，这里我们将用来处理输入的内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSetDataFromReadline</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>MetaResult<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// 文章</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// 类别</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// 标签</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// 打赏</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 存入数据</span>\n        MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 进行下一步提问</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'输入只能为 y or n\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">// 退出</span>\n      <span class=\"token comment\">// 关闭命令行</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这段程序的大意是对于捕获到的 <code>line: string</code> 参数进行处理，处理的方式也很简答，就是非常普通的 <code>swtich</code> 表达式来区别处理不同批次的内容，如第一行处理完后才能进行到第二行，否则程序会报错。这也是使用命令行经常见到的：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.84583901773534%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACXElEQVQoz5WQ7UvTURTHf39CviiKwl6UmKWFlE2hzHD5kKlhC+dmOKWMVplic7o2fIJQ0pBMUimtZqbMrJRCl5lOG5L0Iu2N0JseKRB0VtP28Ps0p+aoCDvwvfdyz7mf8z1XyN8v4VRUBLeUcYydjCIrIpQ0pZqHrV10tHTTZuzizvUOmqqNNFYZqdFdQ3+2Bk1OLZrcOsq09VQUNXLJ0MzF4psIm7eFI405Qlf7Dfr67mHufkBLazsDTyyMWkd4PjCMdcjK0FMLg2YLz3oH6fPI3DNIz+MBrJYRmutMFGsaKNM3IQTv2EOqXMW7Lx+Z+DzJ6MQnPtjszEzNMjc1idNmw+Gcxe6yY7d/xy26WQ7Ru5pae9Geu0q53uNw++4YsvPLGR9/xYvhMS6UjmJ6/dZbLPKX8FyKouiV270Ab7v9iAJ1NQZtA4JUpiZHX41txsb09Dcm3th4P/11ASj+W0vAjrtmCnNrKTN4RpZEHkZtuPKnEXElwIUZOjv7qao0cbmqA6Ffvov2ojO4XG7vOPO7ewUwX4clJRVkKjUY63sRXmaEUXlcgdPlWrGzJbkW3xTpSvHftBNVxnmEkIAgUuRZnqTTm5zv+r9AbWEJ6/2DCdwajuC3yo+42HhPge/fecCLEn30eyyNnK/RsyVUSlhkMsKGNatJiI31dlvu6vaR+Ov8w+lmzuHygublcDi8QF1xBZI4FYEhexE2rltLUEAAMdFSkg4lk5SYglKWyok0OQUqBadlieSkK2jOO8Z9XSbaTAUHDh4lPbuA1Kw8EpLlRESnELpPRrAknp+tJQs0proTAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"input error\"\n        title=\"input error\"\n        src=\"/static/82ae0d026fedfe3cd199bd404add600e/5d675/error.png\"\n        srcset=\"/static/82ae0d026fedfe3cd199bd404add600e/1abb1/error.png 250w,\n/static/82ae0d026fedfe3cd199bd404add600e/7217d/error.png 500w,\n/static/82ae0d026fedfe3cd199bd404add600e/5d675/error.png 1000w,\n/static/82ae0d026fedfe3cd199bd404add600e/48e1d/error.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>最后当都完成问题后，调用 <code>rl.close()</code> 来关闭命令行，这时候会触发 <code>close</code> 事件。在 <code>close</code> 事件的回调函数中，我们可以对输入获取到的数据进行处理，比如生成一个文件或者其他工作：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.84583901773534%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACj0lEQVQoz5WR60uTYRiH3z+hPhRFYR/KzNJESpZQZriaZibZwjkNp50oy4ya06F4CCtriJFRGa5MMzygqVCazJVKB7IyoyCC+hKlVuBx6vbuvXqda3jAD93wg4f7eX7XfXiEszsUHA8Npjw+nN5joSQHBxIXf5zGqibqKpuprmzi/u06zKZ7lJoqKDbeIOtUMfrUa+jTrpNvuMmlzFKuZJu5kHMXYc2GLShV+2muKaOlrZ5HjQ+prKrhaVsH3S9e0WXt5KnlGe2tFjotXVgeW7E86cRqeYGlrYvnHS8xl9SQo79FfpYZwS9gK5o4Hd9//eBz/x/ef+uj32ZjdNDG+O9+Rgb6mZgcY1y0YZPzTklkbtRWtWI4XcL5LLnDjQoVh9Ly6HnXTUfLW9YGNKEts/Lp4xf6hkYZGhlBFJ2zAJIkueR05x+UN5N+oohswy0EpTqFU8bL9H58T3fPJwpMryko6eFB7Vc+/BwA0YHDbpehogfkATqngTVyhxlp18iX9ygoQvaRkn0Vm9POsFxRtjL1zDEuG4YHsQ8NMmEbw+FwzOpuGii5cg31VkyFtRSZ6hDaNZupzjyJ5L6Ul+R6LFvn7WqhDnNzL5IUr6fiZivCm8QgCg9rcYiimyfNMy4k0e3JNObhtXoTusRzCP7evsRokuXL6ZGmqv4v0JCRywovP3zWb0FYvGgx4aoIJGnmWK7JXZJmaG78G/msPot1gUqCQqIRVi5dQqRK5fnF6arOGZI850mHkwm76AJNyS7//lQYcy6hCNfh478NYdXyZfh6e7MrTMnePdHsjYohXh3LkTgN6TotKeooUhO03DlzkAZjEoYkLTt3HyDhaDqxyWeIjNYQHBZD4HY1fooI/gIDNASr5c2qOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done1\"\n        title=\"done1\"\n        src=\"/static/d9b4e793205ec0159eaeaf7085f620fd/5d675/done1.png\"\n        srcset=\"/static/d9b4e793205ec0159eaeaf7085f620fd/1abb1/done1.png 250w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/7217d/done1.png 500w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/5d675/done1.png 1000w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/48e1d/done1.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1000px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.181451612903224%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABIElEQVQoz4WQ7XKCMBBFeYniByBVYANEEhIgICjVvv873a61daatbX+c2WSSuzkbb55n9MMAYy1KKVGWJXKpoEwLw9T32kHVLbS2kFWNmGrscos4VXjO9B2vmc5wlxnuOMEcelgmFRVWcQlRORR6QK4PvO6R2yOI646DybUhk3zD606vOF/O6F2HSmm2MUhpj0WUIxAaoTAI8wYBGd5brBOFRUh8Lh7imfEI03aglEAZQZDAZktYxgWifYPYDAgLi1VSwQ+y92Y+B/1rfYBXH0aYqYc0Cto1oEIg+mgYksaaLVc7ieWm+NXqi2HjRjT8h+Y0wk7M0GObSTwFdLNhq8/XF+Et5P81su0GjNOJ/3DAy3xB1zoe+Rr6edmP6F/DNzxrzFNGi0GTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done2\"\n        title=\"done2\"\n        src=\"/static/1d2fc7931a817adb34c13e99e8068c92/5d675/done2.png\"\n        srcset=\"/static/1d2fc7931a817adb34c13e99e8068c92/1abb1/done2.png 250w,\n/static/1d2fc7931a817adb34c13e99e8068c92/7217d/done2.png 500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/5d675/done2.png 1000w,\n/static/1d2fc7931a817adb34c13e99e8068c92/b0eb8/done2.png 1500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/6e7e2/done2.png 1984w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"fs-对象\"><a href=\"#fs-%E5%AF%B9%E8%B1%A1\" aria-label=\"fs 对象 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs 对象</h2>\n<p>上一节中提到的生成文件的工作，就是由 <code>fs</code> API 提供的，这里用到的也很简单，见代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> promisify <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'util'</span>\n\n<span class=\"token keyword\">const</span> fsMkdirAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fsWriteFileAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>writeFile<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleCreateNewTemplate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// tslint:disable-next-line: max-line-length</span>\n  <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">---\\r\\ntitle: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ndate: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">createDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ncategory: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ntags: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\nopenreward: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\n---</span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">const</span> newPostDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDirPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token comment\">// 创建目录</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsMkdirAsync</span><span class=\"token punctuation\">(</span>newPostDir<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建文件</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsWriteFileAsync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/index.md</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> metaInfo<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建成功后关闭</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'再见!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里用到的是生成目录 <code>fs.mkdir</code> 和 <code>fs.writeFile</code> 两个方法，至于 <code>promisify</code> 这个方法是用来将 <code>fs</code> 的方法 promise 化的一个工具函数，因为如果不用 promise 的话，就要用到回调函数方式，而我讨厌回调函数。</p>","fields":{"slug":"/content/Node-使用readline开发一个简单的nodejs命令行工具/"},"frontmatter":{"title":"使用readline开发一个简单的nodejs命令行工具","category":"Node","tags":"Node cli","date":"2019-08-18"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/content/Node-使用readline开发一个简单的nodejs命令行工具/"}}}