{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/Node-使用readline开发一个简单的nodejs命令行工具/","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"35deecf5-e2b5-5059-9714-fc783ee47c19","html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>自从开了这个博客后，时不时需要完善下博客的功能。很早以前其实我也有一个博客，不过那个用的是 <a href=\"https://hexo.io/\">Hexo</a> 傻瓜式的框架，总觉得欠缺点什么，所以自从发现了 <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a> 这个静态页面生成器后，就彻底喜欢上了这个工具。</p>\n<p>这个工具的好处在于它提供了一套处理数据的接口，使用 graphql 进行查询，至于你用这个数据怎么玩，怎么展示，它不管，最终生成的是一个个静态页面。这就给了我非常高的自由度，可以自由定义页面、组件、功能。</p>\n<p>现在的这个 <a href=\"https://github.com/BetaMee/betamee.github.io\">GitHub 仓库</a>就是我用 Gatsby 进行开发的源码，所有的博客文章都在 <code>/content</code> 文件夹下。上周呢，我新增了 TravisCI 进行自动部署，它会在它自己的服务器上跑 <code>yarn run build</code>，然后将生成的 <code>public</code> 文件夹下的内容自动 deploy 到 <code>master</code> 分支上。</p>\n<p>到这一步，基本上已经很自动化了，不过还有一个比较难办的问题，就是每次新增一个新的文件，都需要手动添加文件夹、添加新文件、添加新的 meta 信息。所以我想着自己搞一个命令行工具来解决这个痛点。这就是本次介绍的内容：<strong>使用readline开发一个简单的nodejs命令行工具</strong>。</p>\n<p>具体源码可见：<a href=\"https://github.com/BetaMee/betamee.github.io/blob/source-code/scripts/initblog.ts\">BetaMee/betamee.github.io</a></p>\n<h2 id=\"readline-对象\" style=\"position:relative;\"><a href=\"#readline-%E5%AF%B9%E8%B1%A1\" aria-label=\"readline 对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>readline 对象</h2>\n<p>这里用到的第一个 nodejs api 是 <a href=\"https://nodejs.org/dist/latest-v10.x/docs/api/readline.html\">readeline</a>。</p>\n<p>这个 API 提供一个可以操纵 terminal 的接口：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> rl <span class=\"token operator\">=</span> readline<span class=\"token punctuation\">.</span><span class=\"token function\">createInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    input<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">,</span>\n    output<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">,</span>\n    prompt<span class=\"token operator\">:</span> QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>通过给定的 <code>input</code>、<code>output</code> 参数，readline 可以获取 Readable stream 和 Writeable stream。这里的 <code>process.stdin</code>、<code>process.stdout</code>，也就是标准输入输出，可以在命令行中获取输入的数据。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACO0lEQVQoz6WR/UtTYRTH71/gDxFBIZoZUaaGLJs530UTcpWvQWQmgdaW4hAznUpGJShaIOrSfMmyUDJIVhRFUC1G3sWk/RVBu1c3c5S799N1upJ+CLQDHw7Pc57z5XvOI1SlpVCZmc5YZSGiKZ+qrDTOV9Xx7PEsM4/sTE3OMjk8zUj3OEPdE9y2DtBu6aO5YYCWxkE6rUN0WYfpahvlZvs4wp4DeopLKnC8t/NadPD23Qeev3rDJ4eIx+VC/OjE6XAiOufwuD3MOUVcc27cn7/gEufxzHu41zdNe6ONjtZRhLiEVEy1DazGkgoBLa9o/AyoqMtLGt9Rgiv8KyZGZrla38/11jGEQ6nHab7Vv1ZRFFDVNdAENzSp2p2qqL+zEkIJ1cZtMzSZemlrsiHklJpp6Rxc01PXGzbBakzef4FV2+eNa9oO09M0h513/7jYguCDCTu93U+40zOD4K7QYe+whOfalFh45Lq6K5wpq+Wh7SXC0xIdHeaaLTkMC16ubSQqVkdpWQ1CVPQ+zl0wr/+JEkJVN/DXOfxmlWAwGOqrvlhPZHQC++OPImyLiKC8tJz/iepLFhJTT6AzFCJE7thOWVERPp8Pr1dC8npZXpT54ZNY8csEFiUCvgWUJRlZlvn6TcIrScgLi6H3fr8fk6UN/bFK9sZpDmN27SR2dwyJB+PRJ6eQos8gNz0bY04uZwtyOWU4wun8PHoqCpgyG6k25pFwOIsCbV/ZxnMkJWeSZDCSaDhJUkYxvwA83AzfgSADUgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f8214d5253ea1c3641a91e36c82a3f99/00d43/std.png\"\n        srcset=\"/static/f8214d5253ea1c3641a91e36c82a3f99/63868/std.png 250w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/0b533/std.png 500w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/00d43/std.png 1000w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/e2d3b/std.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>命令行</center>\n<p>初始化后，我们就可以使用 <code>rl</code> 实例对象进行操作了。</p>\n<p>首先调用方法出提示：<code>rl.prompt()</code>：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACYElEQVQoz6WS/UuTURTHn7/AHyKCQjQzIswXxGzWfElFE2qlpgaRzoq0XJqLTM0pGkViKIKIK01N0zA0UMQkgiRMpnOTMHszkKKIwu3RKUpzez7N6UIqSOrAh8u995zvud/DFU6GhqCMCKNZqWA0K5b0CDnK9Gy673fT1d5LR1sP7Q2dNFW2Uu+guqiOEnUNBRdrKbxUR7nmNhVF9VQUN3K9pBlhm4+M+MRUBgZ6GDA8Q6cb5PGTpwwPGRgfNWDUjTBmMDI6omfk+Qh63Sj6YSPDOgO6IT3jL17SUPOAkjwtZZpGBJ+AUC6cOsPnyQnGjRM86jPy6v0Uix8+sTRvQVpYwC4tYZWsWK1W/hQtd3ooyK3lqqYJIUCuoFRTjvXLR6bfTjHY/5o37yZB/IbkqpBWWV4kCbvdhd151qztIj+riuJ8LUJUkoor5drfukqrxX9jOdru9lGUV8e1UscMw0IPUnjjlvNiuavN5ui8DqG1gq0tvVTd7KS6sgthLDWI3jK1y8+6hVasr1jOybnM8eRs7mn7ER4eDaJMlflzPv8ieD47Dw/vIJKSMxE8PHeQdlq1atnuRJLW8MvelbOMzWZz1mWczcXd04+dvnsRNri5kZKUwv9Exjk1/vsOEyQ/hOC+aSPJCQlYLBZMJjNmk4mFWZHvFjNLcyKLs2YWLTPY50VEUeTrtBmT2Yw4M+vMn5ubI0tdjOyAku0+jhd6bdmM91Yv/Hf5IgsOIUQWTnRYJIqoaE7ERRMv38Ox2BgqU+PoUCnIUMTgt3s/cY55RSrSCAyOINDxl/3lRwgMT+QHIu8Iw7aqTu0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f9d9c8ee4313133e65071feac25ae91c/00d43/prompt.png\"\n        srcset=\"/static/f9d9c8ee4313133e65071feac25ae91c/63868/prompt.png 250w,\n/static/f9d9c8ee4313133e65071feac25ae91c/0b533/prompt.png 500w,\n/static/f9d9c8ee4313133e65071feac25ae91c/00d43/prompt.png 1000w,\n/static/f9d9c8ee4313133e65071feac25ae91c/e2d3b/prompt.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>然后注册 <code>line</code> 事件和 <code>close</code> 事件：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">rl<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理输入事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理关闭事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code>line</code> 事件只会在键盘输入 <code>\\r\\n</code> 、<code>\\r</code> 、<code>\\n</code> 才会触发回调函数，也就是我们习惯上常用的 <code>Enter</code> 键或者是 <code>Return</code> 键。</p>\n<p>在 <code>line</code> 事件的回调函数中，才是我们需要关注的部分，这里我们将用来处理输入的内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSetDataFromReadline</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>MetaResult<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 文章</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 类别</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 标签</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 打赏</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 存入数据</span>\n        MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 进行下一步提问</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'输入只能为 y or n\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 退出</span>\n      <span class=\"token comment\">// 关闭命令行</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这段程序的大意是对于捕获到的 <code>line: string</code> 参数进行处理，处理的方式也很简答，就是非常普通的 <code>swtich</code> 表达式来区别处理不同批次的内容，如第一行处理完后才能进行到第二行，否则程序会报错。这也是使用命令行经常见到的：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACXUlEQVQoz6WR7UvTYRSGf3+BHyKCQjQzInyDYaY1X1LRhFqlqUGoMwQtp+IiU3GTjLIwJoKIluJLpmFooEhIUBnVmNucVIJBX4yILNzmNp25ud/VpgllQUkHLh4O3Pfh3OcRzsXGIE+Io1suw6hIJT8hFnl+KcP3RxjqH2Wgb4T+jkG6NL20e2mqaaVW2UzVxRaqL7VyU3WHhpp2GtSdXK/tRtgTEk16Rg7jz4YZNz5Hq33B2OMnTLw08NZoxKTTMzVpwqg3oH+lx6AzYpgwMaGbRKf1al5P09H8gNqKNupUnQihEVIKCkv5ND/HzOwcTw0fmLU5WXas4F60ITqdeEQ3LtGFy+XiT9XTMUxVeQtXVV0IklgZSrWGdzPTaMffoKo3Mfr+45rQs+EQf+B7RBGPZ4N1RVfbEJXFjagr2xCSMkuorm/F7XaxtPSNz1+dWJ3LPuea+W/4qq/nETUVrVy74r1hXOwxqm/c/i2GuIWBvXdHabw1SJNmCGEqN5LROuUvcf512EbksrLLnM0q5V7bGMLD05HUKYq2tNXmgSWlFQQER5KZVYQQELiPvALF+id4BT5E8Sc29RsaH6urq2u+wvPl+AeGsz/sEMI2Pz+yM7P5nyq8oCTi8AkipccR/HdsJys9HbvdjtlswWI247RZWbFbcDusLNssLNsX8CxasVqtfJm3YLZYsC7Y1vQOh4NipZroo3L2hng3DNq1k+DdQUSEhhEdFUNMdDzJcYnIkpLJSUvmlPQgZ1JT0OSmMaCQUShLIfzAEdK890qU5SGJSkAilREhPYkkPoPvY/IIA7B4qOgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"input error\"\n        title=\"input error\"\n        src=\"/static/82ae0d026fedfe3cd199bd404add600e/00d43/error.png\"\n        srcset=\"/static/82ae0d026fedfe3cd199bd404add600e/63868/error.png 250w,\n/static/82ae0d026fedfe3cd199bd404add600e/0b533/error.png 500w,\n/static/82ae0d026fedfe3cd199bd404add600e/00d43/error.png 1000w,\n/static/82ae0d026fedfe3cd199bd404add600e/e2d3b/error.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>最后当都完成问题后，调用 <code>rl.close()</code> 来关闭命令行，这时候会触发 <code>close</code> 事件。在 <code>close</code> 事件的回调函数中，我们可以对输入获取到的数据进行处理，比如生成一个文件或者其他工作：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACj0lEQVQoz6WS60vTYRTHf3+BL6KCQjSzIryBmWnNSyqaUKs0LxB5iULLG0qYmRcyDEFRJElFzTRFM01YmERCUpk551RUiqyoSAjNbbrN+7ZPv2mTEUIvOg8feM7znPM9zzk8wkUfb+L8fWmIl6JICiHe34e4+FRkrTI6Wrp41PyU5prH1Jc0UlvaRHlOFfkZFWRfq+RmZhVFOTUU59RSnFfPnfwGhL1OXoSFx/CqV0aP4jV9/W940fOSgb4hJoaHUfbLkQ/IGeh/x9CAEvnbQZSKEYaVYwwpRhkfHaeuoo38zGoKcusRnN0kXE5M46f6Fx++T9Or/ME3nY5l3QLL4pludpY1wwqr5rW6ylbWWCfjRvo9buc+QDjkIyUlu5ix0UG62+Xs2N9JdGUPCsVHprR69IuLGI2mzWSTybTub2BcP6uvbCcrqYy8rGqEwMhUsgrvMvl1kpH3n7nfMkFD6ydk3VN8mZmBlWVWRAwGg6i2IWiN2ZobnpEjzrPwljhDX5+TZBdVY661IFbdfItB3C3qWdXrRc2lDUG2Fmx62EVZSQflpU8QRmI86CrIsPSDyfgHrMSt2rXG0nJa2nXOi502Vz9H6DznQUFy4pYJ/8IimJKaiZ2jBxGRiQh29geIvZS8fmEOMGMyWfGXb4kxYxlDwpV0bO1dOehyFGGbjQ1REVH8jyVczcDt2Gk8JKcQbHduJzIsDK1Wi0qlRq1SsTivYUWrZk2nYWlezZJ2DqNeg0ajYXpWjUqtRjM3vx6vE/9sUkYeXifi2OckvtBh9y4c9zjg5uyCl6c33l5+BPkGIA0M4kJoEGclR4gOCaY0JpS2ZCkJ0mBcDx8nVJxXgDQWd09/3CVS3CRncPcL5zcsnAFiYMWssAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done1\"\n        title=\"done1\"\n        src=\"/static/d9b4e793205ec0159eaeaf7085f620fd/00d43/done1.png\"\n        srcset=\"/static/d9b4e793205ec0159eaeaf7085f620fd/63868/done1.png 250w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/0b533/done1.png 500w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/00d43/done1.png 1000w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/e2d3b/done1.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABHklEQVQoz3WR6XKDIBSFfYkuGc1SjYBGEVADxLjN9P1f6fSaJm3Tpj++OWz3cLgE3TTBTwPcuYNqa6jGQBwkYi5RVEdIZVGSlqQ56UE2YJlCzCq8pYqo7giacUI7D7B9B+0djLfgeYXVNgMrWjLxEAulhdAdhHRIyGjPFJIHBH5+xzjP8M5CVgpaa/CsxMuaI2QSEdeIRI3wogYhmS17C69X/UnQ9iNq68BTDpYyCMaxi+nwRmCdG2y1Q5TXWO0lniP2CRV+jX9BTx5heo9claiohzwX2MTpxTCiPoVCYZUUNM+uKdifVPcJzyMa6qEeTjCdh6Gn70WBp5AKl1vDlPhOsBTdEj40dN2A05k+5egw9BOc9dgl4t+C/9ZvfAA1Ds0PBhZz1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done2\"\n        title=\"done2\"\n        src=\"/static/1d2fc7931a817adb34c13e99e8068c92/00d43/done2.png\"\n        srcset=\"/static/1d2fc7931a817adb34c13e99e8068c92/63868/done2.png 250w,\n/static/1d2fc7931a817adb34c13e99e8068c92/0b533/done2.png 500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/00d43/done2.png 1000w,\n/static/1d2fc7931a817adb34c13e99e8068c92/aa440/done2.png 1500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/2adcb/done2.png 1984w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"fs-对象\" style=\"position:relative;\"><a href=\"#fs-%E5%AF%B9%E8%B1%A1\" aria-label=\"fs 对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs 对象</h2>\n<p>上一节中提到的生成文件的工作，就是由 <code>fs</code> API 提供的，这里用到的也很简单，见代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> promisify <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'util'</span>\n\n<span class=\"token keyword\">const</span> fsMkdirAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fsWriteFileAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>writeFile<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleCreateNewTemplate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// tslint:disable-next-line: max-line-length</span>\n  <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">---\\r\\ntitle: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ndate: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">createDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ncategory: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ntags: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\nopenreward: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\n---</span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">const</span> newPostDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDirPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token comment\">// 创建目录</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsMkdirAsync</span><span class=\"token punctuation\">(</span>newPostDir<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建文件</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsWriteFileAsync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/index.md</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> metaInfo<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建成功后关闭</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'再见!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里用到的是生成目录 <code>fs.mkdir</code> 和 <code>fs.writeFile</code> 两个方法，至于 <code>promisify</code> 这个方法是用来将 <code>fs</code> 的方法 promise 化的一个工具函数，因为如果不用 promise 的话，就要用到回调函数方式，而我讨厌回调函数。</p>","fields":{"slug":"/content/Node-使用readline开发一个简单的nodejs命令行工具/"},"frontmatter":{"title":"使用readline开发一个简单的nodejs命令行工具","category":"Node","tags":"Node_Basic API","date":"2019-08-18"}}},"pageContext":{"slug":"/content/Node-使用readline开发一个简单的nodejs命令行工具/"}},"staticQueryHashes":["3649515864"]}