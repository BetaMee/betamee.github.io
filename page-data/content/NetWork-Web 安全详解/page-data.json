{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/NetWork-Web 安全详解/","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"5ba5a486-50e1-5b5c-8fa8-9cffbbe541ca","html":"<h2 id=\"目录\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E5%BD%95\" aria-label=\"目录 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目录</h2>\n<!-- toc -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li>\n<p><a href=\"#XSS-%E6%94%BB%E5%87%BB\">XSS 攻击</a></p>\n<ul>\n<li><a href=\"#%E5%8F%8D%E5%B0%84%E5%9E%8B\">反射型</a></li>\n<li><a href=\"#DOM-%E5%9E%8B\">DOM 型</a></li>\n<li><a href=\"#%E5%AD%98%E5%82%A8%E5%9E%8B\">存储型</a></li>\n<li><a href=\"#CSP-%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5\">CSP 安全策略</a></li>\n<li><a href=\"#httpOnly\">httpOnly</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#CSRF-%E6%94%BB%E5%87%BB\">CSRF 攻击</a></p>\n<ul>\n<li><a href=\"#%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B%E5%8F%8A%E9%98%B2%E8%8C%83\">攻击流程及防范</a></li>\n<li><a href=\"#%E8%B7%A8%E7%AB%99%E5%92%8C%E8%B7%A8%E5%9F%9F%E4%B9%8B%E5%8C%BA%E5%88%AB\">跨站和跨域之区别</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81\">点击劫持</a></li>\n<li><a href=\"#URL-%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E\">URL 跳转漏洞</a></li>\n<li><a href=\"#SQL-%E6%B3%A8%E5%85%A5\">SQL 注入</a></li>\n<li><a href=\"#%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB\">中间人攻击</a></li>\n<li><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>\n<!-- tocstop -->\n<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>作为前端工程师，Web 安全也是一个值得操心的领域，前端页面作为站点的入口，必须担起一定的防御责任，以免被恶意爆破。</p>\n<p>对于前端工程师来说，常见的是这样的一些安全问题：</p>\n<ul>\n<li>XSS 攻击</li>\n<li>CSRF 攻击</li>\n<li>点击劫持</li>\n<li>URL 跳转漏洞</li>\n<li>SQL 注入</li>\n<li>中间人攻击</li>\n</ul>\n<p>以及对于此些要做的安全措施，本文将详细整理。</p>\n<h2 id=\"xss-攻击\" style=\"position:relative;\"><a href=\"#xss-%E6%94%BB%E5%87%BB\" aria-label=\"xss 攻击 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XSS 攻击</h2>\n<p>XSS (Cross-Site Scripting) 中文名为<strong>跨站脚本攻击</strong>，是一种<strong>代码注入攻击</strong>。攻击者在目标网站上注入恶意代码，当被攻击者登陆网站时就会执行这些恶意代码，这些脚本可以读取 Cookie，Session tokens，或者其它敏感的网站信息，对用户进行钓鱼欺诈，甚至发起蠕虫攻击等。</p>\n<p>XSS 的本质是：恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，利用这些信息冒充用户向网站发起攻击者定义的请求。</p>\n<p>XSS 攻击有三种方式：反射型、存储型、DOM 型</p>\n<h3 id=\"反射型\" style=\"position:relative;\"><a href=\"#%E5%8F%8D%E5%B0%84%E5%9E%8B\" aria-label=\"反射型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>反射型</h3>\n<p>反射型 XSS 可以理解为将恶意代码从服务端\"反射\"过来，在浏览器上执行，一般以这样的步骤发生：</p>\n<ul>\n<li>\n<p>攻击者构造出特殊的 URL，其中包含恶意代码。</p>\n<ul>\n<li>如 <code>http://www.test.com?type=&#x3C;script>恶意脚本&#x3C;/script></code></li>\n</ul>\n</li>\n<li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li>\n<li>\n<p>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</p>\n<ul>\n<li>执行 <code>&#x3C;script>恶意脚本&#x3C;/script></code></li>\n</ul>\n</li>\n<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作</li>\n</ul>\n<p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p>\n<p>值得注意的是，在 Chrome 和 Safari 上能够检测到 URL 上的 XSS 攻击，从而将网页拦截掉，但是其它浏览器不行，如 Firefox。</p>\n<p>那么如何进行防范？记住最重要的一条原则，<strong>不要信任用户的任何输入信息</strong>，将前端传递过来的 url 查询参数进行转义后再输出到页面。</p>\n<h3 id=\"dom-型\" style=\"position:relative;\"><a href=\"#dom-%E5%9E%8B\" aria-label=\"dom 型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DOM 型</h3>\n<p>DOM 型 XSS 攻击，来源于前端 JavaScript 代码有漏洞，把不可信的内容插入到了页面。在使用 <em>.innerHTML</em>、<em>.outerHTML</em>、<em>.appendChild</em>、<em>document.write()</em> 等API时要特别小心，不要把不可信的数据作为 HTML 插到页面上，尽量使用 <em>.innerText</em>、<em>.textContent</em>、<em>.setAttribute()</em> 等。</p>\n<p>DOM 型 XSS 的攻击步骤：</p>\n<ul>\n<li>\n<p>攻击者构造出特殊数据，其中包含恶意代码。</p>\n<ul>\n<li><code>&#x3C;script src='外链'>恶意脚本&#x3C;/script></code></li>\n</ul>\n</li>\n<li>\n<p>用户浏览器执行了恶意代码。</p>\n<ul>\n<li><code>document.write(&#x3C;script src='外链'>恶意脚本&#x3C;/script>)</code></li>\n</ul>\n</li>\n<li>\n<p>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</p>\n<ul>\n<li>执行 <code>&#x3C;script src='外链'>恶意脚本&#x3C;/script></code></li>\n</ul>\n</li>\n</ul>\n<p>DOM 型和反射型最大的区别在于 DOM 型不涉及到跟服务端交互，DOM 型攻击核心在于动态修改了页面，要防范这种攻击，也需要像反射型一样，<strong>过滤用户的输入</strong>，防止将不可信的内容输出到页面上。</p>\n<h3 id=\"存储型\" style=\"position:relative;\"><a href=\"#%E5%AD%98%E5%82%A8%E5%9E%8B\" aria-label=\"存储型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>存储型</h3>\n<p>存储型 XSS 攻击会将恶意代码永久储存在服务器上，当浏览器请求数据时，脚本从服务器传回并执行，影响范围比反射型和 DOM 型 XSS 更大。存储型 XSS 攻击的原因仍然是没有做好数据过滤：</p>\n<ul>\n<li>前端提交数据至服务端时，没有做好过滤</li>\n<li>服务端在接受到数据时，在存储之前，没有做过滤</li>\n<li>前端从服务端请求到数据，没有过滤输出</li>\n</ul>\n<p>存储型 XSS 的攻击步骤：</p>\n<ul>\n<li>攻击者将恶意代码提交到目标网站的数据库中。</li>\n<li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li>\n<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li>\n<li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li>\n</ul>\n<p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p>\n<p>如何防范存储型XSS攻击：</p>\n<ul>\n<li>前端数据传递给服务器之前，先转义/过滤(防范不了抓包修改数据的情况)</li>\n<li>服务器接收到数据，在存储到数据库之前，进行转义/过滤</li>\n<li>前端接收到服务器传递过来的数据，在展示到页面前，先进行转义/过滤</li>\n</ul>\n<p>除了进行数据过滤，还可以用 CSP 安全策略。</p>\n<h3 id=\"csp-安全策略\" style=\"position:relative;\"><a href=\"#csp-%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5\" aria-label=\"csp 安全策略 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSP 安全策略</h3>\n<p>CSP（Content Security Policy，网络安全策略）是为了解决恶意的外部脚本攻击（XSS 攻击）和数据注入等攻击而设计的，它的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。</p>\n<p>有两种方式开启 CSP：</p>\n<ul>\n<li>一种是通过设置 HTTP 头信息 Content-Security-Policy 的字段</li>\n<li>另一种是通过网页的 meta 标签</li>\n</ul>\n<p>下面是几个常见的例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 默认配置，限制所有的外部资源，都只能从当前域名加载\nContent-Security-Policy:  default-src &#39;self&#39;\n\n// 详细配置了不同资源的加载策略\nContent-Security-Policy: img-src *; media-src media1.com media2.com; script-src userscripts.example.com\n\n// 上报收到的攻击\nContent-Security-Policy: default-src &#39;self&#39;; ...; report-uri /my_amazing_csp_report_parser;</code></pre></div>\n<p>以下是各类选项的含义：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVQoz5WSW1fCMBCE+f//T6D3lKZJaeklSQu+jZMUraIH9eE7yclldnd2d2aSODcKZy1RlTmiwwvs1MOZ4Z9McDbDzk4KjdLQtUSWJoHr7LA4h9mav2PsKmimmtkpyEogjg4Y+w7DpcWlaxh15OMxrE8Jb6ZNUNeeCmkcQeQpyZAmEczYU3B6Kubv16BmE2wbTRSyJCYR+u6Mnln+JvajoL2XrFUVsmuUXAXJ4gxui6WnGzfizz3vAb9l2Ch6eBLsssBJFEjiY/CzyBLacAx2eBuqsmDT4hD4JPLg9VbFoyCbouoTcn7w/vlPpciQUNjfeYGCZzmDXFqNaeg4XsOnpn00ZR0bJTmPWuO434e9GQeWO+P1urDUmaWSZQn4kVqcpRgxD2NjTcEGlByTnKugdwW6dt1bUzMLua4Beaf+ggurgnMx3gCRAu9KP0dCAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2e565430.png\"\n        title=\"2e565430.png\"\n        src=\"/static/556b8db257ee8f003af1e20d6465b19a/00d43/90f0af24.png\"\n        srcset=\"/static/556b8db257ee8f003af1e20d6465b19a/63868/90f0af24.png 250w,\n/static/556b8db257ee8f003af1e20d6465b19a/0b533/90f0af24.png 500w,\n/static/556b8db257ee8f003af1e20d6465b19a/00d43/90f0af24.png 1000w,\n/static/556b8db257ee8f003af1e20d6465b19a/aa440/90f0af24.png 1500w,\n/static/556b8db257ee8f003af1e20d6465b19a/29beb/90f0af24.png 1830w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"httponly\" style=\"position:relative;\"><a href=\"#httponly\" aria-label=\"httponly permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>httpOnly</h3>\n<p>如果不希望被前端拿到 Cookie，后端还可以设置 httpOnly。 httpOnly 是包含在 Set-Cookie HTTP 响应头文件中的附加标志：</p>\n<p>如果 Cookie 中设置了 httpOnly 属性，那么通过 js 脚本将无法读取到 Cookie 信息，这样能有效的防止 XSS 攻击，增加安全性。</p>\n<h2 id=\"csrf-攻击\" style=\"position:relative;\"><a href=\"#csrf-%E6%94%BB%E5%87%BB\" aria-label=\"csrf 攻击 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSRF 攻击</h2>\n<p>CSRF（Cross-site request forgery）<strong>跨站请求伪造</strong>：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。</p>\n<h3 id=\"攻击流程及防范\" style=\"position:relative;\"><a href=\"#%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B%E5%8F%8A%E9%98%B2%E8%8C%83\" aria-label=\"攻击流程及防范 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>攻击流程及防范</h3>\n<p>典型的CSRF攻击流程：</p>\n<ul>\n<li>受害者登录A站点，并保留了登录凭证（Cookie）。</li>\n<li>攻击者诱导受害者访问了站点B。</li>\n<li>站点B向站点A发送了一个请求，浏览器会默认携带站点A的Cookie信息。</li>\n<li>跨站请求可以用各种方式：图片 URL、超链接、CORS、Form 提交等等(来源不明的链接，不要点击)</li>\n<li>站点A接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是无辜的受害者发送的请求。</li>\n<li>站点A以受害者的名义执行了站点B的请求。</li>\n<li>攻击完成，攻击者在受害者不知情的情况下，冒充受害者完成了攻击。</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.400000000000006%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQoz42S204TURSG+3Jq9MY38JG81RgTiXgIMUUTDBIqUhFK2jptrdBCO3R6HKan6Uw7hzKnzz0DWL0xruTPn+y18+219lopRIRRFBsTO+TBK4dc14tPsa8C2n2VptLBWNgsgwBXpJRZk6P2DuWLLFIjQ7WXY1/5KHI2qUjAbngJ8N66y4HicRVGdEczqucKHW3KeVulpQ5xfPipSfTmMgfjTT5rbyjP9qioOQxXJxWD/DAmRgnw7kuXw46Prk9ptnuoo0minqqJagcMRwYnQ4nBQqGqf0UaZ5AXJSqXxyvgh7rHeyEviG5a9rGsRVKZNjXR9FhzBmOdy4ktHsyw09wg38uKuxkKwtOnz2nPGjEw4kXJTWQuQx6l5xT7Hv8TQeARBn7it5GaLyy+n7Yo12Q6E4eHbx3y/RDPNilIZSo/qkilMqe1OvX6GTPL5kppMtvbxq4UsUp5rHIBfXuTwLGvW76NqRNyR/zhcTfA95Yo6phWX0PuqqJVA3sZYIZieMUCS/mM0foz1KePMXa3mBcO8fXJ9ZTDcLU28VByAmiaBrWmwsm5TF1WqDUu6A40OuIfDSmP22ow2XrHcGONeS67Asag6I89vL/ucCSmHEUhlthDxxP67T5u3MneJ6bp15iH+5jZDOa3LwzXnuCIqv8CxusjTwMBiv4xilUuEosehUHit/ELa9fhfBsAHngAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"16fd0599.png\"\n        title=\"16fd0599.png\"\n        src=\"/static/72529f4d9c051a71787582e538a1b1d2/5a190/16fd0599.png\"\n        srcset=\"/static/72529f4d9c051a71787582e538a1b1d2/63868/16fd0599.png 250w,\n/static/72529f4d9c051a71787582e538a1b1d2/0b533/16fd0599.png 500w,\n/static/72529f4d9c051a71787582e538a1b1d2/5a190/16fd0599.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>那么如何才能防范 CSRF 攻击呢？</p>\n<ul>\n<li>\n<p>添加验证码</p>\n<ul>\n<li>只在转账、交易等关键地方进行增加验证码，确保我们的账户安全</li>\n</ul>\n</li>\n<li>\n<p>检测 Referer</p>\n<ul>\n<li>通过验证 Referer 来判断该请求是否为第三方网站发起的，不过 Referer 可能被篡改，仅作辅助检测</li>\n</ul>\n</li>\n<li>\n<p>使用Token(主流)</p>\n<ul>\n<li>服务端给用户生成一个 token，加密后传递给用户，放在页面上或者代码里</li>\n<li>用户在提交请求时，需要携带这个 token</li>\n<li>服务端验证token是否正确</li>\n</ul>\n</li>\n<li>\n<p>设置 Samesite 属性</p>\n<ul>\n<li>Strict 严格模式，禁止一切非同站的 Cookie</li>\n<li>Lax 宽松模式，允许发送安全 HTTP 方法带上 Cookie，如 Get、Options 、Head 请求</li>\n<li>None 关闭验证，但前提必须设置 Secure 属性（Set-Cookie: SameSite=None Secure）表明 Cookie 只能通过 HTTPS 协议发送</li>\n</ul>\n</li>\n</ul>\n<p>SamesSite 属性对比：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQoz0WS2W7aQBSG/f6P0LteJVQtaaQEmhICMYkdIGyGAMaIfd/3xVC+nrEadSRrZjzn/NuMtt/vOZ1OHA4HBtMpScsiFImSyRewa3V60xm1Toen2AuJnIVl22Q/ioT1GLmyTbFaxTAMKpUKtVoNbb1eM5/PWa1WGIUPjGKZ778f+XLl4zoQ5Gf0mYBh4gv+QhcSUxpvnqLeZ1aq6FnLA5yKmJngaJPJhGazyWAwIO1UeS2W8N0H+frDz/XdPWbJ5rVQ5ErWcVGUa7YIiFp/KExW1u/yLyqkClCJ01zX5XN0e10csZBIJjFMEyufZzqf0Reyt3iciWrabKTGQY/FWCyX9Pp9D3A0GjGbzdBUfrvdjsVigXs8esDlUom8gM2l4Hw+s5Y4upKjylntlRrlSolRZ41Gg+12Kwo3aApgPB5jS9jD4ZDL5UKhUCCVSnlzSxqHgyHtdtsjdo+uV69AjkKwFJX1ev0/4PGfqs+h9qlMmmTqneeYjpmIk8qmSWczbPZbTpc/dCQa481k7x68SGJiX5Goy9WUDcVmyXNxHEdYj7w8RIjcPhD8dks8pFMyM4RvArSyNqNSg0zE5NF/RzfvYCdz6LruuVMX/BfVNT20bgGA0gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4238a896.png\"\n        title=\"4238a896.png\"\n        src=\"/static/5f71142c5479ff5561d390cd0a14ed2f/00d43/4238a896.png\"\n        srcset=\"/static/5f71142c5479ff5561d390cd0a14ed2f/63868/4238a896.png 250w,\n/static/5f71142c5479ff5561d390cd0a14ed2f/0b533/4238a896.png 500w,\n/static/5f71142c5479ff5561d390cd0a14ed2f/00d43/4238a896.png 1000w,\n/static/5f71142c5479ff5561d390cd0a14ed2f/302a4/4238a896.png 1080w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"跨站和跨域之区别\" style=\"position:relative;\"><a href=\"#%E8%B7%A8%E7%AB%99%E5%92%8C%E8%B7%A8%E5%9F%9F%E4%B9%8B%E5%8C%BA%E5%88%AB\" aria-label=\"跨站和跨域之区别 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>跨站和跨域之区别</h3>\n<p>在理解 CSRF 的过程中，有一个区别要注意一下，跨站攻击的发生是因为攻击网站偷取用户的 Cookie，发送到目标网站，但 Cookie 不是本身就能跨域发送吗？</p>\n<p>这里就引出了一对容易混淆的概念，<strong>跨域和跨站</strong>。</p>\n<p>同源(same-origin) 和跨域(cross-origin) ：具有相同<strong>协议、主机名、端口</strong>的组合的网站被视为 相同来源。其他所有内容均视为跨域。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 995px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3WS3W6DMAyFef9X7MUq7Wq0kBDID7TDO583uq1SI1kh2D4+PnZnL05tzdZ1s3leZLPVZbGmu+hOSe/aLOdis95Lzopdbds262KMNo6jJ2EhBLvdbh7AIXiaJluVuKbkwIDg556mZFH+UquVUq3b992w50MASbkUJSTLKtxULAsUIBgCNOkd5MsqXJXTbfe7NVFtarEouR5AChgFEKKSAFNy1V3TNyPiuTFiliU7iS6d3yycTtZfZju/B7tc5Rx6a3JyaDcKuP4ANuk3I4FIHBqiM51g3WcttiuZrj8fne8+lAOQlibpe5XWMFr0BpC2h2F0HdHdGf5X7ldPWuKLqZYfrWCa0CxE34DEEAWOIRUFHkP5a8d00REGwzD49D/63r/7/uLtNWlNIRiiOzp2z9M9AH0oY/AWAYUFYAxq8DX7XpmrfBi7iZ4vAal4TJs2AWBno69I8Y3gH7sH22OVvgAPdQdDCsefhQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"041d7f2e.png\"\n        title=\"041d7f2e.png\"\n        src=\"/static/7b35ab646d331bffc4bc0160d42e93aa/4cdf7/041d7f2e.png\"\n        srcset=\"/static/7b35ab646d331bffc4bc0160d42e93aa/63868/041d7f2e.png 250w,\n/static/7b35ab646d331bffc4bc0160d42e93aa/0b533/041d7f2e.png 500w,\n/static/7b35ab646d331bffc4bc0160d42e93aa/4cdf7/041d7f2e.png 995w\"\n        sizes=\"(max-width: 995px) 100vw, 995px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>同站(Same-Site)和跨站(cross-site)：Top-level domain (TLD) + TLD 前面的那部分 domain 相同的两个 URL 就是同站(Same-Site)，否则就是 Cross-Site。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 973px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVQoz12S227EIAxE8//fWKkvlaq2gXAnCdm4MwZWq0WyuPp4bLNc1yXTWmty37fOx3nqbLdNYozivZcNa+cczMvj8ZC67+JDkFKq7nfsFz6mlVIk4HKCW7v0kbFW7wl6Av0A1qrwnLO+z2As3bl1EFRx8PI4DjlxHqgOgQglkEpzLuoTVEyCkKh7BlgYSVPGfF635MoAJ5ydPqaCCEiA2aFwg6WUNRCNQGZIpUtKSSIsbEZ+Pz/k++tHL6fqv9VIJRQwOxRuI20G9D6oUu65XmQONOMukQtpAJ1nr6PWMHVHOmUoqlBXkB7PqDSMHtSKprCraoqSUcP2LEMw5pku4UzZYubaGCsrjHcr3jGwArvADp5ARveojYNjwhwB8kzZ9ZTZAKY8jXvtsryMCeRwozYbG0IAYEWBaBbS3PcDKlFXGJXyL2rK77D552jruooDhB9WXkrymo28nf0DZqYHweI+RgEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5d0b46ef.png\"\n        title=\"5d0b46ef.png\"\n        src=\"/static/8c941036c0d854626f0491c62a44cfb2/87a80/5d0b46ef.png\"\n        srcset=\"/static/8c941036c0d854626f0491c62a44cfb2/63868/5d0b46ef.png 250w,\n/static/8c941036c0d854626f0491c62a44cfb2/0b533/5d0b46ef.png 500w,\n/static/8c941036c0d854626f0491c62a44cfb2/87a80/5d0b46ef.png 973w\"\n        sizes=\"(max-width: 973px) 100vw, 973px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>可以看到 Same-Site 的判断是不会考虑 scheme 的，不过有时候可能想要加上这个判断条件，把 scheme 考虑在内的 Same-Site 判断就叫 schemeful same-site，除了增加判断两个 URL 的 scheme 是否一致这个条件，其他判断两者是一样的。</p>\n<p>不过，对于 <em>.co.jp</em> 和 <em>.github.io</em> 这种 domain，如果只是把 .jp 和 .io 当作 TLD，这样是不够判断两个 URL 是否 Same-Site 的。所以就有了 effective TLD 这个概念，简写成 eTLD，比如以 <em>.co.jp</em> 结尾的 URL，它们的 eTLD 就是 <em>.co.jp</em>。</p>\n<p>可以用 Sec-Fetch-Site 来判断请求是否 Same-Site 或者 Same-Origin，目前只有 Chrome 支持这个头部字段，其值为以下之一：</p>\n<ul>\n<li>cross-site</li>\n<li>same-site</li>\n<li>same-origin</li>\n<li>none</li>\n</ul>\n<p>我们常说的解决跨域需求，是指的是 Cookie 在不同域之间传递，目前的互联网机制肯定也做不到完全让 Cookie 同源保护起来，但 Cookie 的安全问题与生俱来就与 CSRF 有关。所以对于 SameSite 和 withCredentials 的对比，有一点如下思考：</p>\n<ul>\n<li>withCredentials 和 SameSite 属性都是针对 Cookie 跨站（域）的</li>\n<li>但是针对同样这件事，2者的态度是对立的：一个希望允许，一个则希望限制</li>\n<li>withCredentials 只针对 xhr</li>\n<li>SameSite 针对的是所有的请求，xhr、image 标签、a link 这些</li>\n<li>withCredentials 在很早 CORS 的时候就出现了；SameSite 在 Chrome 80 才中提出，是比较晚的技术</li>\n</ul>\n<p>SameSite 技术的出现让很多网站的第三方 Cookie 失效了，所以新的安全策略也有两面性，但不管怎么说，为了安全保障，有必要去升级规划好自己站点的整体架构，如服务器的 Access-Control-Allow-Origin 不能设为 * 或者增加验证码之类的，以避免潜在的攻击。必须在有效使用的目标下保证安全性。</p>\n<h2 id=\"点击劫持\" style=\"position:relative;\"><a href=\"#%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81\" aria-label=\"点击劫持 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>点击劫持</h2>\n<p>点击劫持是指在一个 Web 页面中隐藏了一个透明的 iframe，用外层假页面诱导用户点击，实际上是在隐藏的 frame 上触发了点击事件进行一些用户不知情的操作。</p>\n<p>典型的点击劫持攻击流程：</p>\n<ul>\n<li>攻击者构建了一个非常有吸引力的网页（比如小黄网）</li>\n<li>将被攻击的页面放置在当前页面的 iframe 中</li>\n<li>使用样式将 iframe 叠加到非常有吸引力内容的上方</li>\n<li>将 iframe 设置为 100% 透明</li>\n<li>你被诱导点击了网页内容，你以为你点击的是某张图片，而实际上，你成功被攻击了。比如发送邮件，或者打开摄像头、确认付款之类的</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3ElEQVQoz3VT227bMAz1///K3pqXAEv6VmDoQzZsaJouWZzGSeM48SW2ZFsSpTNKuXRYUQGEBdI8PDykItP3IKVhiWCtg3MfzZ9eCKxfZpg9vWAyecJ8OocsixCjkGuDRWa7AtUVfJp3/A/mff5UeY6H8Rij0T0ex/eIv08gTqcQc//kRfrXN9j95lPAK8PicMDXwR2GwyF+Dr7gbXwH0Ygz4OUffyKznMIe0wBIhmCMDUZkb3dWAm0jkfxe4C1eIZnN8DoaQJTlDfDGkNZz2DyFb8xoxQDm3bThIgaeQN+2SOMY6XqNPdvhx2PQ1XLQF78CR5SuYYt9APTi+mAwpkUMZC9SkGhCJ7R7hRMnUJoEqYpki3KbwmxiODIMyOxcmaHTxJo06FoJ7VtXCqoqoY4ZVLaD2iVQmyUUD1HnGTQDUsZgfxYon6fQ7DfHPSIrari6RCcFRH5Ay3ejeJU6CdNUsLIOd/KsOGYlM+072K6Fzw3fVoDYZ7oOkVMcrHJoRu9X88BEFzmzWUElS+iM2+G10szOJAv4jqwvwDmGfb6Yl8VdLLqOXPFyN9yyaGoeyEXLMPXzgIK+Xkv/DYM653XMSkp5878D8otpqgqirkOA6AwSwD7bzw+PwOEvOJlQPXnUelsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"e4c32cb8.png\"\n        title=\"e4c32cb8.png\"\n        src=\"/static/8146a2262678eac5064973ac2ab7d24c/00d43/e4c32cb8.png\"\n        srcset=\"/static/8146a2262678eac5064973ac2ab7d24c/63868/e4c32cb8.png 250w,\n/static/8146a2262678eac5064973ac2ab7d24c/0b533/e4c32cb8.png 500w,\n/static/8146a2262678eac5064973ac2ab7d24c/00d43/e4c32cb8.png 1000w,\n/static/8146a2262678eac5064973ac2ab7d24c/21b4d/e4c32cb8.png 1280w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>那么如何防御呢？</p>\n<ul>\n<li>\n<p>判断是否被内嵌（frame busting）</p>\n<ul>\n<li>if (top.location !== window.location) top.location = window.location</li>\n</ul>\n</li>\n<li>\n<p>X-Frame-Options</p>\n<ul>\n<li>是微软提出的一个 http 头，专门用来防御利用 iframe 嵌套的点击劫持攻击</li>\n<li>设置：setHeader('X-Frame-Options', 'DENY')</li>\n<li>deny: 拒绝任何域加载</li>\n<li>sameorigin: 允许同源域下加载</li>\n<li>allow-from uri: 可以定义允许 frame 加载的页面地址</li>\n</ul>\n</li>\n<li>\n<p>验证码</p>\n<ul>\n<li>增加攻击成本</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"url-跳转漏洞\" style=\"position:relative;\"><a href=\"#url-%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E\" aria-label=\"url 跳转漏洞 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>URL 跳转漏洞</h2>\n<p>URL 跳转漏洞是指后台服务器在告知浏览器跳转时，未对客户端传入的重定向地址进行合法性校验，导致用户浏览器跳转到钓鱼页面的一种漏洞。</p>\n<p>URL 跳转一般有以下几种实现方式：</p>\n<ul>\n<li>Header 头跳转</li>\n<li>Javascript 跳转</li>\n<li>META 标签跳转</li>\n</ul>\n<p>之所以会出现跳转 URL 漏洞，就是因为服务端没有对客户端传递的跳转地址进行合法性校验，所以，预防这种攻击的方式，就是对客户端传递过来的跳转 URL 进行校验。</p>\n<p>那么如何进行 URL 跳转漏洞防御呢？</p>\n<ul>\n<li>\n<p>限制 Referer</p>\n<ul>\n<li>确定传递 URL 参数进入的来源，保证该URL的有效性，避免恶意用户自己生成跳转链接</li>\n</ul>\n</li>\n<li>\n<p>加入有效性验证 Token</p>\n<ul>\n<li>保证所有生成的链接都是来自于可信域，通过在生成的链接里加入用户不可控的token对生成的链接进行校验，可以避免用户生成自己的恶意链接从而被利用。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"sql-注入\" style=\"position:relative;\"><a href=\"#sql-%E6%B3%A8%E5%85%A5\" aria-label=\"sql 注入 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SQL 注入</h2>\n<p>SQL 注入攻击是黑客对数据库进行攻击的常用手段之一，不论是在 Web 领域还是其它领域。攻击发生的原因依然是信任问题，开发人员信任用户输入，未对用户输入进行合法性检查，使应用程序存在安全隐患。譬如最常见的搜索功能，用户输入一段信息至后台进行数据库查询，当用户输入的信息中含有 SQL 语句时而后台未做安全检查时，该语句可能会被直接执行，这就是 SQL Injection。</p>\n<p>那如何防御呢？本质上这类攻击跟 XSS 差不太多，都是轻信用户输入，没有任何校验，所以防范的最好手段就是<strong>对用户输入进行过滤检测</strong>，不只是前端，服务端也要检测，特别是涉及数据库交互的，一定要小心。</p>\n<h2 id=\"中间人攻击\" style=\"position:relative;\"><a href=\"#%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB\" aria-label=\"中间人攻击 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>中间人攻击</h2>\n<p>中间人攻击（MITM）主要涉及 HTTP 协议部分，攻击发生是在 HTTP 的传输信息过程中，黑客会篡取和监听用户的信息。具体细节可以看<a href=\"https://betamee.github.io/content/NetWork-HTTP%20%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/\">HTTP 协议详解</a>。</p>\n<p>对于访问互联网而言，无论是通过浏览器还是 APP 客户端，一般都会使用 HTTPS 的方式通信，这其实就是一种比较有效的加密方式。在这种通信过程中，客户端或者操作系统内置了权威 CA(certification authority) 的根证书，服务器在通信之初，会先返回给客户端在 CA 那里获取的签名证书，然后客户端用根证书验证证书有效性，最后使用验证通过的证书提供的公钥加密数据。（细节见另一文）</p>\n<p>到这一步，有一个中心化权威的证书作背书，是互联网最大的信任基石，没有这一层安全共识，整个网络就没法运转。</p>\n<h2 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<p>总结一下所有的攻防思路：</p>\n<ul>\n<li>\n<p>XSS 攻击</p>\n<ul>\n<li>本质：恶意代码未经过滤，与网站正常的代码混在一起，以不正当的手段截取用户信息，破坏网站运行</li>\n<li>攻击方式：</li>\n<li>反射型</li>\n<li>DOM 型</li>\n<li>存储型</li>\n<li>防御方式：</li>\n<li>过滤用户的输入</li>\n<li>CSP 安全策略限制外在脚本的执行</li>\n<li>httpOnly，限制 Cookie 的读取</li>\n</ul>\n</li>\n<li>\n<p>CSRF 攻击</p>\n<ul>\n<li>本质：盗取用户的 Cookie 等凭据，恶意请求目标网站接口</li>\n<li>攻击方式：引诱用户点击攻击网站，攻击网站像目标网站发起接口请求，默认携带用户的 Cookie</li>\n<li>防御方式：</li>\n<li>验证码</li>\n<li>验证 Referer，确保不是未知跳转来源</li>\n<li>携带唯一 token</li>\n<li>SameSite 设置，限制 Cookie 的传递</li>\n</ul>\n</li>\n<li>\n<p>点击劫持</p>\n<ul>\n<li>攻击方式：使用 iframe + 视觉欺骗，诱骗用户点击不正常的事件</li>\n<li>防御方法</li>\n<li>判断是否被内嵌（frame busting）</li>\n<li>X-Frame-Options 限制网站被内嵌</li>\n<li>验证码，增加攻击成本</li>\n</ul>\n</li>\n<li>\n<p>URL 跳转漏洞</p>\n<ul>\n<li>攻击方式：后台服务器在告知浏览器跳转时，未对客户端传入的重定向地址进行合法性校验，导致用户浏览器跳转到钓鱼页面的一种漏洞。</li>\n<li>防御方式：</li>\n<li>限制 Referer，确定传递 URL 参数进入的来源，保证该URL的有效性，避免恶意用户自己生成跳转链接</li>\n<li>加入有效性验证 Token，确保链接来源正常</li>\n</ul>\n</li>\n<li>\n<p>SQL 注入</p>\n<ul>\n<li>攻击方式：未对用户输入进行合法性检查，直接输入到数据库中，含有的 SQL 查询导致被攻击</li>\n<li>防御方式：任何涉及数据库的要过滤后才去操作</li>\n</ul>\n</li>\n<li>\n<p>中间人攻击</p>\n<ul>\n<li>攻击方式：主要是以 HTTP 网络层面的攻击，窃取密钥，监听信息，伪造请求</li>\n<li>防御方式：使用 HTTPS、使用权威的 CA 证书，不乱下载各种不知名的证书或者软件</li>\n</ul>\n</li>\n</ul>\n<p>以上的几种安全问题是前端工程师需要时常关心的，也只是九牛一毛。网络安全不只是这些议题，技术的进步也会带来新的问题，安全问题要心中有数，特别是涉及钱财相关的接口，必须要有充足的备案，保障核心功能不受损。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/09/csp.html\">Content Security Policy 入门教程 - 阮一峰的网络日志</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP\">内容安全策略( CSP ) - HTTP | MDN</a></li>\n<li><a href=\"https://juejin.cn/post/6844904039935655949\">当跨域遇到Cookie与SameSite</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/22521378\">「每日一题」CSRF 是什么？ - 知乎</a></li>\n<li><a href=\"https://tech.meituan.com/2018/09/27/fe-security.html\">前端安全系列（一）：如何防止XSS攻击？ - 美团技术团队</a></li>\n<li><a href=\"https://juejin.cn/post/6844903934310498312\">关于跨域与 csrf 的那些小事</a></li>\n<li><a href=\"https://blog.csdn.net/enweitech/article/details/81781405\">HTTPS、SSL、TLS三者之间的联系和区别<em>Enweitech Software Works-CSDN博客</em>ssl tls</a></li>\n<li><a href=\"https://juejin.cn/post/6844904157892067342\">前端必备的 web 安全知识手记</a></li>\n<li><a href=\"https://github.com/YvetteLau/Blog/issues/29\">【面试篇】寒冬求职之你必须要懂的Web安全 · Issue #29 · YvetteLau/Blog · GitHub</a></li>\n</ul>","fields":{"slug":"/content/NetWork-Web 安全详解/"},"frontmatter":{"title":"Web 安全详解","category":"NetWork","tags":"Net_Basic Safety","date":"2020-12-10"}}},"pageContext":{"slug":"/content/NetWork-Web 安全详解/"}},"staticQueryHashes":["3649515864"]}