{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/node-bf64d738df0051d7ac8248ef37b6bb2b","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"35deecf5-e2b5-5059-9714-fc783ee47c19","html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>自从开了这个博客后，时不时需要完善下博客的功能。很早以前其实我也有一个博客，不过那个用的是 <a href=\"https://hexo.io/\">Hexo</a> 傻瓜式的框架，总觉得欠缺点什么，所以自从发现了 <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a> 这个静态页面生成器后，就彻底喜欢上了这个工具。</p>\n<p>这个工具的好处在于它提供了一套处理数据的接口，使用 graphql 进行查询，至于你用这个数据怎么玩，怎么展示，它不管，最终生成的是一个个静态页面。这就给了我非常高的自由度，可以自由定义页面、组件、功能。</p>\n<p>现在的这个 <a href=\"https://github.com/BetaMee/betamee.github.io\">GitHub 仓库</a>就是我用 Gatsby 进行开发的源码，所有的博客文章都在 <code>/content</code> 文件夹下。上周呢，我新增了 TravisCI 进行自动部署，它会在它自己的服务器上跑 <code>yarn run build</code>，然后将生成的 <code>public</code> 文件夹下的内容自动 deploy 到 <code>master</code> 分支上。</p>\n<p>到这一步，基本上已经很自动化了，不过还有一个比较难办的问题，就是每次新增一个新的文件，都需要手动添加文件夹、添加新文件、添加新的 meta 信息。所以我想着自己搞一个命令行工具来解决这个痛点。这就是本次介绍的内容：<strong>使用readline开发一个简单的nodejs命令行工具</strong>。</p>\n<p>具体源码可见：<a href=\"https://github.com/BetaMee/betamee.github.io/blob/source-code/scripts/initblog.ts\">BetaMee/betamee.github.io</a></p>\n<h2 id=\"readline-对象\" style=\"position:relative;\"><a href=\"#readline-%E5%AF%B9%E8%B1%A1\" aria-label=\"readline 对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>readline 对象</h2>\n<p>这里用到的第一个 nodejs api 是 <a href=\"https://nodejs.org/dist/latest-v10.x/docs/api/readline.html\">readeline</a>。</p>\n<p>这个 API 提供一个可以操纵 terminal 的接口：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> rl <span class=\"token operator\">=</span> readline<span class=\"token punctuation\">.</span><span class=\"token function\">createInterface</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    input<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdin<span class=\"token punctuation\">,</span>\n    output<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">,</span>\n    prompt<span class=\"token operator\">:</span> QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>通过给定的 <code>input</code>、<code>output</code> 参数，readline 可以获取 Readable stream 和 Writeable stream。这里的 <code>process.stdin</code>、<code>process.stdout</code>，也就是标准输入输出，可以在命令行中获取输入的数据。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACOElEQVQoz6WR70tTYRTH71/gi4igyNKSKFMzVq7m/Im1F67EnHtRmYxIbepw1DJ/klEJWhmUNjVtmRZKCplJRBGEYjGXxvwngnavOnGVu/fT3dSKXgTpFz4cnuec8+Wc5xEs+kMUpqXgKjTith7Fkq7HYrHx/Okwg09G6O8bprdzgK5mFx3NPbRUt1Fvv0vVhTaqHfdprOmgqaaTprpurte7EHbs0XIir4DxsZe8mRzn3fsxRl+/5eOYG6/Hg3t8gg8q7gk3M9MzapzE455m6pMXz+Q03s8zPLg3QL3DSUNtN0JsvA5r+UVCWlAgoMYllR/fFJTFBZTAInJwiX+pp2uYyxWtXK19iLBPl03VjdbljCyDoiyDavhHk6LeKbLyK8ph5HDO5Ryk0nqbukonQoapjOpG57KfstLwH4TU92iUGnXla1fUN0zRqxM2tv+eYg2Gj3te0NL8jDu3hhCmCjSMNNjXZLi6ss12iVNmG73trxCG8jQ0lBavy7Cs3MH2GA2m/BKEyG27OHO2dOVP5DBKCGWFv86rNSGCwWC4r6ikgsioBHbHHUbYEBGB2WRmPSo6bydBdxxNshFh66aN5Ofm4vfP4/OJiD4fi3MS3+dFlvwSgTmRwPws8oKEJEl8+SriE0Wk2blwvd/vx2qvQ2soJCZWnTB6y2Z2RkUTH7uXJI0WbVIKmfp0jBmZnDRkkqM7iPlIFjdPG+i3HuNcdhZxmjQMpmLSjQUkHkglUZ0sITmH/al5/AS97QzgBNW7hQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f8214d5253ea1c3641a91e36c82a3f99/00d43/std.png\"\n        srcset=\"/static/f8214d5253ea1c3641a91e36c82a3f99/63868/std.png 250w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/0b533/std.png 500w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/00d43/std.png 1000w,\n/static/f8214d5253ea1c3641a91e36c82a3f99/e2d3b/std.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<center>命令行</center>\n<p>初始化后，我们就可以使用 <code>rl</code> 实例对象进行操作了。</p>\n<p>首先调用方法出提示：<code>rl.prompt()</code>：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACW0lEQVQoz6WQ7UuTYRSHn7/ADxFBkaUlEWZqrLSc71j7oGam7kNlauFLs0QjU3OKRpFYllCipqlpGoYKviRCBEplc20TUgtLiiKKwu1RJ0rTPVfbUokKKjpwcXPf9/mdc35HSPLfTUJQAA2JkehU+0gMkpOYlEHn3U7aW3pobe6ipbaN+rImamyU51dSmHWd3NMV5J2ppER9k9L8GkoL6rhY2ICwyd2XAwfjGRjopt/wCM3QEx487Gdo0MCIXo9Bo2XYMIxOq0M7qEU3pOeZ1oBWo0fzVMfo81Fqb9yjMLuKYnUdgrtXAJnHkvk4McaIYYze+wZeTLxh/t0HFmZnkObnsEoLWCQLFouF30XjrS5yMys4r65H8JJHUqQuwfLpPZPjb3nc95LxV69B/IK0rJCWsB+ShNW6jNXx1lDVTo7qKgU5VQghsemcK6n6pau0JP4T9mi+3Uu+zfKFItsOA/3DybtU7fiwd1xctHX+i0I/Fmxq7Oba5TbKyzoQhuNl9BRnrdj5F5YtZ2Sc5bAygzvVfQgdMTKK01P/q+DJU9lsdJMRG5eG4LxhC0ePp69YtiPZkZb46b6c8309iw5dSlomzi6ebPXYg7DKyQllrJL/iZQTWXj67Ucmj0BYv2Y1cdHRmM0zGI0mTEYjc9MiX2dMLJhF5qdNzM9MYZ0VEUWRz5MmjCYT4tS0I99sNqPKKsBXkYCbu21C13Vr2eziynb3bfjIfPH1CSDUP5iIkFAOKUKJ8tuFcm8YV44oaFVFkhwehocsCEVsKsER8XjvDMTbNpmnPIodgTF8A5MlCL6VncVfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"std\"\n        title=\"std\"\n        src=\"/static/f9d9c8ee4313133e65071feac25ae91c/00d43/prompt.png\"\n        srcset=\"/static/f9d9c8ee4313133e65071feac25ae91c/63868/prompt.png 250w,\n/static/f9d9c8ee4313133e65071feac25ae91c/0b533/prompt.png 500w,\n/static/f9d9c8ee4313133e65071feac25ae91c/00d43/prompt.png 1000w,\n/static/f9d9c8ee4313133e65071feac25ae91c/e2d3b/prompt.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>然后注册 <code>line</code> 事件和 <code>close</code> 事件：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">rl<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'line'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理输入事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理关闭事件</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code>line</code> 事件只会在键盘输入 <code>\\r\\n</code> 、<code>\\r</code> 、<code>\\n</code> 才会触发回调函数，也就是我们习惯上常用的 <code>Enter</code> 键或者是 <code>Return</code> 键。</p>\n<p>在 <code>line</code> 事件的回调函数中，才是我们需要关注的部分，这里我们将用来处理输入的内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSetDataFromReadline</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">line<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>MetaResult<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 文章</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 类别</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 标签</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// 存入数据</span>\n      MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 进行下一步提问</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">setPrompt</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>QuestionsPrompt<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 打赏</span>\n      result <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'内容不能为空！\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 存入数据</span>\n        MetaResult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 进行下一步提问</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'输入只能为 y or n\\r\\n'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 出提示</span>\n        rl<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">break</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token comment\">// 退出</span>\n      <span class=\"token comment\">// 关闭命令行</span>\n      rl<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这段程序的大意是对于捕获到的 <code>line: string</code> 参数进行处理，处理的方式也很简答，就是非常普通的 <code>swtich</code> 表达式来区别处理不同批次的内容，如第一行处理完后才能进行到第二行，否则程序会报错。这也是使用命令行经常见到的：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACYklEQVQoz6WR3UvTYRiGf3+BBxFBkaUlEWqirLR0fiSWB2pizh2UpiKpTRsushQ3ySgLyxJK1DQ/Mg1DBc0iisoiU9dUMImCoCKiJLc5p07n9rva1B1kQUkPXLy8cN8P9/2+Qrp0N6nhoTSmxaFT7CctXEpaupKuO910tPbQ1tJNa107DeXN1DqoKKqiWHWNghOVFJ6s4qL6BmVFtZRp6jlf3IiwxTuIhIPJPO/tplf3gv7+lzx6/JTBPh1vhoYYHtAyMjyCTqtD+0qLbnCI19phtANDDPTrGBsd4+b1uxTnV1Oirkfw8QshI0vJ14lx3n78xhPtZz6ZZrGY51mYnkK0zGIXF7CKVqxWK3+aprouCvIqOatuQAiQxqHSlPP+3Rh9z0ZRlw5z/8OXRaHd5RCXcR6iiN3uYknRUN3BacUVNKerESJluRSWVmGzLTAzM8f3HxaMs3NO56L5bzinpekBRY7K58443jBUGkPhhZrfaoirWNh86x5XL7VTUd6JMJIioadE9Uudf13mqqxUnuKwXMntmocInYkSSnKyVpVq5cLc4/ls9pIgS8pGcN+0jSMZOUuf4BA4EZ2Iy6y4uzRObDbboi8zOw93Dz+2++5BWOPmhlwm538m85gKv+ADSEJiETauW0tSQgJm8xR6vQGDXs+sycj8lIEFsxGLyYBlahL7tBGj0cj4hAG9wYBx0rSoN5vNKFQagqJT8fJ2JPTcsJ6tHp7s8PYhUBJEUGAokdIIYvdGcig6kvjgXcj3RXE5OZo2RRxHY6LwlYQTLcsiIjYF/51h+DuS+YXEExCWyE/vzQgJXLkRPAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"input error\"\n        title=\"input error\"\n        src=\"/static/82ae0d026fedfe3cd199bd404add600e/00d43/error.png\"\n        srcset=\"/static/82ae0d026fedfe3cd199bd404add600e/63868/error.png 250w,\n/static/82ae0d026fedfe3cd199bd404add600e/0b533/error.png 500w,\n/static/82ae0d026fedfe3cd199bd404add600e/00d43/error.png 1000w,\n/static/82ae0d026fedfe3cd199bd404add600e/e2d3b/error.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>最后当都完成问题后，调用 <code>rl.close()</code> 来关闭命令行，这时候会触发 <code>close</code> 事件。在 <code>close</code> 事件的回调函数中，我们可以对输入获取到的数据进行处理，比如生成一个文件或者其他工作：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACiUlEQVQoz6WS2UuUURjGv7/Ai6igyNKyCDWxppzScUksL9TEFVpMpVJzGZQwMxcyDEGzJElNxSUlzUTQlAKjaHEZ10Qp0AIJL9KcGXXGbXTm1zeTYyWBFz3nPJztfZ934QiRsuOEu7tSHeFHb+xpItxlRETKaa5rofFJK/W1LdSWNlCRV01Zfg0FacVkJhWSeq2Im8nF5KSVkptWRm5GBXcyqxD22koJDAzj3dsW2vve09H1gfZXb1B09DEyMEB/l4KebgXdnd30K/pRdPbQ3/eRwYFhcR1ieGiE8sIGMpNLyEqvQLBzcOFytJzv6h98Hp/kdd83xjUaljTzLKmm0UxPs6JfZgUdOp2Of6G6vJkbiQ+5nV6JcETmR3xqrhipl7YGBdv2N3G2qJ3e3lEm5rRoFxbQ6w3rzgaDwXT+Rb3prqLoGSmx98hIKUHwDEkgJfsBo+NjDH76QmXdCNX1Y7S8mODr1BQsL4lzidXV1XXBP2lEbVUbaWLJ2bfEHrrKfEjNKcEYa97wOxNWxf2CFp1Wu6lgzePn3M9rpCC/CWEwTEJrVpK5Hgz6NZrG39goZi5ZLr/O+VA5tY9eIjQFSciKi/6nw2Y0C8YnJLPHRkJwSAyC5e4DXLwUZ3owGhhpMNKwxg1ns42R5jZExSRiaeXAQfsTCFssLAgNDuV/EHU1CQfnM0hcfBF2bd9KSEAAGs0cSqUKlVLJwqya5TkVKxo1i7MqFudm0GvVqNVqJqdVKFUq1DOzJnuN+GdjkzKQeodjYytmaL1zB/usrDlka4eTRIrUyRVPmQe+Jz055+2Jv/MxQk95cfeCN09j/bji44W9xB3v4Gg8fMNwPOqGo5iZg4s/h92C+AnaWwF0YK4L2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done1\"\n        title=\"done1\"\n        src=\"/static/d9b4e793205ec0159eaeaf7085f620fd/00d43/done1.png\"\n        srcset=\"/static/d9b4e793205ec0159eaeaf7085f620fd/63868/done1.png 250w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/0b533/done1.png 500w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/00d43/done1.png 1000w,\n/static/d9b4e793205ec0159eaeaf7085f620fd/e2d3b/done1.png 1466w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABHklEQVQoz3WRaXKDMAyFuUSbZiDLhOAFgjdMsCEk5f6HehW0aTtt8uMbyYvk9+RkHEeEGGGtQ1lVkFJCVDWU9bDOw8yRMK6FMh5aO9TKYsc0cuGwOyrsKd8XeomJH25opyu6cYCNAY5gpcZ6J8FOLUodIWbqDsIOECogLwyOzCB/QOIvE27ThBg6KG1IjQWXNVYbjpQpZNwiEw3SJTqk1Gw+m3n7ir9JTOzRdAG84GAFg2Ac+wNd3gpsSrJkA7KywZqsvWbsEyr8zv+Q6DPZHCMqU0O3DXgpsT0US8OMZpIKg3V+orX8p+YRifMBnmZorz3cEOHI+pGf8JIyrOZX04L4UTAX3RU+bGibM/oLfQopvV3fEbq4WH5W8Gz/zgeMNcyO2G8rGQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done2\"\n        title=\"done2\"\n        src=\"/static/1d2fc7931a817adb34c13e99e8068c92/00d43/done2.png\"\n        srcset=\"/static/1d2fc7931a817adb34c13e99e8068c92/63868/done2.png 250w,\n/static/1d2fc7931a817adb34c13e99e8068c92/0b533/done2.png 500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/00d43/done2.png 1000w,\n/static/1d2fc7931a817adb34c13e99e8068c92/aa440/done2.png 1500w,\n/static/1d2fc7931a817adb34c13e99e8068c92/2adcb/done2.png 1984w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"fs-对象\" style=\"position:relative;\"><a href=\"#fs-%E5%AF%B9%E8%B1%A1\" aria-label=\"fs 对象 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs 对象</h2>\n<p>上一节中提到的生成文件的工作，就是由 <code>fs</code> API 提供的，这里用到的也很简单，见代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> promisify <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'util'</span>\n\n<span class=\"token keyword\">const</span> fsMkdirAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fsWriteFileAsync <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span>writeFile<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleCreateNewTemplate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// tslint:disable-next-line: max-line-length</span>\n  <span class=\"token keyword\">const</span> metaInfo <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">---\\r\\ntitle: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ndate: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">createDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ncategory: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\ntags: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\nopenreward: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\r\\n---</span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">const</span> newPostDir <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDirPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MetaResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token comment\">// 创建目录</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsMkdirAsync</span><span class=\"token punctuation\">(</span>newPostDir<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建文件</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">fsWriteFileAsync</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>newPostDir<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/index.md</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> metaInfo<span class=\"token punctuation\">,</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建成功后关闭</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'再见!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里用到的是生成目录 <code>fs.mkdir</code> 和 <code>fs.writeFile</code> 两个方法，至于 <code>promisify</code> 这个方法是用来将 <code>fs</code> 的方法 promise 化的一个工具函数，因为如果不用 promise 的话，就要用到回调函数方式，而我讨厌回调函数。</p>","frontmatter":{"title":"使用readline开发一个简单的nodejs命令行工具","category":"Node","tags":"Node_Basic API","date":"2019-08-18","uninqueid":"bf64d738df0051d7ac8248ef37b6bb2b"}}},"pageContext":{"uninqueid":"bf64d738df0051d7ac8248ef37b6bb2b"}},"staticQueryHashes":["3649515864"]}