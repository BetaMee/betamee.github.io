{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/content/enginnexpe-cfa0b1e49db05c37b776d25900dc8025","result":{"data":{"site":{"siteMetadata":{"author":"橡树上","title":"十二棵橡树"}},"markdownRemark":{"id":"2655020e-9224-5111-81c2-3a4c965e9c88","html":"<h2 id=\"目录\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E5%BD%95\" aria-label=\"目录 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目录</h2>\n<!-- toc -->\n<ul>\n<li><a href=\"#%E5%89%8D%E8%A8%80\">前言</a></li>\n<li><a href=\"#%E9%97%AE%E9%A2%98%E7%9A%84%E4%BA%A7%E7%94%9F\">问题的产生</a></li>\n<li><a href=\"#%E7%90%86%E8%A7%A3-Web-Metrics-%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87\">理解 Web Metrics 各项指标</a></li>\n<li><a href=\"#%E5%BD%B1%E5%93%8D%E6%8C%87%E6%A0%87%E7%9A%84%E5%9B%A0%E7%B4%A0\">影响指标的因素</a></li>\n<li>\n<p><a href=\"#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5\">性能优化实践</a></p>\n<ul>\n<li><a href=\"#%E6%8F%90%E9%AB%98%E8%B5%84%E6%BA%90%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6\">提高资源的加载速度</a></li>\n<li><a href=\"#%E7%A7%BB%E9%99%A4%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%97%A0%E7%94%A8%E7%9A%84%E8%B5%84%E6%BA%90\">移除代码中无用的资源</a></li>\n<li><a href=\"#%E5%90%88%E7%90%86%E6%89%93%E5%8C%85%EF%BC%8C%E9%81%BF%E5%85%8D%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E7%9A%84%E9%87%8D%E5%A4%8D%E5%BC%95%E5%85%A5\">合理打包，避免资源模块的重复引入</a></li>\n<li><a href=\"#%E6%87%92%E5%8A%A0%E8%BD%BD%E9%9D%9E%E5%BF%85%E8%A6%81%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E6%97%B6%E5%86%8D%E5%8A%A0%E8%BD%BD\">懒加载非必要模块，用户交互时再加载</a></li>\n<li><a href=\"#%E5%8F%AA%E5%8A%A0%E8%BD%BD%E9%A6%96%E5%B1%8F%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E9%9D%9E%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E6%BB%9A%E5%8A%A8%E5%90%8E%E5%8A%A0%E8%BD%BD\">只加载首屏可视区域的模块，非可视区域滚动后加载</a></li>\n<li><a href=\"#%E5%8E%BB%E9%99%A4-gagtm-%E7%AD%89%E7%AC%AC%E4%B8%89%E6%96%B9%E8%84%9A%E6%9C%AC%E7%9A%84%E5%BD%B1%E5%93%8D\">去除 gagtm 等第三方脚本的影响</a></li>\n<li><a href=\"#%E4%BC%98%E5%8C%96-Long-Task%EF%BC%8C%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%9C%89%E6%9B%B4%E4%BC%98%E8%A7%A3%E6%B3%95\">优化 Long Task，分析代码是否有更优解法</a></li>\n<li><a href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A6%96%E5%B1%8F%E6%B8%B2%E6%9F%93%E6%8F%90%E4%BE%9B-Loading-%E6%A1%86%E6%9E%B6\">客户端首屏渲染提供 Loading 框架</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8%E5%91%BC%E5%90%B8%E5%8D%A0%E4%BD%8D%E7%AC%A6\">使用呼吸占位符</a></li>\n<li><a href=\"#%E5%8E%8B%E7%BC%A9%E5%A4%A7%E5%9B%BE%EF%BC%8C%E6%8F%90%E4%BE%9B-Webp-%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87\">压缩大图，提供 Webp 格式图片</a></li>\n<li><a href=\"#%E5%AF%B9%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E8%BF%9B%E8%A1%8C%E9%95%BF%E6%9C%9F%E7%9B%91%E6%8E%A7\">对页面性能进行长期监控</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%95%88%E6%9E%9C\">效果</a></li>\n<li>\n<p><a href=\"#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%9B%E9%98%B6%E6%96%B9%E6%A1%88\">性能优化进阶方案</a></p>\n<ul>\n<li><a href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93\">服务端渲染</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81-polyfill\">使用动态 polyfill</a></li>\n<li><a href=\"#%E6%8F%90%E4%BE%9B-es-module-%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2\">提供 es module 版本部署</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></li>\n<li><a href=\"#%E5%8F%82%E8%80%83\">参考</a></li>\n</ul>\n<!-- tocstop -->\n<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>前端性能优化一直是一个非常综合又重要的话题，涉及到很多知识点，也跟业务场景息息相关。本文将复盘整理自三月份开始的性能优化工作，此次工作的目的是优化我们站点在 <a href=\"https://developers.google.com/speed/pagespeed/insights/\">Google Page Speed</a> 上的得分，最终提升 SEO 的排名。</p>\n<h2 id=\"问题的产生\" style=\"position:relative;\"><a href=\"#%E9%97%AE%E9%A2%98%E7%9A%84%E4%BA%A7%E7%94%9F\" aria-label=\"问题的产生 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>问题的产生</h2>\n<p>在优化前，我们<a href=\"https://www.trip.com/m/flights\">站点</a>在 Google Page Speed 上得分 30 分往下，这个分数在千万个网络站点中基本上算是不合格的一批。分数越低，用户打开越慢，严重影响站点的用户体验。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmElEQVQ4y5VUaU8bMRDN//85lSqhfihUCHqoJZAQIBByQJJNdmPHXu/hY+3XWSepKqBVO9Ls5fHzHO9tRxYWB8/j3UCWFoJJbPoDbC66kJWDVGa//nfv4E/mHZA8A0rif6wTQsDBW1NKgTGG7XYLTr6VEmmaxvfWfo9/y19l6IyhpASqnCHPJZUvIYSAlPIV4EuLgE3TxKzau3MOzlpY28BYH702HtbtNh+uB0BVWRitUdYWpW7iWscSQJIsoQqFuq5RlSU91xA5DUdZcEnDKE08sKHsLR0SAWn7l/uC2sKx5Bbj1O56qI3DcrFBusogVEUgNTK+BaMSBZW8pX7aSsPWBMZylGoH5pyBSKYo1xOIdE4xefzegQ9IRIrR8g7Z9BL8uQeTzuBmU2ieYaUYRukED+kYI76CtAwqm0CxFOvpPZ6GfVxdDyApNmbYwj7IGbqTE+ibd6ge36McfEJ9eoKwXGBWrfBxfobjxWccrb7jOP0KMTiCW6/Rdq3Z97bx/gAY8JTNcLbo4Wb8Fez2FGm3B927QFivsJRrfJtf4gd5dneMon8B2+tDJ3MaSkloDazRsf87QDLuJW6KMdLNNULSRTMawNDGQHTZOFrLRxjmj1TqFfxzH80ttYVzzDPiLA2P5aQstQe0RJXVIoHX7p+UoCjsfOihaEjnQ4eTgcaHqxoPyX7KoSFqsGynCqKAtYaqcGh0BavrSCdJ024PDsETfQLktoKnMt8kNnwTldHKTetdUCBKNC0vifBZlkV3bpeBp/hAEw5VFYfxUjkE6CMgp57kxL2Wh5aYH6oCRV3Gg4QgXXP5SzG6LkhB9ZtSjNJrwdqSW80yxkmKBRSVyQlI0PcNF5ivczpM0y+s/b0Zoq+PfHmp6Z+Gi8+O/kOUcQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9ce4f009.png\"\n        title=\"9ce4f009.png\"\n        src=\"/static/7038e878e2f5092a6e28b9f8f3fd5401/00d43/9ce4f009.png\"\n        srcset=\"/static/7038e878e2f5092a6e28b9f8f3fd5401/63868/9ce4f009.png 250w,\n/static/7038e878e2f5092a6e28b9f8f3fd5401/0b533/9ce4f009.png 500w,\n/static/7038e878e2f5092a6e28b9f8f3fd5401/00d43/9ce4f009.png 1000w,\n/static/7038e878e2f5092a6e28b9f8f3fd5401/aa440/9ce4f009.png 1500w,\n/static/7038e878e2f5092a6e28b9f8f3fd5401/b8bf8/9ce4f009.png 1728w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>那么这个分数到底是怎么得出的呢？以及该如何针对性提高分数？</p>\n<h2 id=\"理解-web-metrics-各项指标\" style=\"position:relative;\"><a href=\"#%E7%90%86%E8%A7%A3-web-metrics-%E5%90%84%E9%A1%B9%E6%8C%87%E6%A0%87\" aria-label=\"理解 web metrics 各项指标 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>理解 Web Metrics 各项指标</h2>\n<p>我们先来看看 Google 是如何划定页面指标的。Google 给出的 Web Metrics 总共有六项：</p>\n<ul>\n<li>First Contentful Paint (FCP)</li>\n<li>Largest Contentful Paint (LCP)</li>\n<li>Time to Interactive (TTI)</li>\n<li>First Input Delay (FID)</li>\n<li>Total Blocking Time (TBT)</li>\n<li>Cumulative Layout Shift (CLS)</li>\n</ul>\n<p>下面一项项理解其中的含义：</p>\n<p><a href=\"https://web.dev/fcp/\">First Contentful Paint (FCP)</a></p>\n<ul>\n<li><strong>衡量页面首个元素内容的出现时间</strong></li>\n<li>这个元素必须是 text、images、svg 元素或者非空白 canvas</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABz0lEQVQoz1WRy2tTURCH8wcJ0o3duWpIQrIUIpTShTsfO8EsLC4KCpU2jS6kVWuU4sZXb+6DJL2vlmTRogujIKartEEjYhLSPK7eJJ/n3uahB4b5fTOHOTNzAoVCAdM0yWazpFIpoS1hBqqWYy35gHw+jyHyumGxmnyIoqribk7ELFZWU6iCcyO+t7JGgH+OZdkT3fs9QMuaON3uJKaqBs1f9QlLUo5mfcqvXitnBfv9PqenLXRdZ8yu+4ecKvP1w3uqn0vUPn1EerlN6eCAE8HN8hd2tp9TOjzkeMRv0k+mHXY6HUzD8PVwMPD9i2db3L+T4ObFWa7Onmfh8iWWl24zP3OOjeuLLCdusJS4xeKFGVJX4txNXDsrOBwOabfbGKOCA1HQdV0UOUNx38beeYstvWNz4xGWvouuKBT3bNJbjzEFm5pK0bZIP92cdug4DrY93aH3iLfT7z9+0uk5uIMh9t4+leOq4B7eDPldnZPqN587XYdMRuzQ66TValGr1fwf64pP8Lgulq1pGpVKhYbQzUYDWZYpl4/8nDeRJEkcedxoks/IrCfXCUSjUcYWCoWIxWLE43Hfh8Nh33s5T4/zUWGRSOQ/DgWDBOfm+AsLBQByBFclDAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"f049e4af.png\"\n        title=\"f049e4af.png\"\n        src=\"/static/8e6fb3070f37111331deb4475566fb0e/00d43/f049e4af.png\"\n        srcset=\"/static/8e6fb3070f37111331deb4475566fb0e/63868/f049e4af.png 250w,\n/static/8e6fb3070f37111331deb4475566fb0e/0b533/f049e4af.png 500w,\n/static/8e6fb3070f37111331deb4475566fb0e/00d43/f049e4af.png 1000w,\n/static/8e6fb3070f37111331deb4475566fb0e/aa440/f049e4af.png 1500w,\n/static/8e6fb3070f37111331deb4475566fb0e/29007/f049e4af.png 1600w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a href=\"https://web.dev/lcp/\">Largest Contentful Paint (LCP)</a></p>\n<ul>\n<li><strong>衡量页面最大元素内容出现的时间</strong></li>\n<li>这些元素会被测量：img、svg 下的 image、video、使用 background-image: url() 的背景图、带文本内容的块级元素。</li>\n<li>需要注意的是，LCP 测量的元素可能会发生变化，如果在加载过程中，有更大的元素出现，LCP 时间会后移。具体见下面的图例</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEA0lEQVQ4y02TiU/TZxjH+xeZmaiAGAcJp4DDhWPZdE5ADsFZHS4Goks2l5kl25JtZrBluoqcQ6AtRwu9OTwGiDiKtFAq9KDct7RQPnv74rK9yZPf7/s+v+f4Ps/3pyi/cZWr166hVF7lcnEBRcpCPig8z4fFn1Bckk/JFYGLzvNxmfAJXHrlwH9O4GLx/a3yckpKLnFd5MjPy0PB2xN8s4PG2Em/bxTNCzOW6SFaezuxuofRjJrp87xA3afD6HyGdtRCn/8lbQYtj3utqDs0mAeecE/14CBhOBxmc3OTHkOPTL4vbGc3iMFkJBgOSRw5ZquZzTdbhN/e/FF7n7SsWD6/mc+FsrNcVBYdJAyFQqytrdHV1cWO6HRjfZ2V5WV6enpYW12Vxba3tjAaDCzMz7Mu/IT3eVCnIvVsEp/eruDyF0oKPis5SLi7uyuD1Go1i4uL0gKBgMROpxOv18vc3Bzt7e04HE7pWxWFNBoNz1++wDU7izcwR03tw/9mGElqtVr5/4l0GAnc3z+gqNfreTU+zpIouLG+IQs6Jl6xsrQkGdTX1aPw+/243W7sdjsNDQ14PB6mp6dFJw7q6+t5PjJCf/+A7OyXn3+k8EIuudk5nErJ4GJ+PspL58nJyiY1OY2c7FwUJ0+eJCkpibi4OCLvJ06ckPYvjj0eS3RUNDExMcTGxnL02DHeOXyYQ4cOERUVRXR0jPjuXY4cOSqxoqOjQ1JTqVTcuXMHrVZLd3c3NTU1fPfD93Qa9HQZ9WLDFqqrqrCZrfz15CmPBx5TXV3F3Z++oaiwgNKyUiorK1B4xEAjtPX6bpqamnC5XLgEZbPRjOrPWrrGbFhcg3KGtn4bjoVplkMbEpvMJjw+NwERH94L09bWhmJJDHRlZZn+XjN1dXXMzy/ILT8RwS2tLbhm3Mz4PWxvb6PWaVEZm4WwTazvb9OhbafhURNdPd2sbW/Q2NSIIiB0tbCwIJYyJmUwMzsjJeJwTMhRuKen8Pt8ctsmk4nX7tcsLy6xGwzRptVQWXWLvG/PcfyjOJQV5ShczinWllfZ2dlBLVq2vxxj3h9gePgpLS2PmBCy8Pq8bAlZmAXFcfvf+Pw+9nb30HRq+er329z4VUnel3lUfn0TxejsBK5VL3v7YVo71DxzjvB6fQ6dsVsUUEv5TE5OilHM09vbK3GEQTAYlB3bHXYmXZNshbZoftSMotbSinrYgH1inLv3qvhNV0fk7mFzA6r7Kmw2GyNCi+NC0I2Njeh0OiwWC4ODg1KnFvG/Dw8NMTU5JVRQjSLz9HvkZuWQmpJCcnIyp9MzSD+VxvtnzpAi7tLT00lLS5MW0Wt8fLzUaOSZmJhIYlIimZmZZGRkkJCQwD82+dbqu4ewcwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0dc6197e.png\"\n        title=\"0dc6197e.png\"\n        src=\"/static/5ee261ecc1b4a55b05f4d1d53e09ed06/00d43/0dc6197e.png\"\n        srcset=\"/static/5ee261ecc1b4a55b05f4d1d53e09ed06/63868/0dc6197e.png 250w,\n/static/5ee261ecc1b4a55b05f4d1d53e09ed06/0b533/0dc6197e.png 500w,\n/static/5ee261ecc1b4a55b05f4d1d53e09ed06/00d43/0dc6197e.png 1000w,\n/static/5ee261ecc1b4a55b05f4d1d53e09ed06/aa440/0dc6197e.png 1500w,\n/static/5ee261ecc1b4a55b05f4d1d53e09ed06/ddb6a/0dc6197e.png 1592w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a href=\"https://web.dev/tti/\">Time to Interactive (TTI)</a></p>\n<ul>\n<li><strong>宏观上：从页面开始加载到主要资源加载完成，并且后续可交互这段时间</strong></li>\n<li><strong>微观上：有 Long Task 的时候是主线程静默期之前最后一个 Long Task 的结束时间，没有的话是跟 FCP 一样的时间</strong></li>\n<li>影响 TTI 的主要因素是 Long Task 和 后续的主线程静默期</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQoz4VT7VaDMAzl/R9Gn0V3/DHnlE35htLSAuXzmnSCc3PacwINSW6Sm+DN84y/DtvnaXJ3ay3qunbSNA3Gcfz2+cLxlg9sZJkoeJouk5x0pRSiKHKSJAn6vr9K7gAZxOgaWhtkaYE4SnE8BDj4HwjDBFWpXLCUCkIIeksnwzA4oK7r1rt32TLrbdMieA8QBjHe9j62T1u87Hzsdq/YPe9xPH4gCEKUpaT2Gwe4tO9dcjAOIww5nR+msCP+JAFwhUUhkGc52tYS0PR7y5xB1wrSKGgRQz3eo4z3qDZ3qN4fYClRmsWI4hBJGpMkBNi6WB4QV7lWyMrB91FKgbazGKxBEz6i1QVstEGdH9ERR0IUBJoizzOSfAX5wSE/elJyIW+uzjTOFNCjqjTxVjruuPXbU+4b2OwF2tRuerwetdHrDo79qZKqqhwQg54DXu3hSNmVTNYKjDGOm4VfBvoPcDneX3/KpY0Hx1wtstjP/T4BKFxXuMtdWs8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"350bcd12.png\"\n        title=\"350bcd12.png\"\n        src=\"/static/542452781e611ab9b32b18a0b63722db/00d43/350bcd12.png\"\n        srcset=\"/static/542452781e611ab9b32b18a0b63722db/63868/350bcd12.png 250w,\n/static/542452781e611ab9b32b18a0b63722db/0b533/350bcd12.png 500w,\n/static/542452781e611ab9b32b18a0b63722db/00d43/350bcd12.png 1000w,\n/static/542452781e611ab9b32b18a0b63722db/aa440/350bcd12.png 1500w,\n/static/542452781e611ab9b32b18a0b63722db/019a6/350bcd12.png 1818w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a href=\"https://web.dev/fid/\">First Input Delay (FID)</a></p>\n<ul>\n<li><strong>宏观上：用户初次和页面交互（比如触发点击）到页面能真正处理事件两个阶段的时间</strong></li>\n<li><strong>微观上：FCP 和 TTI 之间 Longest Task 就是 FID</strong></li>\n<li>影响 FID 的主要因素也是 Long Task</li>\n<li>此指标反应的是页面可交互性</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQoz21S226DMAzl//9sUrUP6B7aabQr4RKSQBJI4DR2FQRbLVmxjTk+vhTruoJkWRaQTUp2Vu/9wd9rzs8Y9BY5EGOEtRbDMGCeZ/ZzbJomjmUln75l2YMWOTiOI9q25dc5B2MMgxPDdxJCgNaac/fABQXop6Zp0Pc9fyBWVVVBCAEp5YFFZkIFy7JEXddbRwx4uVxwPp8ZhNhlICq0rnlekW3W5CeDQfbM8ky3lnOCNgNEqtp2EqJRqEQLM1hYHzG6wOqcT/mvYn+lIFbX6xXTHBDDhOBqOKsxWQkrTpiHG8buC+r+AfM4QT8+4YcaY/+NEJdtSTRTZkgBmp3RfZpXBzcqLPEFrtof1FUJ2dwRfYdlVqmgRC1+0Ygbuq47nNFxy6aFUjpVDBt9P0VuXet0SmGF8yG9C2RPxRVv+V/L+829u6v9mdBm381tn/8EkTgNP7tSfg4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"466d4e29.png\"\n        title=\"466d4e29.png\"\n        src=\"/static/fd6492537c18a0101cc0c7d8b717b16e/00d43/466d4e29.png\"\n        srcset=\"/static/fd6492537c18a0101cc0c7d8b717b16e/63868/466d4e29.png 250w,\n/static/fd6492537c18a0101cc0c7d8b717b16e/0b533/466d4e29.png 500w,\n/static/fd6492537c18a0101cc0c7d8b717b16e/00d43/466d4e29.png 1000w,\n/static/fd6492537c18a0101cc0c7d8b717b16e/aa440/466d4e29.png 1500w,\n/static/fd6492537c18a0101cc0c7d8b717b16e/17d12/466d4e29.png 1666w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a href=\"https://web.dev/tbt/\">Total Blocking Time (TBT)</a></p>\n<ul>\n<li><strong>FCP 和 TTI 之间的所有 Long Task 超过 50ms 部分的时间总和</strong></li>\n<li>影响 TBT 的主要因素也是 Long Task</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAx0lEQVQY032PUWvCQBCE8/9/jBQtVZ99KvgQ8YwKtpU2NRg0mpjL5c7Lfb1rpU/iwuwMyzC7Gznn+EOH627wurMWY4yHxmj9z9bP7/nDzDciHlTdKMpKUsnANeeyRht73xyWeIpCsm4VdT5jPRkSj56JxwPi4RNfyQLbbHl7HbN/T7g2O1SV0soCeRSsJi9M+z3SpfgNC1lRuDS811af5BvBdzInW3kWMacs46pyDh+Cy8HrtsCoAmsk+pJ6/4JUzCj32e1Ixw8VwTFw5m3GxgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"9605fbad.png\"\n        title=\"9605fbad.png\"\n        src=\"/static/61a2e84824114fe21c5d842c99f77f8f/00d43/9605fbad.png\"\n        srcset=\"/static/61a2e84824114fe21c5d842c99f77f8f/63868/9605fbad.png 250w,\n/static/61a2e84824114fe21c5d842c99f77f8f/0b533/9605fbad.png 500w,\n/static/61a2e84824114fe21c5d842c99f77f8f/00d43/9605fbad.png 1000w,\n/static/61a2e84824114fe21c5d842c99f77f8f/aa440/9605fbad.png 1500w,\n/static/61a2e84824114fe21c5d842c99f77f8f/eee07/9605fbad.png 1628w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><a href=\"https://web.dev/cls/\">Cumulative Layout Shift (CLS)</a>、</p>\n<ul>\n<li><strong>衡量元素位置的稳定性</strong></li>\n<li>影响 CLS 的主要是页面加载过程中突然出现的一些元素模块，导致页面布局发生位移变动</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACdElEQVQ4y41TTU8aURT1r7mpJk2qKY2u2nRjQogWLBswTezGRGIIYtzY8AuIJmAUcBgQ0eFz0BkRhCHpuLElTRUT8Ct8nL77lGkNLHqTmzdv7n3nnXPvfSPdbhdktVoNbrcbXq8Xa2tr8Hg83C8vL9G3dDoDl8uF1dVVeJivrKxgY+MbWq0Wj/d6PYy0222+WV9fx+joKCYnJzExMQGTyYSxsTH4/X4D8Iv9M968eo3376bxcXoKH6am8HZ8HIV8nseJ3EifYSKRYAzSkGUZkiRBOTnBxcUFjo+PebzT7kDJSOwUXljr6graefmJ4b+AsVgMoVAIoihib28PgiCgUCjg8PDwCbDTQf7oAL9+dnHb7BmAP9ilKssbYEhA0WiUM93f3+dAmUwG6VTKSD4QIiiq36FVdcZex29iVyziTFGGA4bDYb6SE2ilUkE8HjfY7G5uMiUCi0cRZmqSR0eQUxJOhtWQJBM7YpVirMg1TUMymYSqqqjX6xC3t5kKkV9CaiSWk2VK5Gx2EJAO3t3dGQGyRqMBhcmhy3RdR2x3h3/HmZMCAjxgwJVSaRCQanZ/f2/ME+8gm69cLmdI3tnaQjgSgfjcwDSLlU9VnLM6/hdgs9k0AOmfEAigWJBRZiU4ZWu1dIZSPofzs+JwycSI9jTsBHBzc2MA8i6z2vUeH9F5eODOBg96TUN5mGRqxjBTnkeC5jD33M0Xg317i0q1+vfpUSKZz+fDwsICf6t9dzgcCAaDxuGlpSV8XVzE8vIyd8qx2+38AQwwJGlmsxlWqxXz8/P4NDeH2dlZPjp9C7AazszMwGaz8RyLxQKn04nr62uD4R8URMldgpS/DAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fd9c54c3.png\"\n        title=\"fd9c54c3.png\"\n        src=\"/static/1bb50eb3195e5158e564c302d0641659/00d43/fd9c54c3.png\"\n        srcset=\"/static/1bb50eb3195e5158e564c302d0641659/63868/fd9c54c3.png 250w,\n/static/1bb50eb3195e5158e564c302d0641659/0b533/fd9c54c3.png 500w,\n/static/1bb50eb3195e5158e564c302d0641659/00d43/fd9c54c3.png 1000w,\n/static/1bb50eb3195e5158e564c302d0641659/aa440/fd9c54c3.png 1500w,\n/static/1bb50eb3195e5158e564c302d0641659/b2b2c/fd9c54c3.png 1708w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"影响指标的因素\" style=\"position:relative;\"><a href=\"#%E5%BD%B1%E5%93%8D%E6%8C%87%E6%A0%87%E7%9A%84%E5%9B%A0%E7%B4%A0\" aria-label=\"影响指标的因素 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>影响指标的因素</h2>\n<p>从上面整理总结的六大类指标中，我们可以得知，影响页面分数的主要在于：</p>\n<ul>\n<li>首屏资源加载太慢（SI、LCP、FCP）</li>\n<li>资源执行太耗时（TTI、TBT、FID）</li>\n<li>页面模块先后加载导致元素发生偏移（CLS）</li>\n</ul>\n<p>Google 提供了一个<a href=\"https://googlechrome.github.io/lighthouse/scorecalc\">计算器</a>，可以清楚地看到各项指标的占比：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABj0lEQVQoz21TCU7EMAzc/78QISEhoEvPHE7SJs0xOGlZYJeoVtLaHs847gXnKqWgtENGIIXr5yf6vscwDM3GcUTXdW2vsbec8/y9Lr8dzcm2bysGTpymCcuyQAjRgOZ5hrX2D9AD4P2HH8YZKaVmNabuuIv9TeQb51K3yMExRuzV9p3PuYYj+O0A4lV3IgvjAowxLe5vq+pTDsmKRJNT5RH3T9kIQTvc6mE5WRO1jEkFvFxXeO+56AmYj+LlQDwAnZENkDixBtgt4m2KoDWDtGqFMgdPOqMXgVkdisLmMbB/suaHIRmWsZnW+IVNLDNG4WDXiMRJxhC0UnC+4GNOeO09y42IbKvWkP0zuivx+9GaSwgJwREkJ0kpsTqL6nvqdnQiQUjditWlXYKkjVWkVmxWDsv4Di9eb/08JTNDBquJlZFhdr2MDfCt53ctWX5pzELY2+W1CeA+RK+we3teTDlumVYDxQyracX9lI57VMek3rrn3prbqCxUARNyTo8j9N9g3/8Fx6yXR7vPOxl+AeFdWtCEDF7CAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"71326f65.png\"\n        title=\"71326f65.png\"\n        src=\"/static/814d08e6f44045495f0fd342189eeafc/00d43/71326f65.png\"\n        srcset=\"/static/814d08e6f44045495f0fd342189eeafc/63868/71326f65.png 250w,\n/static/814d08e6f44045495f0fd342189eeafc/0b533/71326f65.png 500w,\n/static/814d08e6f44045495f0fd342189eeafc/00d43/71326f65.png 1000w,\n/static/814d08e6f44045495f0fd342189eeafc/aa440/71326f65.png 1500w,\n/static/814d08e6f44045495f0fd342189eeafc/e8950/71326f65.png 2000w,\n/static/814d08e6f44045495f0fd342189eeafc/6976b/71326f65.png 2172w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>这里提一下，计算器中的 Speed Index（SI） 不在上一节的指标介绍中，这是因为官网中列出的最新版六大指标中没有 SI（随着技术发展，Google 性能标准也一直在变化），但目前算分的时候是算这个指标的。我们姑且把这个作为总的页面加载速度指标，无需特意在意，因为当我们优化其他指标的时候，SI 一定是会提升的。</p>\n<p>从技术细节上，我们只要关心上一节的六项指标，万变不离其宗。基于上述六个指标，Google 还给出了<a href=\"https://web.dev/learn-web-vitals/\">Web Vitals</a> 这样的核心性能指标。有机会研读一下他们团队的一些思考。</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.599999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQY03WRS0/CUBCF+/+XGiFxJTG6UDeQuNUF8hbDI0DllUqhUCpiiG3p4/aztFdYObm5c3NO5sycuUoURSQR+fHlp88EkzgiPvs4B0fuVBMgwgMXHjnlUGh+C0ZGQHngs96KRExI0ZER8tLzaE9jwUgcm9lexPs8oPfhoepBgklBWJjwOoHKCLa+bC7SKfQ1lIZQn0pczh160J9BdQwN7cQpc9uka3bY6jUcrYLdqhOslgejDHcztK8ezqyEO23gdlvg2DjCo7NRWRhNfrQSzqCOq/bjLiFK9bPNrXrHuJxh9XSBdZXFazWTreT1ZwqdG5bFM4zHDJvcJVgWVrjjelKg9pZjVTxnfZ9ll38g8vap5WTv8ksCaelv8cJPrbiCf8PjZPkXhf/F69sOEQEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"959d1d43.png\"\n        title=\"959d1d43.png\"\n        src=\"/static/20b590047a21c31de991430f253433e0/00d43/959d1d43.png\"\n        srcset=\"/static/20b590047a21c31de991430f253433e0/63868/959d1d43.png 250w,\n/static/20b590047a21c31de991430f253433e0/0b533/959d1d43.png 500w,\n/static/20b590047a21c31de991430f253433e0/00d43/959d1d43.png 1000w,\n/static/20b590047a21c31de991430f253433e0/aa440/959d1d43.png 1500w,\n/static/20b590047a21c31de991430f253433e0/e8950/959d1d43.png 2000w,\n/static/20b590047a21c31de991430f253433e0/baae1/959d1d43.png 2424w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>要提高分数，无非从这些角度出发进行针对性优化。这里基于我们自身项目，提供一些方案：</p>\n<ul>\n<li>提高资源的加载速度</li>\n<li>移除代码中无用的资源</li>\n<li>合理打包，避免资源模块的重复引入</li>\n<li>懒加载非必要模块，用户交互时再加载</li>\n<li>只加载首屏可视区域的模块，非可视区域滚动后加载</li>\n<li>去除 gagtm 等第三方脚本的影响</li>\n<li>优化 Long Task，分析代码是否有更优解法</li>\n<li>客户端首屏渲染提供 Loading 框架</li>\n<li>使用呼吸占位符</li>\n<li>压缩大图，提供 Webp 格式图片</li>\n<li>对页面性能进行长期监控</li>\n</ul>\n<h2 id=\"性能优化实践\" style=\"position:relative;\"><a href=\"#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5\" aria-label=\"性能优化实践 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>性能优化实践</h2>\n<p>我们的项目是一个标准的 CSR 模型，前端资源部署在静态 CDN 上，Node 服务起一个引导入口。</p>\n<p>下面讲讲我们项目优化中的理论和实践措施。</p>\n<h3 id=\"提高资源的加载速度\" style=\"position:relative;\"><a href=\"#%E6%8F%90%E9%AB%98%E8%B5%84%E6%BA%90%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%80%9F%E5%BA%A6\" aria-label=\"提高资源的加载速度 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>提高资源的加载速度</h3>\n<p>提高资源的加载速度有助于提升 SI 指标，不过网络带宽速度前端是没法直接介入的，这是公司网络基础设施需要考虑的东西。下面是目前我们已经做到的基础优化：</p>\n<ul>\n<li>\n<p>使用 Service Worker 缓存静态资源</p>\n<ul>\n<li>具体内容见<a href=\":note:61323768-b26c-4cbb-8d34-db4c0d1831cf\">前端静态资源缓存实践</a></li>\n</ul>\n</li>\n<li>\n<p>使用 Resource Hints 优化资源加载速度</p>\n<ul>\n<li>DNS Prefetch：DNS 预解析</li>\n<li>Preconnect：预连接</li>\n<li>Prefetch：预获取资源，但不执行，优先级低</li>\n<li>Prerender：预处理</li>\n<li>Preload：也是预获取资源，但相比 Prefetch 优先级更高，加速关键渲染路径</li>\n</ul>\n</li>\n<li>\n<p>一些耗时的重接口可以分批查询</p>\n<ul>\n<li>先提供一个轻量的接口预加载数据，再调用主接口返回全部数据</li>\n<li>依赖于 API</li>\n</ul>\n</li>\n<li>\n<p>静态资源部署 CDN</p>\n<ul>\n<li>我们是面向国际化的站点，在海内外都需要部署静态资源</li>\n</ul>\n</li>\n<li>\n<p>升级 HTTP2</p>\n<ul>\n<li>HTTP2 相比 HTTP1.1 带来了很多新的功能，现在主流都在升级</li>\n<li>HTTP2 优势：</li>\n<li>解析速度快：基于帧的协议</li>\n<li>多路复用：多个请求可以共用一个 TCP 连接</li>\n<li>首部压缩</li>\n<li>可以对紧急请求设置优先级</li>\n<li>流量控制</li>\n<li>服务器推送</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"移除代码中无用的资源\" style=\"position:relative;\"><a href=\"#%E7%A7%BB%E9%99%A4%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%97%A0%E7%94%A8%E7%9A%84%E8%B5%84%E6%BA%90\" aria-label=\"移除代码中无用的资源 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>移除代码中无用的资源</h3>\n<p>随着项目的迭代，仓库中累积着越来越多的冗余代码。比如，在我们项目中</p>\n<ul>\n<li>手动引入的 zepto.js 插件，基本用不到</li>\n<li>全局引入的 css 文件，很多都被组件化的 css module 替代了</li>\n<li>国际化多语言资源，很多冗余 key</li>\n</ul>\n<p>解决这类问题，思路是很简单的，只是做起来比较麻烦，是一个体力活。最难搞的是多语言资源，我们页面每次通过 script 脚本引入全量资源，其中有不少冗余 key。</p>\n<p>为了解决这个问题，我自己写了个<a href=\"https://github.com/BetaMee/node-usage-examples/blob/master/scankey/index.ts\">扫描脚本</a>，扫出来 36% 的 key 是废弃的，去除后脚本资源量直接从 83KB 减少到 54KB（JP 站）。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.599999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQY0yWPS2/aUBCF/f//RBfdRl1007QikqNIgEIgLSokQcE19sX29ft5sZ3Qr1OyGJ2Z0Tkz51idMSR5TpwkBGHEMQgFNWlWUFY1xf8qq0tfCtZNQy78KNJkWvNn76LCUPYlfqCwqkqEuaYSQSvkTMimLXkfWzJ5Enq+iOPLk4OncFwl6KOUIpKDOtYkwot1TJZlWG7Y8X3ZEIVHPBUx9h0/HcPdxnAyrTgTV62RBIUcSNE6E3FKIA7TvEAnKYmkSfPyMlv7aORm3TOYgu40AH/x0jc2B8M4GN7OI51p2D86HHYOeR9hhgJMBaf6A/v6oz8PWH1dcG4lZnNiaArqNIb3nr4rUVHB7Uqx3JVM1zHfpgeuHxQ3cwf7XnDhYa809mOEPX3lx8zFcha3PNtfeZp8YTe54urzJyb2HcffC9K0YPbLY772efEbtm4pVbPZxTxtFbP5ls32yMPKYTnfcP8c8A8bZLp0/Hv7dgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cd9a4465.png\"\n        title=\"cd9a4465.png\"\n        src=\"/static/3b0635d7ab17a3b8c3b67dbd1405c688/00d43/cd9a4465.png\"\n        srcset=\"/static/3b0635d7ab17a3b8c3b67dbd1405c688/63868/cd9a4465.png 250w,\n/static/3b0635d7ab17a3b8c3b67dbd1405c688/0b533/cd9a4465.png 500w,\n/static/3b0635d7ab17a3b8c3b67dbd1405c688/00d43/cd9a4465.png 1000w,\n/static/3b0635d7ab17a3b8c3b67dbd1405c688/aa440/cd9a4465.png 1500w,\n/static/3b0635d7ab17a3b8c3b67dbd1405c688/e8950/cd9a4465.png 2000w,\n/static/3b0635d7ab17a3b8c3b67dbd1405c688/7ad71/cd9a4465.png 2338w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"合理打包，避免资源模块的重复引入\" style=\"position:relative;\"><a href=\"#%E5%90%88%E7%90%86%E6%89%93%E5%8C%85%EF%BC%8C%E9%81%BF%E5%85%8D%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E7%9A%84%E9%87%8D%E5%A4%8D%E5%BC%95%E5%85%A5\" aria-label=\"合理打包，避免资源模块的重复引入 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>合理打包，避免资源模块的重复引入</h3>\n<p>这一项的优化，是对 Webpack 打包的优化。用 Webpack Analyzer 进行分析：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmUlEQVQozz2S20+SARiH+ae676ouuuyiTXO1ttZFy0Onzaw2Km1rTu3gnGWzYZnVxBQE8wyCRxC0D4MPvhN8HAVKyM0Ue/qg1nvz23vz7Pe8e027mTh6eImDgwNq87vCwf53sp+ek3zaTKizCannOvGeFvSua2jvxwkM2Aj2WVk1D7DdNYqnW2Xybgj7va+YfpZLlEt7HB8fU6lUavnr8IiCx07e+gL91T3Sz5pJ3D/HTuNpEo4plCkf4ks7a7d6+VLfzucbm7w+v8jgBRembP4HxWKBw8PDGqw6R0dH5JcdZN48INV7E/VhA3LTKdbPn0AZtRPpc7BltrB8tRtbvRn3gNGwM4SzO4RJjH9HlqKEwxEymcx/YLqq3HEJ2dyA3nbWAJ4mePkksY+jBAdt+Ps+stE7ws6Qk4A3w8xYmM8WAZOSKpGIqwYwjK7rf4FG26J7gvy7J6T724jdOYfQeAahtQ7VM03Qs8iac5w1xxi+KRvhYI7VuTiTb6OY5GSJuKYiywrRaJT9/X3jlscUtWGyoXYiK2YE110Smw+M/TGF+DaK38emc4JNAzY/2M/0fACrfZU5t4hJ0n+gqTIRUSSVSv1TrpBPWEiKD1F3HpGJ3SerdJAWG0lE5thamCGw4CTomsZrHWbFH+OtdY2RiWBVuWwoayiKgqqq5HI5SqUSe7seino/e2kLWbGNlNiBLlxBVB1shN24/TaWtmxsK14c8wIj4z4mF79VG5ZQFRlJkhGNluVy2VD+bcA+kBNvsyu1G4oXia3XGdlAJrdBsqgiaCt81bysS3OMBzYY8rpwCqEqcM9QVmowTdNqv1i9YSFnR4+1IgktyCFDVWxGDd8iaQB3dB9BxYWU3mY9NsusEuJVYAmL4OcPFqSbtOOFw9YAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"282f6135.png\"\n        title=\"282f6135.png\"\n        src=\"/static/5b344ae723e19ff416c45f38da430e53/00d43/282f6135.png\"\n        srcset=\"/static/5b344ae723e19ff416c45f38da430e53/63868/282f6135.png 250w,\n/static/5b344ae723e19ff416c45f38da430e53/0b533/282f6135.png 500w,\n/static/5b344ae723e19ff416c45f38da430e53/00d43/282f6135.png 1000w,\n/static/5b344ae723e19ff416c45f38da430e53/add4c/282f6135.png 1452w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>发现我们项目中，有重复打包问题，主要集中在第三方模块：</p>\n<ul>\n<li>某公共组件提供多个版本的打包，es、lib、dist，我们项目中直接使用了 dist 包，但我们依赖的其他组件使用了 es 目录下的包</li>\n<li>某 UI 组件（团队自己维护）使用 Webpack 打包成 amd 模块，其中编译了 Babel Polyfill 包，但我们自身项目中也用到 Babel Polyfill，Tree Shaking 无法分析其中多余的模块，这就造成了重复打包。此外打包缺乏 sourcemap，调试也困难</li>\n</ul>\n<p>为了解决这些问题，调整下打包方案：</p>\n<ul>\n<li>统一第三方包目录，有 es 版本的全部使用 es 目录下的</li>\n<li>UI 组件库调整配置，调整为使用 Babel + TS 直接编译为 ES Module 模块，还能生成 sourcemap 文件，方便调试。我们项目中引用编译后的代码，所有的 Polyfill 可以自己控制，并且 Tree Shaking 还能排除没有用到的代码</li>\n</ul>\n<p>通过调整，可以看到调整前后代码量的差距，减少了一大半的冗余代码：</p>\n<p>调整前：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 841px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABoklEQVQoz5VT207CQBDd//8E44tGifHBhBcfjfENSSAR0nLrlZbSWBoKLb1AOe4MFg2CyiYnsyw7Z86cnYqiKECoVlmWZ2Erc2Kvi3gZIGg2IXRdh2nZ8Dt1hL1HfK0t/lzb3Z18piPOFjAvLyAmkwlcidBuI33vf97bnoGSc6jH8e0VxGg0wtTzsJbFig2wWiVswXq9/oFT53mWIskyTJ+fIGzbhuu6GI9t6LqG2Wz2j04PVEov080GTv0BwjJHMAwTnU4HrVYL/X4flmVxEcdxZKExqKim7YpVD1iRcbt5jmiVwr6vQVAiJdDjEAaDARP5vg9PWkH/0568pvNfCWvXEMOBAkVRMRwO9wRBECAMQ1Y0n8+ZkH7TmFRk3yMRziWhc3dDCndtKYrCLbfbbSY3DGOvmjog5XTv0EMmLCThIoanvkCYhsaekXdEEkURlsslkiRBHMcc6Yz2x8amIowWCZy3RzmHrs2VVVVlhY1Gg/ekkopQJPR6PbbjpMJoAV/nL8XghG63ywSkJJeeVMjkfNFDVPGYh2W5QZykmGqv+ADGl5B4H8YmxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"e92db65e.png\"\n        title=\"e92db65e.png\"\n        src=\"/static/0edf2ac57768898aefefcec89ae93b2a/bad1b/e92db65e.png\"\n        srcset=\"/static/0edf2ac57768898aefefcec89ae93b2a/63868/e92db65e.png 250w,\n/static/0edf2ac57768898aefefcec89ae93b2a/0b533/e92db65e.png 500w,\n/static/0edf2ac57768898aefefcec89ae93b2a/bad1b/e92db65e.png 841w\"\n        sizes=\"(max-width: 841px) 100vw, 841px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>调整后：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 752px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVQ4y5WT24vTQBjF82/6H4jgsw990wcVQUVhBcEFWVhYZMWHhXUffevNQm/pJW3u9zSTim22TZoe55uasrUI+sGXYYbkl3POzEiO4yAMQ6xWK1Btt9t/aqpVYoCNbxD5Iex3L+C+egzJ9z34IUMoX0P7WsH6h/UbXODvtQMWm4w/MjDfh/X0EZzKfUie58GybLDQxfpniG2R/7dSRqLOThCdvoY0GAyg6zoWyxRZXmCxWCJNU2w2G+R5jizL9k3zck2M6zVueceei/jbDdjVBVn2MZvNkCQMQRBAVVWRKQHpw7tVFMWhwqLYK/QuTuG8eQIp8HSYpo3pdIpWqyW61+thMpmg3+/zHyU8EgtrrqSMYp9kadl14H055xvzDJJjKVA1gwMUNJtNNBoNtNttEQP9hMA0H4/HB6ASlt6uEHOg/vEEyvuXO4W27QqrJbDT6cAwDKFUURRhfblcHoDEyDvfFDxDD2rlAaYP70FSxkMMBkNomoY4jsEYEzYJMJ/Pj87nnyeAihRGn86QnH+AZJqWUEf2ZFkWTfZc1+XKbZEfjfQOrR9BKcMoQPT9CnHjM8+Q3xTTNEVWZLderwvLBKC1simCMoojYBzAqr+FXX2+A9JLd3e52+2KTSEoRUFNWRKYzi2dwT2UgDMfkXwJNryERJYINhqNUKvVUK1WBbS0SE1AUkdOjm4RnyexD1+tYxEb+AWSoMXQRrfkHgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"27fd610f.png\"\n        title=\"27fd610f.png\"\n        src=\"/static/e32453855a5660302ee2918dfc728b41/442cb/27fd610f.png\"\n        srcset=\"/static/e32453855a5660302ee2918dfc728b41/63868/27fd610f.png 250w,\n/static/e32453855a5660302ee2918dfc728b41/0b533/27fd610f.png 500w,\n/static/e32453855a5660302ee2918dfc728b41/442cb/27fd610f.png 752w\"\n        sizes=\"(max-width: 752px) 100vw, 752px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"懒加载非必要模块，用户交互时再加载\" style=\"position:relative;\"><a href=\"#%E6%87%92%E5%8A%A0%E8%BD%BD%E9%9D%9E%E5%BF%85%E8%A6%81%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E6%97%B6%E5%86%8D%E5%8A%A0%E8%BD%BD\" aria-label=\"懒加载非必要模块，用户交互时再加载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>懒加载非必要模块，用户交互时再加载</h3>\n<p>资源懒加载也是目前前端页面一项基本功了。我们项目中的实践思路有两种：</p>\n<ul>\n<li>所有非首屏可视、需要用户交互的组件模块，比如点击弹出浮层、通知，统统使用 loadable 进行拆分</li>\n<li>所有特定场景的第三方 SDK、第三方脚本，使用异步动态加载，而且是只在交互时触发，避免首屏加载进来</li>\n</ul>\n<p>这里的异步动态加载是这样的一个方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * *异步加载一些非必要脚本，返回的是 Promise\n */</span>\n<span class=\"token comment\">// 已加载的脚本</span>\n<span class=\"token keyword\">const</span> loadedScriptList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadAsyncScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    anonymous<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 如果已经加载了</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loadedScriptList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">let</span> done <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> doc <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        s<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'text/javascript'</span><span class=\"token punctuation\">;</span>\n        s<span class=\"token punctuation\">.</span>async <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">.</span>anonymous<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            s<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crossorigin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'anonymous'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        s<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> url<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> f <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        f<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        s<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onreadystatechange</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>done <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">||</span> <span class=\"token string\">'loaded'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readyState <span class=\"token operator\">||</span> <span class=\"token string\">'complete'</span> <span class=\"token operator\">===</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readyState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>onreadystatechange <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n                done <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                loadedScriptList<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        s<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>使用的时候，比如有一个点击出验证码拦截：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Captcha</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">handleClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">loadAsyncScript</span><span class=\"token punctuation\">(</span>captchajs<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n         <span class=\"token comment\">// 第三方 SDK 注册</span>\n         <span class=\"token keyword\">const</span> captcha <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>captcha\n         <span class=\"token comment\">// other thing...</span>\n         captcha<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>关于懒加载的一点进阶思考：</p>\n<p>我们页面中，要加载一个模块，很多时候是依赖一个变量来控制的，假设这个变量叫 isMember，来源于账户 SDK，它的状态依赖异步接口，初始的时候，isMember=false,这时候页面渲染A模块，过一会接口返回了 isMember=true，则渲染B模块，但其实对于整个应用来说，B模块才是这个页面是当前业务状态要加载的，A模块理论上来说不需要加载。这违背了懒加载的原则。</p>\n<p>如何解决这个问题呢？可以另外设立一个变量，假设叫 isInterfaceOK，初始的时候 isInterfaceOK=false， isMember=false，都不渲染，等到接口完成后，isInterfaceOK=true，这时候再根据 isMember的值渲染不同的模块。</p>\n</blockquote>\n<h3 id=\"只加载首屏可视区域的模块，非可视区域滚动后加载\" style=\"position:relative;\"><a href=\"#%E5%8F%AA%E5%8A%A0%E8%BD%BD%E9%A6%96%E5%B1%8F%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E7%9A%84%E6%A8%A1%E5%9D%97%EF%BC%8C%E9%9D%9E%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F%E6%BB%9A%E5%8A%A8%E5%90%8E%E5%8A%A0%E8%BD%BD\" aria-label=\"只加载首屏可视区域的模块，非可视区域滚动后加载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>只加载首屏可视区域的模块，非可视区域滚动后加载</h3>\n<p>这块的优化是使用了 React LazyLoad + Loadable 结合。LazyLoad 的原理见这篇文章：<a href=\":note:64251aa0-92f1-4b25-923c-3698d76bd91b\">React LazyLoad 原理实现</a></p>\n<p>首屏只渲染可视区域的组件：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChElEQVQ4y5VUS08UQRCe3+mBeDHx4n8xURNj4sETB0KiYjSaqBBxMSsg6MICG1Bkd4d578z0c16f1T27ZMU9YCdfqrqr6+t6dLez/EngRSeEOzzD4OwCI9cH5wwbPYGVLQUhNbIsxXjswvN80jOkKc1dF74fIAjIdzy2tiAI4LzsCnR6CXTmIk5S5DmDEBxHQ41On4NxgbIowARDKjJkMgcvBARBlhJMc5I1mCohygZOKgENoCZUaEfdtFIrTuTkxIwUUFpZMMqAcw4uWiil7J6c4OSDbYSDA0THe1AXBzjaWEP/2zZEeIng908wSo8ZZ0JBkRoYZzM3h3GTQVlSZrldd/Y/vsbu21Ucvn+OHx/eYH11Gc9W1vDq3TpOdzbBibiahXyD4ciiRiYKOwkYwMrWEKUMqqigTVRlu9hcR9Ncoa5rKx2TAqbbSypqWdXWaEZVVVBSoqA6NYVGQ/Uzsta6nZPdxj5H7GhdTAkaisgQtqeVJZGRTVED1PAc1fkpquEvVO4QpZGEmg7DdcKLkYdkkv1VB8YlXC+CF8SQ1MFymjKucpnxtCTzusOpU1JpWyddlNOUG+qgQpa3V8KWZeY8F81Cwks/hOdH8IMIQRgjiidkraGpThldcmlqOK3zdeeFhHTBIal2V9AtIrrxI29ChCbl/yC8dV/g9iOBpQcC955K3H0irb70UOLOY4E4VairAm22NyDsnkTY6hvE6B4n+HIUW32zF+DrYGI/B/OWF925mZyHczYe4fPud3R7fWztH6Cz18PO4TH2T04xiiJqlP6ny4vGLFLHpxcx9GMMg6QF6W6cwp/kCDNmm2PebRzH9ttKksR+U0aGYWh1xtp9Bn8AhmzJSx3Z02sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5a9e436c.png\"\n        title=\"5a9e436c.png\"\n        src=\"/static/33b0e3d78ee4bb9648211de8cc456315/00d43/5a9e436c.png\"\n        srcset=\"/static/33b0e3d78ee4bb9648211de8cc456315/63868/5a9e436c.png 250w,\n/static/33b0e3d78ee4bb9648211de8cc456315/0b533/5a9e436c.png 500w,\n/static/33b0e3d78ee4bb9648211de8cc456315/00d43/5a9e436c.png 1000w,\n/static/33b0e3d78ee4bb9648211de8cc456315/aa440/5a9e436c.png 1500w,\n/static/33b0e3d78ee4bb9648211de8cc456315/332b4/5a9e436c.png 1826w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>下面非可视的组件由放在 LazyLoad + Loadable 中，只在滚动到下面的时候才去加载 home_buttom.js 并渲染出来：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> loadable <span class=\"token keyword\">from</span> <span class=\"token string\">'@loadable/component'</span>\n<span class=\"token keyword\">import</span> LazyLoad <span class=\"token keyword\">from</span> <span class=\"token string\">'react-lazyload'</span>\n\n<span class=\"token keyword\">const</span> HomeButtom <span class=\"token operator\">=</span> <span class=\"token function\">loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: 'home_buttom' */</span> <span class=\"token string\">'./HomeButtom'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 可视组件 */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        ...\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 非可视组件 */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">LazyLoad</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HomeButtom</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">LazyLoad</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVQ4y5VUy27UMBTNB/MB7BEsQLDmC1ghgbpAAypIiAoQtGoZ1CmatpOkk7fz8uRhJ3FyuPa0YlSkSrV0df2Ij8+5Po51fCnw5HWDp29qPHvb4OWswYs9PW7wmOZffW6AsQNjKdI0Q14UqOsaURzDth2EYQTXvYLjuAj8AJaXtnh/kmP/pMT+rxIHC45P89KM3x3mOLqoMfQdypojrwoUJUdVVZimCX3fm/44jhQKQcZgdarHcu3ix+8FjhZ/8H2+oDjF/PwCC9tG0VToug6iE1CTwrZNGIYBSikDprMO0UtYrZS4inMs3QBOmMIOGeyAYZ3k8NKCWDXoO4koihGRvDCKkCTM5M1mgyAMwTk3/dXKgdWEPqo0RUPR8xJdWZiQFKLIaZ5BshhZluNyZWPt+WZzQbXsiXmcJGjbFpKILUmVVTEGPymQZCXJ6knWhHHSooBBjegGkpImJFGZtZum10bKSmezZ1sGS+QZaR/ohI6KPGw/uK6LBtFzLTFUxIAoYbodBEIfUr8nFhOsDVH24wxZwQlYoRXSxDhOBrAj1oJk95EP5TlQ4Roq8jAEOtNckWHUB7IIE5XAarIUm0aCkx1EHqMjRjoGYthrQDrZMNyRu73n/7O2klXT6ayoyLQ5pAHsIYmVZqnl6roIlpgS4HrT7cBO36rpUjhZIyfJAStQ8trUUMvVhdcsDcO7AHfmrch18eHwAifLgDwVwyMfaoYa9EbMvQBPDw/w4NFD7H39aRaquoGgG29agaRUZOwRMr0HYEKsvlx6CEmyGgZTQw1o3uow0XikGt4NuBvWyvbwfDbHt7M1uZ8bg/tRirqVZCOynpqMsf+V4O5msfMzfJzN4DtXZFB6KW2DSbZo+YbeawWeVxBxQKyl+buYH4UQ5qnd7uv1v35byLtLKIF7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1ba6484e.png\"\n        title=\"1ba6484e.png\"\n        src=\"/static/1c082a3e52d091f347324f61140b4217/00d43/1ba6484e.png\"\n        srcset=\"/static/1c082a3e52d091f347324f61140b4217/63868/1ba6484e.png 250w,\n/static/1c082a3e52d091f347324f61140b4217/0b533/1ba6484e.png 500w,\n/static/1c082a3e52d091f347324f61140b4217/00d43/1ba6484e.png 1000w,\n/static/1c082a3e52d091f347324f61140b4217/aa440/1ba6484e.png 1500w,\n/static/1c082a3e52d091f347324f61140b4217/b6e50/1ba6484e.png 1862w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>这样的优化<strong>将资源的加载和执行后置</strong>，能减轻不少首屏渲染的压力。</p>\n<h3 id=\"去除-gagtm-等第三方脚本的影响\" style=\"position:relative;\"><a href=\"#%E5%8E%BB%E9%99%A4-gagtm-%E7%AD%89%E7%AC%AC%E4%B8%89%E6%96%B9%E8%84%9A%E6%9C%AC%E7%9A%84%E5%BD%B1%E5%93%8D\" aria-label=\"去除 gagtm 等第三方脚本的影响 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>去除 gagtm 等第三方脚本的影响</h3>\n<p>gagtm 脚本是 Google 提供的 analytics.js 和 googletagmanager.js，主要是供站点统计和市场投放营销之用。这些脚本一直作为“第三方脚本”在我们项目中存在已久，看起来也没有啥问题。但在这次的 SEO 优化中，发现 gagtm 对我们站点的性能分数有着十分重大的影响，更多讨论可以见<a href=\"https://www.analyticsmania.com/post/google-tag-manager-impact-on-page-speed-and-how-to-improve/\">这篇文章</a>。</p>\n<p>直观来说，gagtm 脚本影响了 TTI 和 TBT 两个指标，因为其加载执行都非常耗时，而且还会调用很多请求：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVQ4y32TW5OaQBCF/f+/JVV5TFWefdk8JA8rwiCggtwRZLgJiifdbdxKds1O1aluBuabntPDIo0DlHmEukyhqxSdLlEUBcqyxOl0khglOVw/xy4skR1bdH2P/j9afHtJ8HUZ4/vPCl+WBZZGg2ka6eWA2+0GHv15wjadoMIJQX7Bffb5WBhOgpfXPX6s9lAHjay+oOs6VFTd9TrLR003wAoG/PIGuPH4Z6ObxPdaFFGAyDYRk2rfw6grjNOEpmnegF1/hh0OMPwzwuNErE+Ag9aYyiPGY4EhywiocR4n1HVNwOsb0InOWBMwqS4y9wwmwPce8N5RFMOyN4jiRIy+XK7Q/YxTN6MfZ3w2Fs92aZoW9saBaSm8GiblLmkD13WxNi3qfCWL2ZJ5nuUkHFn/AOWj+V7BIYywIphp2TBMhY3jYbcPsN378u4hPs3eDxAcQnl+O/IDOP8FZJjrbeXocZKKOC+Ko9yErutFbEtLz3IPnwE55x0V+bhxPTgk23Hl6IqscL2dVJXlOalASs1M0gxZln/0kP3g6AehLGagEj9taRRH3shS99xYW+SrgrvdkSX+xy4/qpUKCcTNYQDnXOkdqrBamzLPTfII9vB0oene8f/K9+4RefjBQRYq25EKTGVLzpCcPOSboHUDTT9A07ZoRR1+A7Fe2g9BqE3oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"e981ce30.png\"\n        title=\"e981ce30.png\"\n        src=\"/static/470c9a8332ac707dddb4f0e94e62e31e/00d43/e981ce30.png\"\n        srcset=\"/static/470c9a8332ac707dddb4f0e94e62e31e/63868/e981ce30.png 250w,\n/static/470c9a8332ac707dddb4f0e94e62e31e/0b533/e981ce30.png 500w,\n/static/470c9a8332ac707dddb4f0e94e62e31e/00d43/e981ce30.png 1000w,\n/static/470c9a8332ac707dddb4f0e94e62e31e/aa440/e981ce30.png 1500w,\n/static/470c9a8332ac707dddb4f0e94e62e31e/093ec/e981ce30.png 1930w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>实验下来，如果站点去掉脚本，<strong>分数能直接提升了十分之多</strong>！</p>\n<p>在我们项目中，可以在服务端判断请求流量是否是爬虫，然后设立 isRobot 变量，传递给前端，为 true 的时候屏蔽 gagtm 脚本的加载。</p>\n<p>事实上，我们项目中还有 ubt.js、tarcker.js 等监控脚本，这些对 SEO 也是非必需的，可以在爬虫流量中屏蔽掉，提升更多分数。</p>\n<blockquote>\n<p>这就引申出一点小思考，这种方式算不算作弊？我们使用 Google Page Insights 来测试我们的站点，这些指标本身就是衡量用户访问体验的，现在在爬虫进来的时候去掉这些附属于站点的第三方依赖，分数确实提高了，但并不能反映用户实际的体验。</p>\n<p>但其实可以这么来思考，这些第三方脚本我们是无法直接优化的，我们能优化的只有自己项目的代码。如果我们的代码能优化到一百分，加上第三方脚本扣除 30 分，剩下的 70 分是极限体验。这和本身是 60 分的站点，扣除 30 分后，只剩 30 的体验还是有着巨大的差距的</p>\n<p>另一方面，这次做的优化就是针对 SEO 的，去掉这些无用的“脚本”无可厚非，甚至有助于搜索引擎尽快抓取有用信息。这样想来，这种做法也不能算作弊～</p>\n</blockquote>\n<h3 id=\"优化-long-task，分析代码是否有更优解法\" style=\"position:relative;\"><a href=\"#%E4%BC%98%E5%8C%96-long-task%EF%BC%8C%E5%88%86%E6%9E%90%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%9C%89%E6%9B%B4%E4%BC%98%E8%A7%A3%E6%B3%95\" aria-label=\"优化 long task，分析代码是否有更优解法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>优化 Long Task，分析代码是否有更优解法</h3>\n<p>Long Task 是指超过 50ms 的任务模块，它直接影响页面的交互流畅度。特别是页面首屏加载阶段，如果有太耗时的 Long Task，将会拉低 TTI 和 TBT 得分，因为 TTI 的触发需要有 5s 的<strong>主线程静默期</strong>，这期间不能有 Long Task。</p>\n<p>调试 Long Task，最重要的是学会使用 Chrome Devtools 查看火焰图，定位出耗时函数的位置。以个人经验来说，超过 20ms 的单个函数模块要重点关注，超过 50ms 的则是引起卡顿的函数，需要判断这个场景下是否真的需要这么耗时的操作。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACIklEQVQoz42T2W7TYBCF/f7PwAU3CAkE4gbasKisagV0SZutprEb27HjeN/tOMnH2EUCKiFxcTSL5j+ac8ZWDMPAcRxc18XzvP/CfD5nPJ7QvfXWLivbwF3ZkjsoTdNQ11WPpq5pmlry3/E+uvm8yInCmKIoSROPpXaBMR1gqwOUIPIpNzXtHtodbHZbsjqn2JR3sa0Ed3kpeV5nlE1Gs2+krsmbinLb9v2sjFE0Xcc2Z9j6lLWhEq1MUs8mWS8FlsAk852+l/o24coiCnziQOpw2SNzdRLfIo48FC/MMGZvWV6/wZi8ZHb2BOfmFa52yFofoF29YH75TOoD3Ln07SlJVnF9+hjt/AHm6CHO9Dn2/IP4+gglKXY0IjVvIUxTfqjvcexveO53An+IZQ3Rbj7iS+5753QWFTUsbkcszSGr5RmBbFlswIstlEiYimpDRxyEayaj11iLz/LgFFU9ETu+Mhyd8u54xvHlAnMlx6jF50KOU26I45Q0LynrnfDsUWIhLGUgKWXDOESdinzjGFM+BW1xLX6N0S2fp4dXHHwxMd2SqtlSNHs5Tgf6WAhhXrV/EwZRIBsOcJbnxKlPGDmEvkqQVrKdy9HJGMvxEUE9wX3k1fYPwmJPklfczj8JyVjk1CIrJwx1GdxgeTnDq4n8AOt+q38SRlnbexLnW1LxRJ0dyVEu+oFM6igWw0VKkhW9fys/7f3qHt8RbX+hm2/5CcdwOCVJnAuGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"04d9028a.png\"\n        title=\"04d9028a.png\"\n        src=\"/static/ba6845dd71487de2941b8a88a2c2fd6f/00d43/04d9028a.png\"\n        srcset=\"/static/ba6845dd71487de2941b8a88a2c2fd6f/63868/04d9028a.png 250w,\n/static/ba6845dd71487de2941b8a88a2c2fd6f/0b533/04d9028a.png 500w,\n/static/ba6845dd71487de2941b8a88a2c2fd6f/00d43/04d9028a.png 1000w,\n/static/ba6845dd71487de2941b8a88a2c2fd6f/e1b7c/04d9028a.png 1449w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>另一方面，很多短耗时但是重复多的操作也要关注，比如看起来只有 5ms、10ms 的函数，一旦堆叠也容易引起卡顿。需要分析其中的代码思路，思考有没有更优的写法。</p>\n<p>下面是一些优化 Long Task 总结出来的实践：</p>\n<ul>\n<li>\n<p>事件节流和防抖</p>\n<ul>\n<li>无限制的触发事件会拖累页面性能</li>\n</ul>\n</li>\n<li>\n<p>缓存 DOM 对象</p>\n<ul>\n<li>DOM 操作是很损耗性能的，避免滥用</li>\n</ul>\n</li>\n<li>\n<p>避免复杂对象的过度操作</p>\n<ul>\n<li>如 if(isEmpty(bigObj)) 改为 if(bigObj)</li>\n</ul>\n</li>\n<li>\n<p>优化耗时的同步计算</p>\n<ul>\n<li>放在 WebWorker 中或者使用 Promise 异步代码</li>\n</ul>\n</li>\n<li>\n<p>优化低优先级代码</p>\n<ul>\n<li>使用 requestIdleCallback API，详细可见<a href=\":note:4ee30f4f-0f04-4b3d-8104-e123a1eb35d6\">理解 requestIdleCallback</a>一文</li>\n</ul>\n</li>\n<li>\n<p>函数延迟执行</p>\n<ul>\n<li>柯里化（Currying）化技术将多参数函数转换成接受单一参数的函数，延迟执行代码</li>\n</ul>\n</li>\n<li>\n<p>函数缓存</p>\n<ul>\n<li>使用 Memorization 技术，将函数执行结果缓存，在参数不变的情况下，直接返回旧值，避免重复计算</li>\n</ul>\n</li>\n</ul>\n<p>除了关注 JavaScript 代码本身的执行效率，也要关心<strong>框架级别的优化</strong>。我们项目是 React 技术栈，基于 React 本身的性能优化实践，也要做到心中有数。</p>\n<p>以个人的经验出发，React 优化思路能有这样一些实践：</p>\n<ul>\n<li>\n<p>使用 shouldComponentUpdate 进行更新阶段优化</p>\n<ul>\n<li>对于 class component 组件，可以在这个生命周期阶段对 props 判断是否需要更新</li>\n</ul>\n</li>\n<li>\n<p>使用 PureComponent 和 memo 进行更新阶段优化</p>\n<ul>\n<li>默认只会浅比较第一层，深层复杂数据无从比较</li>\n</ul>\n</li>\n<li>\n<p>使用 useMemo 缓存昂贵计算</p>\n<ul>\n<li>但不要无脑依赖于 useMemo，memo 过程本身也是有开销的，要根据场景来决策</li>\n</ul>\n</li>\n<li>\n<p>使用 useCallback 缓存内联函数</p>\n<ul>\n<li>缓存了每次渲染时 inline callback 的实例，保证往子组件传递的是同一个函数引用</li>\n<li>需要配合 memo 或 shouldComponentUpdate，依据场景决策，不能无脑使用  </li>\n</ul>\n</li>\n<li>\n<p>使用 immutable.js 解决浅比较陷阱</p>\n<ul>\n<li>immutable.js 会将引用对象变成一个 immutable 对象，改变某一属性的时候，会更新当前属性以及它所有的父节点属性，其余属性保持不变</li>\n<li>常规深比较算法影响性能，借助 immutable 技术可以实现数据复用，提高深比较效率</li>\n</ul>\n</li>\n<li>\n<p>大数据渲染优化</p>\n<ul>\n<li>使用 React-Window 和 React-Virtualized 优化大数据渲染</li>\n</ul>\n</li>\n<li>\n<p>使用 React Fragments</p>\n<ul>\n<li>避免无用的 HTML 嵌套</li>\n</ul>\n</li>\n<li>\n<p>少用内联函数定义</p>\n<ul>\n<li>每次调用 render 阶段都会创建一个新的函数实例，增加垃圾回收工作量。非必要情况下少用</li>\n</ul>\n</li>\n<li>\n<p>避免 componentWillMount 中的异步请求</p>\n<ul>\n<li>放到 componentDidMount  中</li>\n</ul>\n</li>\n<li>\n<p>在 constructor 中绑定函数</p>\n<ul>\n<li>避免在 DOM 上 bind(this)，因为每次 render 都会重复这个 bind 过程</li>\n</ul>\n</li>\n<li>\n<p>class 组件中合理使用箭头函数</p>\n<ul>\n<li>使用箭头函数时会保留执行的上下文，非常方便</li>\n<li>添加箭头函数时，该函数被添加为对象实例，而不是类的原型属性。这意味着如果多次复用组件，那么在组件外创建的每个对象中都会有这些函数的多个实例</li>\n<li>最优的还是在 constructor 中 bind(this)</li>\n<li>常规函数和箭头函数各有优势，合理使用</li>\n</ul>\n</li>\n</ul>\n<p>代码优化既是一个细心活也是一个经验活，每一个优化可能从 10ms 优化到 5ms，但积少成多，只有保持良好的代码习惯，才能让性能维持较高的水平。</p>\n<h3 id=\"客户端首屏渲染提供-loading-框架\" style=\"position:relative;\"><a href=\"#%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A6%96%E5%B1%8F%E6%B8%B2%E6%9F%93%E6%8F%90%E4%BE%9B-loading-%E6%A1%86%E6%9E%B6\" aria-label=\"客户端首屏渲染提供 loading 框架 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>客户端首屏渲染提供 Loading 框架</h3>\n<p>由于我们的站点大部分页面都是 React SPA 技术栈，React 会把页面的渲染工作放在客户端，这就会导致用户从输入网址到获取到入口 html 文件再到看见页面之间有一个时间差，如果首屏渲染工作过复杂，就会出现<strong>白屏</strong>现象。</p>\n<p>所以为了体验上的无缝切换，可以在入口 html 文件中提前渲染一个 Loading 框架：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbUlEQVQoz4WSy07DMBRE8+3s+QV2CMGiSMAOFhVSJUCCFQjUR0hKkj4CTR0/Ypukw61D25RWItLI15bv8YxjL3x7hsoZ2FeKaJyhdRvhtJ2g1ZnhqcdQKIk5k8i5BCcJUY9SKhSFhlLb8s5PjnHd7iB6eYTkDO/hEAM/gDGWZKjR0EbrJKV18824Kw/0KW1gy4oWJMLhB/oDH7Mscy6k1ORqv+SeNa8qSywWC1RVRQsCQwJ2+wMwlkPr1UbjwEsHDvTrpllvOcwYp3vidDccUZxgMk0RJyMHVWrVqNeAOddgXO+Fetp8IxeKgIKAAkEQOlieL2GqAarHgg5IZhqjWV2v428cluTxG6UtXOQoitd3uBu5rjcHmC3nDnh4aXFwJnF0IxwwCEMHHE+m5JI3Yq2aVlFNA9qIfHU/xcVdiocur4EUudvrI00/Ya1tnL5x0ozp6ibw1ffhxxHyQrhnk4zG7uksgct3+Pcv/6cfQKD6k0qoNWYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"432ae4f0.png\"\n        title=\"432ae4f0.png\"\n        src=\"/static/461906683e58c0a55ef7cb71e54a3545/00d43/432ae4f0.png\"\n        srcset=\"/static/461906683e58c0a55ef7cb71e54a3545/63868/432ae4f0.png 250w,\n/static/461906683e58c0a55ef7cb71e54a3545/0b533/432ae4f0.png 500w,\n/static/461906683e58c0a55ef7cb71e54a3545/00d43/432ae4f0.png 1000w,\n/static/461906683e58c0a55ef7cb71e54a3545/aa440/432ae4f0.png 1500w,\n/static/461906683e58c0a55ef7cb71e54a3545/e8950/432ae4f0.png 2000w,\n/static/461906683e58c0a55ef7cb71e54a3545/95c1f/432ae4f0.png 2330w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>当然，这个跟 SEO 的优化没有直接关系，它不会对性能指标有任何提升，只是一个用户体验上的增强。</p>\n<p><del>不过我们可以在这个 Loading 框架上做一点手脚，让 FCP 提前触发。根据 FCP 定义，只要视口中出现首个内容元素，浏览器就可以定义为 FCP 时间，（非必要情况下不要滥用，因为对用户来说没有任何意义～）</del></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz0WRy5KcMAxF+f8vyio/kE1W09Ppx/BqbPOyjcHQQPpEwySVxalbUqkkXSn59qPm+0+LagO2bknvOWmuqR4GrRv6vifGkVmIU2Cex694jn91YpL8OAZCGEhO14LORdb9RWw9t1PG7VJxfleczj2nN01RDFRqJC8DWRFkkOfxsJL/VE/XTdJskQErSZ5nMn1iXTe86ilLizEOpQZMs1BUE2kx8pF67teey8XSVQqVFmS5lzrPFHd+vzhI0qzAOc+67SwhUt+l8Fyi0warO1ztWPzIai3P6sFq1BdasQ0DW4zs/5gmEm1qTF3zlIZsK8+mZ1AaU7ZUhTvQsrUSa0Y5oRcsjbgwVUctuNbie48zjVguSvEu3V8vRtnm8XZDZbVYMqINbWnwjSf0A7MbiFZwAZYI6wLP+T/yoORyvaONkafshGYg/fXB9V5TVR7bCW4mzvtxp0/GuB3xur0ONjncJg/dD4U/1G8SE4iK4OYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0e3e1066.png\"\n        title=\"0e3e1066.png\"\n        src=\"/static/9551715097c4faf6143d551add61bd81/00d43/0e3e1066.png\"\n        srcset=\"/static/9551715097c4faf6143d551add61bd81/63868/0e3e1066.png 250w,\n/static/9551715097c4faf6143d551add61bd81/0b533/0e3e1066.png 500w,\n/static/9551715097c4faf6143d551add61bd81/00d43/0e3e1066.png 1000w,\n/static/9551715097c4faf6143d551add61bd81/aa440/0e3e1066.png 1500w,\n/static/9551715097c4faf6143d551add61bd81/e8950/0e3e1066.png 2000w,\n/static/9551715097c4faf6143d551add61bd81/0b569/0e3e1066.png 2878w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"使用呼吸占位符\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8%E5%91%BC%E5%90%B8%E5%8D%A0%E4%BD%8D%E7%AC%A6\" aria-label=\"使用呼吸占位符 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用呼吸占位符</h3>\n<p>使用呼吸占位符，一是可以提供良好的用户体验，二是避免页面元素的突变，提高 CLS 分数。我们很多业务元素，不是页面进来就加载的，而是通过接口来拉取数据后展示的，使用占位符能让数据的加载有一个稳定的过渡。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 918px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC6UlEQVQ4y61UWWsUQRDef+Wrii+CIWIgD6IRH0Q8gqIoQdA1h+RQA14I/iIlt0lMskExyWZjkt25errnns+qmtl1sz4JNnx0T1X1119VV0/FNyHqRwb7x/rfcKSxV2L3UMMEIeI4RmVuy8epEQdnn7s4/cwpQeuqW8w9OFNtzw4GXno4P+Fh8LWLtZ8aABEubPs4N+qhf0qhf1qjf0ajj9Z9kx5B4eK0wqUZ9ilcmCztUz4GXhnc/GQwOOtj6J3Ctx0izIlQmwBhAugwReNXC/WDYygdiS2Icuw2M9QaKfatDGGcIyK77Wrs7B2gcWjRvgx+kFHKAaUcoRKGITFnSOhDax+uYyNJYpKfEzLYfoofhwlslVAYI0UUBlCeC2O07GWEZIsiIYzIEWCvXkfjgE5tNBCSIye+LMsIOVoqg0MHsY9j6hTLMTzYnyQpgqBDGNIihuu6tMmBUooCEglqIwhjeJ6CbbPfp9S6/Gkq8X8RtlotHDebsIm0d0TUDpZliULLskl93gUgTXsU+r4v6ngTE/PMaNIBrJg3dg8uE6fMpTLGCFkhjAj5w6M0mi0iY0JSwHAcl8itIkVKKab02qmGlBFDawMtpIGQxky4tLqJGw+nMDLxEfefvsGj0fd4PPZBbEN3xwVXbo8Krt4Zw+VbVQw/mZWYB9W3uH7vBa4Nj6P2fUc6o3LctDC/vIGltZrMi6tbWFqtYWFlE3P0zbb5lQ1Zf1lcx+eFdfEvr21j8euW2Bi27crlVLgZ/8fg+nVqyDUKqTW4PbgNWHpGF1H0YYa0nNs3W7RKgXZtT9wyF9jzDZRPL0AH8Ama/kLdt5ummdj578SEEZFwvEfgP03nlmXBzpLIBCw9EXQT8ovgg9nOilmd5l8Wzay+o5AXfDrLZrCzGH+aNyvnbrVpWQKJzHsIY3lekYDXQpLlPS+isLVrG5dPMpAmj0+mzEbH03BVCVp7ysjm9uC6uRJjOpfBdeaaCmlJ+BsZHH9dVSW14wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cf611099.png\"\n        title=\"cf611099.png\"\n        src=\"/static/8a43c8769a1c99e792921055d2e1b003/e0885/cf611099.png\"\n        srcset=\"/static/8a43c8769a1c99e792921055d2e1b003/63868/cf611099.png 250w,\n/static/8a43c8769a1c99e792921055d2e1b003/0b533/cf611099.png 500w,\n/static/8a43c8769a1c99e792921055d2e1b003/e0885/cf611099.png 918w\"\n        sizes=\"(max-width: 918px) 100vw, 918px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"压缩大图，提供-webp-格式图片\" style=\"position:relative;\"><a href=\"#%E5%8E%8B%E7%BC%A9%E5%A4%A7%E5%9B%BE%EF%BC%8C%E6%8F%90%E4%BE%9B-webp-%E6%A0%BC%E5%BC%8F%E5%9B%BE%E7%89%87\" aria-label=\"压缩大图，提供 webp 格式图片 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>压缩大图，提供 Webp 格式图片</h3>\n<p>Webp 格式的图片是 Google 于 2010 年推出的新型图片格式</p>\n<p>它具有这样的优势：</p>\n<ul>\n<li>更优的图像数据压缩算法，在拥有肉眼无法识别差异的图像质量前提下，带来更小的图片体积</li>\n<li>具备了无损和有损的压缩模式、Alpha 透明</li>\n<li>支持动态图片：动态 WebP 相比 GIF 支持更丰富的色彩，并且也占用更小空间，更适应移动网络的动图播放</li>\n<li>在 JPEG 和 PNG 上的转化效果都非常优秀、稳定和统一</li>\n</ul>\n<p>为网站部署 Webp 图片有助于提高页面加载速度、减少带宽流量。</p>\n<p>我们站点上首图以前是 PNG 格式，至少有 40kB+，这次优化下来为 10.8kB，优化率 75%，而且图片也依旧清晰：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.599999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVQY0zWQC0/CQBCE+///DpHERMWg0cSoGF9ABAotlJajvbte3y18XmrcZLKTnd3NzjpVVtDlhlOe0piUTEqapiFJEqT8R4zWkrosyDLbo1K81Ya1v0GZhDLPyIwmVQpn/XiFO75gNBwwnTxjvAVt1+HtIj5mK2YLH3cr8PcJsa7YhRJpGoQq8ANBrEq2traLFF4Q4xgREe+PHMIDIgioU0XXtrzOIwZ3S4YPGy6fQkaTA/dfmvH7kbvP1OaEwXjO9UvIjdVu3wQjCwcbLX9xtqis3dZCCMFyucB1V2x9j9RaPnUNubV8PjU0dcH3dIpWCXVVWF31tp2yrPplrb0qThRFUfZciCPu2iPYh4SRQCrd/zY1pteLsmQ2/7G/luR2Rmnd81+dKXXHBXytnQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"8272b29f.png\"\n        title=\"8272b29f.png\"\n        src=\"/static/64f50cc2c7c5d234b77f91833c658a1a/00d43/8272b29f.png\"\n        srcset=\"/static/64f50cc2c7c5d234b77f91833c658a1a/63868/8272b29f.png 250w,\n/static/64f50cc2c7c5d234b77f91833c658a1a/0b533/8272b29f.png 500w,\n/static/64f50cc2c7c5d234b77f91833c658a1a/00d43/8272b29f.png 1000w,\n/static/64f50cc2c7c5d234b77f91833c658a1a/aa440/8272b29f.png 1500w,\n/static/64f50cc2c7c5d234b77f91833c658a1a/e8950/8272b29f.png 2000w,\n/static/64f50cc2c7c5d234b77f91833c658a1a/24488/8272b29f.png 2984w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>不过 Webp 也不是没有问题，它的兼容性不是很好，iOS 浏览器不支持这个格式，更别说一些老旧的浏览器：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDElEQVQoz42Ry08TURjF+++50Y1GN640LjSujGElCGKiGyIkrCQqYoBGkZeApa20tGVmaDtTptMXpe10+phWOq2yMOjm550hIEsXJ98593Huud/nq+T3ODISVAsSVjnJcSNLv51jYOf50Slc1HP+s1ukY2awTY0TwXutLM2aRrdVol07wKfth1GlAJqyjSYHSEtfBQKeuXvZNbkM19h90IXHbZcbOE1dhNGFYWyFbHKbbCokapCKEROI06nrF8n+D0UvgE/fnKSe26FRlrEtlU5FxsoGOOlX6LeMizR9L+FZKxyhHW/PYND51xoXPrtZomHqtE2Vwrd1zIJCLb0j+ApHRYWqHuUoJ1KLmlejFDK7FLWzNpUyMgUtiqGGyaWimLkUvvbhPvXddazYF/wvbqOtvyY6O8bqxD26mTiOGMDezCiWGmLQLuFYIlnD4LguhtfI0xO6J9rz3V1riYTLI3cZfn6LkdEbPJq6yfSza4yPX+HBy6u8mrpPVPIzNHGdsXcPWYu8IamuoaRX2VU+Mrn0lB1pEUVbQ08sYSlb+A423rKifGB48TFP5oeYnrnD0vIIwfQywaSfkLxAKPWJzcQcW/H3hKR5wtICQVE3YrOeDogzyfAcVuSz+HI1Qbe8TzUbwSrFqeYiNIsJnFoauyRzXE1hH8qc9ir86ZucOjUPvwXOtct/DWreIP8Cnm9k8gjg4fQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4ae75864.png\"\n        title=\"4ae75864.png\"\n        src=\"/static/f3d87acbc1ef180cd34216fc67a1ce26/00d43/4ae75864.png\"\n        srcset=\"/static/f3d87acbc1ef180cd34216fc67a1ce26/63868/4ae75864.png 250w,\n/static/f3d87acbc1ef180cd34216fc67a1ce26/0b533/4ae75864.png 500w,\n/static/f3d87acbc1ef180cd34216fc67a1ce26/00d43/4ae75864.png 1000w,\n/static/f3d87acbc1ef180cd34216fc67a1ce26/aa440/4ae75864.png 1500w,\n/static/f3d87acbc1ef180cd34216fc67a1ce26/e8950/4ae75864.png 2000w,\n/static/f3d87acbc1ef180cd34216fc67a1ce26/56fb6/4ae75864.png 2752w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>要想部署 Webp，只能采用兼容方式。前端引入图片无外乎使用 JS 动态加载、使用 CSS、或者使用 HTML img 标签。</p>\n<p>对于 CSS，目前没有特别好的方式来做兜底，对于 HTML，可以使用 picture 标签：</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>picture</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">srcset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img/awesomeWebPImage.webp<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/webp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">srcset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img/creakyOldJPEG.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/jpeg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>img/creakyOldJPEG.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Alt Text!<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>picture</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>而 JS 动态加载，可以使用 toDataURL 来判断浏览器是否支持：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">isSupportWebp</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 使用 canvas</span>\n  <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/webp'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n  document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/webp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data:image/webp'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token number\">0</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>如果需要在服务器端判断，则可以判断 header 头中的 accept 字段：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHklEQVQY04WP226DMAyGef/32X13MXWaJm2d2nIKpEATKD1BE87Qf4Z21a42S1/sWPIn2zj5PrTHkDs2MttEkcRQWsOnvowTbIWEUhplVeF6vf6LEQQhwjAiAQdjHqSMkeU5BInSdI+irKCLEk3b0gDug3gw0DMMN3rCYCRyPR8+38B22bRV31aIRQR1ydDUBepS02RLhp7obnn8D1RjwO8wRtGIR2LTsiFowyU/Y/4V4NNN4QhNqAlre4FNmGE+sQ4yuLJAdOphbmsseAXDdr1JyDwOhzZM90e8rDLMFhLPC4G5dcSbc8Yr5Q+usRINzLjDWrZEh6Vop95sVeDpXd1PZv4kG3Oy26GrNaINgwg5DmmC/HygsxWan9P/iG/0NsPU4jUNCgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"b3906bff.png\"\n        title=\"b3906bff.png\"\n        src=\"/static/7c48bbde15959a88bb4aec8822d770e7/00d43/b3906bff.png\"\n        srcset=\"/static/7c48bbde15959a88bb4aec8822d770e7/63868/b3906bff.png 250w,\n/static/7c48bbde15959a88bb4aec8822d770e7/0b533/b3906bff.png 500w,\n/static/7c48bbde15959a88bb4aec8822d770e7/00d43/b3906bff.png 1000w,\n/static/7c48bbde15959a88bb4aec8822d770e7/aa440/b3906bff.png 1500w,\n/static/7c48bbde15959a88bb4aec8822d770e7/c830c/b3906bff.png 1754w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"对页面性能进行长期监控\" style=\"position:relative;\"><a href=\"#%E5%AF%B9%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E8%BF%9B%E8%A1%8C%E9%95%BF%E6%9C%9F%E7%9B%91%E6%8E%A7\" aria-label=\"对页面性能进行长期监控 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>对页面性能进行长期监控</h3>\n<p>除了在项目开发阶段的优化之外，监控也是一个必须要跟上的不可获取的步骤，分为两步：</p>\n<ul>\n<li>\n<p>在 CI 阶段：</p>\n<ul>\n<li>使用 Lighthouse SDK，每一次提交跑 CI 自动化脚本的时候统计性能分数，如果代码性能低于某一阈值，则直接警报</li>\n</ul>\n</li>\n<li>\n<p>在线上阶段：</p>\n<ul>\n<li>使用 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Long_Tasks_API\">Long Tasks API</a> 来埋点监控，重点关注高于 50ms 的任务。让大数据来告诉我们页面的交互哪一块出现问题最多最卡顿，方便我们后续排查优化</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVQoz2VS7Y7DMAjb+7/o7sekkBBCvlof0G3a7SK5qRowttPbPjZSTkjEoNptT6DSUKRDdKLqgvSN8zzf8DXWBGs1CLQr1lrx/baPA7lkpERIpQQ5UUbTgT6WYWLMhb03Dqt1TGtmYaulIG6qmHNehMuK2YhqZVRmsGHYROYKyjaICGzIma2xo4mgNgknUmuQqP5RuKNAW0MzVCsSa5JqjUY6xoC7POzh6mDvog33nzsej0fUkg100kvhXpaTRGPvPQ4CQ9FM6VyXle/8Mhf0J4n3ef+b0A9LuZDpspmEQC2jrxGqPi/FCclyd3W+fHd3b0JuNT681L0sj/6fzOEXNOaI3DwGj+lt+bRpagEXy8sP4lKe8j+tfv82n8vFuG1fv7jJcLXg2+mrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"e309930a.png\"\n        title=\"e309930a.png\"\n        src=\"/static/278c97e064b1948781f9bb0439a3bfd6/00d43/e309930a.png\"\n        srcset=\"/static/278c97e064b1948781f9bb0439a3bfd6/63868/e309930a.png 250w,\n/static/278c97e064b1948781f9bb0439a3bfd6/0b533/e309930a.png 500w,\n/static/278c97e064b1948781f9bb0439a3bfd6/00d43/e309930a.png 1000w,\n/static/278c97e064b1948781f9bb0439a3bfd6/aa440/e309930a.png 1500w,\n/static/278c97e064b1948781f9bb0439a3bfd6/e8950/e309930a.png 2000w,\n/static/278c97e064b1948781f9bb0439a3bfd6/437e0/e309930a.png 2094w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"效果\" style=\"position:relative;\"><a href=\"#%E6%95%88%E6%9E%9C\" aria-label=\"效果 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>效果</h2>\n<p>经过将近两个月的奋力工作，我们首页的分数终于达到了 89+ 分，远超 70 基准分，算是一个比较优秀的性能结果。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVQ4y4WUb2/URhDG8/2/RN8g3qGqqEJFRApFIYWCkjacShK4ay4+92yf/9u7Xnu9/nXsM5AEBCOtvd7defaZmWd8MAwDXw8YnMWpkD69ZLANssS3z94dB9y3EW00k+HC1/SbIwYBvrP3HTu4jT75OEfXWWzXYnYXtOHfdKamlbVxjx8wPbh9YDRrLWEQEEURYRgRxQmBzG/Wa4wxnwG/DTwz/BLtfu5GhsKqb4WZNZhW0zTNdNknZzedvZ2C/ffEMMtSiiKfHJRSKK0p9UChBvLakVeO3vGVc1L1rIIa3Wj+3XWYbgYMwh1r74YsTVB1Nb2DbUgcp+ziTMKWC2VdlxllnMtFdgL0w4KPyxuqZMtqk0skdmaYa4q4FKY1SWmI5bs0HXVrSLOEtmqgHehHoHbPcSSc+iuiizdc/vUny8uFyKvdAzZtxm/eMefnj8hPH6CvHtG/PaQ7eUHVlhx5r/h1+YzHy+ccxmd8vH5Kdfa7qKFHosT00ElOnJtDNpKDi2DJzeYfss2CaL2g8tY436PTig/RivfBB67CKxb+JdvwmmG7lvRoajUWq6esFH3fzwylE47DNzzZ/sHp6hnVu59RL4Xh62NhrzgJT3nqv8R7/wv27DH26BD79gSjawlT7Ys0tFJ9NwOKvrI6p3GGzmrhrxiE9WCaSSLGtejeiNhlr9ckkULnFefrlp+eax4eKx68KEUZM8M0SYmC8I4ovmeLa1j5Atr2eInlv9SyzXqR1pzDRm7P81xkElNV1eTUWalyU9GqkiRJRD47yVU3Q0q1m2Ku9b1eHh+5LvA8b3LUekyykw7pKHROXaZsNht83xfxl9IhAiepqOPtlLPpz3S/l5tuz3AcaZZRayv0e5S0nDJ6Wi/LgjgpRLxuSooWH3erpz/Z/x7H0D8BQ0XeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"054c4097.png\"\n        title=\"054c4097.png\"\n        src=\"/static/2062bf8b0908c4e60f514184deb3b10d/00d43/054c4097.png\"\n        srcset=\"/static/2062bf8b0908c4e60f514184deb3b10d/63868/054c4097.png 250w,\n/static/2062bf8b0908c4e60f514184deb3b10d/0b533/054c4097.png 500w,\n/static/2062bf8b0908c4e60f514184deb3b10d/00d43/054c4097.png 1000w,\n/static/2062bf8b0908c4e60f514184deb3b10d/aa440/054c4097.png 1500w,\n/static/2062bf8b0908c4e60f514184deb3b10d/e8950/054c4097.png 2000w,\n/static/2062bf8b0908c4e60f514184deb3b10d/d5f92/054c4097.png 2150w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>从内部工具中拉取线上数据，横向比较了一下，可以看到从三月的 30+ 到五月的 80+，经历了三次飞跃，这三次变化是在不同阶段发布的更新触发的，也是代表着这个项目中的探索过程：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAmklEQVQY051Q2QrCMBDM//+bPijGCzyw0dqkNq2NSXONUagPQqU4MLsLuzt7kLuswWZTVPkO1nm07ATDjwACYrIxvuww+nwI4U3SbDe4JLZ8DXWgyOkKRbZEV+0/Db9E+1xfR250gUYrsJojm0+gSgGhW1zL8yhBfF1BvDFwtoPxLnkLpx/oUmy9/2/DgnNwISBllX4WByePxRMHKIex7tIrNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"b84cccfe.png\"\n        title=\"b84cccfe.png\"\n        src=\"/static/3a5b9e13875b05cd2e79017c14c3b095/00d43/b84cccfe.png\"\n        srcset=\"/static/3a5b9e13875b05cd2e79017c14c3b095/63868/b84cccfe.png 250w,\n/static/3a5b9e13875b05cd2e79017c14c3b095/0b533/b84cccfe.png 500w,\n/static/3a5b9e13875b05cd2e79017c14c3b095/00d43/b84cccfe.png 1000w,\n/static/3a5b9e13875b05cd2e79017c14c3b095/aa440/b84cccfe.png 1500w,\n/static/3a5b9e13875b05cd2e79017c14c3b095/e8950/b84cccfe.png 2000w,\n/static/3a5b9e13875b05cd2e79017c14c3b095/39148/b84cccfe.png 2876w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA10lEQVQoz41Sy47DIAzM/39me8xhpQaw8YNZG5IqPeyqSCOPjeXHwPZ8PrDvO0opMDOoKkRkcmDA3cHM6L1jnjFmfNrJZzDo4ptxC98xTOEqH8jYcAs4PBpYxCwaLps5Co3m/PqBC6+C3GokrwthQvo5EROBagm/oJVjgsOnO2KrehwQarPxKhiOmqMRQ3tAOjSm1iieTRIm59TXFmnvPLe5Clbu6BZajXHKMt7yLP4dLj03ojVJin5BEnLnMvGRk7EzL/F+lOsF/0OpFRTa/nWfNfI35PkFLkAmOleefx4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bf686b4f.png\"\n        title=\"bf686b4f.png\"\n        src=\"/static/9ec9672d1763fceb33767fda7eb7a51f/00d43/bf686b4f.png\"\n        srcset=\"/static/9ec9672d1763fceb33767fda7eb7a51f/63868/bf686b4f.png 250w,\n/static/9ec9672d1763fceb33767fda7eb7a51f/0b533/bf686b4f.png 500w,\n/static/9ec9672d1763fceb33767fda7eb7a51f/00d43/bf686b4f.png 1000w,\n/static/9ec9672d1763fceb33767fda7eb7a51f/aa440/bf686b4f.png 1500w,\n/static/9ec9672d1763fceb33767fda7eb7a51f/e8950/bf686b4f.png 2000w,\n/static/9ec9672d1763fceb33767fda7eb7a51f/39148/bf686b4f.png 2876w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz2WSa0/bMBSG+///CvswMTEmJk2dmMoaBr0EFSVtWqGASmkTO4ntXNtndjekwY5kWfZ5/Z7HPu4VRYGQkqquqU1JUSiMLpBZhsolpVEkaYpy+2VJrjSiyNGlwcXhcDiO1+jFccxyGXE38/Fvh8TLgHK3YbfZYFTG+ikmCAKm/oSbkcfDKkSmz2gL8Wr479wrXVUpmCx+EYw/Y+IB6uYH7Xp9FLRti7K08zjAG52Try6pogEmmPHX6S1h13VoY4jWIdeLKwaRRzz/SbPd0jrxfm+vWvFsqUZLD28xxJ9fYR5C2m7P3ubfEDZNQyYkk+iW/vicx6CP8PrIaIGuKlxBZd959Tjn2/Qr3ycXvNzbvD+msCDuBv8ZCkszmF3S906s8Avi7CNpGOAkjkDlGXfRiE/DD4TTU/LhGcm1R/OO7mjoFkZr0iwhTW0j8gSz26KtSdf9OVDbHyAzwU68oLMtpUxQQlBbmPed/g0yxw6cBTSpdAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"0a251d97.png\"\n        title=\"0a251d97.png\"\n        src=\"/static/b708918be89bebdc0ffb00b77b345cdc/00d43/0a251d97.png\"\n        srcset=\"/static/b708918be89bebdc0ffb00b77b345cdc/63868/0a251d97.png 250w,\n/static/b708918be89bebdc0ffb00b77b345cdc/0b533/0a251d97.png 500w,\n/static/b708918be89bebdc0ffb00b77b345cdc/00d43/0a251d97.png 1000w,\n/static/b708918be89bebdc0ffb00b77b345cdc/aa440/0a251d97.png 1500w,\n/static/b708918be89bebdc0ffb00b77b345cdc/e8950/0a251d97.png 2000w,\n/static/b708918be89bebdc0ffb00b77b345cdc/0b569/0a251d97.png 2878w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>这是各个时间点的发布变更：</p>\n<p>阶段一：3.31号</p>\n<ul>\n<li>首页组件滚动加载</li>\n<li>移除 lodash 和 undercore 等工具库，统一使用一个基础库 ramda</li>\n<li>移除没用使用的 zepto 插件</li>\n<li>优化第三方资源：新增 loadAsyncScript.js，使用 Promise 封装，在需要的时候加载运行</li>\n</ul>\n<p>阶段二：4.14号</p>\n<ul>\n<li>更新第三方库目录引用，缩减了引入的体积</li>\n<li>对浮层组件进行懒加载</li>\n</ul>\n<p>阶段三：4.20号</p>\n<ul>\n<li>清理无用的多语言资源</li>\n<li>引入 Webp 图片</li>\n<li>更新 UI 库，提供 es module 版本，合理打包，缩减打包体积，从 1.5M 缩减到 500K（Webpack 分析）</li>\n<li>给 gagtm 添加了爬虫过滤埋点，gtm 很大程度上影响了页面的加载，更新后预计会有大的性能提升</li>\n<li>分析并优化了一些代码的 Long Task issue</li>\n</ul>\n<p>阶段四：5.20号</p>\n<ul>\n<li>给 ubt、tracker 等埋点监控脚本添加爬虫过滤</li>\n<li>添加 lighthouse CI</li>\n</ul>\n<p>可以看到，不是每一次的发布都有很明显的提升，性能的提升是在一点一点摸索中前进，但积少成多，从一开始的 30 分，慢慢变为最后的 80+，是一个巨大的进步。</p>\n<h2 id=\"性能优化进阶方案\" style=\"position:relative;\"><a href=\"#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E8%BF%9B%E9%98%B6%E6%96%B9%E6%A1%88\" aria-label=\"性能优化进阶方案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>性能优化进阶方案</h2>\n<p>除了上述分享的已经实践过的方案之外，我还找出了不少可值得尝试的优化方案，只是受项目基础架构和投入项目的工期资源限制，没有进一步的深挖改造：</p>\n<ul>\n<li>服务端渲染</li>\n<li>使用动态 polyfill</li>\n<li>提供 es module 版本部署</li>\n</ul>\n<h3 id=\"服务端渲染\" style=\"position:relative;\"><a href=\"#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93\" aria-label=\"服务端渲染 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>服务端渲染</h3>\n<p>SSR 服务端渲染也不是啥非常新的技术了，我们其他项目中也是有用到，性能评分在没怎么优化的情况下也有 71 分：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2UlEQVQ4y42S25KaQBCGfe08Th4gt7nMRbaiARVdNZt4AJLAgoAchmE4zcCfgbiKVZpKV301TU/Pz98Do3fvQzwmGqwR/t37l1HbtrjSoGneEH2tYR5EYqCVtW7/SnuXEc7RPdyN5JvkBf8bF4ddhGEIy7IlFmzb7nNjt4ap7+A4LtI07SESzsXFyI3DoaBpmlBVFYvFol9VRYE6nUHp8nO9Y7lcglJ6d7IbQcMwMB6P+wNzTcOP7bavdez3exwOhz73fR9VVd13OHyL53nYnkV0ebgTOLoO4iRGHMcghPR07oQQb7d/3+ENckPUNYo8R5lnKGSeF/lABGhkX81bcNFCNA/uMJFOojhCWZVgLAOhJRLKEZEKWVGjEVyOWveu/ITjo8bwQWGY6cVl/JuRw4jAtY8gYSKFKYKYIEwSBH6APM1RpxkqUoPL3pJznBKGkOSgrLwKDh3mFcPG20J73eBozcF/bcBtC8fshLX3HSt/jx1zQLwXZFEEJ6LwTiFYUTwQLFPMnGdMXjX8PHwGXX+V/5IBN3XxZE2h/lYxNxVQYw53t8V0swPNmLyi+oEgz6EFG0yCFUx7gnL9hEbX4RcnfAmecbAVCP0T+EpFJr9+SFIpxlEMBP8A1KDRsFR6ixoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dd48d01a.png\"\n        title=\"dd48d01a.png\"\n        src=\"/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/00d43/dd48d01a.png\"\n        srcset=\"/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/63868/dd48d01a.png 250w,\n/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/0b533/dd48d01a.png 500w,\n/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/00d43/dd48d01a.png 1000w,\n/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/aa440/dd48d01a.png 1500w,\n/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/e8950/dd48d01a.png 2000w,\n/static/a6b7066a2007ea0b9c8f5ea0a5edd0c3/809bc/dd48d01a.png 2612w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>类似功能的页面，但使用了 CSR 客户端渲染的页面，分数都不太理想（这也是这次技改立项的原因）。究其原因，还是因为 SSR 在首屏展示的时候已经是渲染好了的，直接就是一堆 HTML，浏览器解析起来没有啥压力。这对于 SEO 有很大好处。</p>\n<p>相比于 CSR 把渲染的压力给了客户端，SSR 多少也占用了服务器的资源，所以对于不同的项目，充分利用好两者的优势，将效益最大化。</p>\n<h3 id=\"使用动态-polyfill\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81-polyfill\" aria-label=\"使用动态 polyfill permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用动态 polyfill</h3>\n<p>动态 polyfill 的解决初衷是为了减少不必要的特性补丁资源，我们知道，使用 Babel 的一大好处就是可以将最新的 ES6+ API 无缝转换成全平台受用的代码，比如旧的浏览器不支持 Map、Set 等 API。但这就带来一个问题，最新版本的浏览器其实不太需要这个补丁，因为它本身就支持新的特性，但我们的项目构建都是同一份，这就带来性能的浪费。</p>\n<p>动态 polyfill 的原理是根据请求判断浏览器的版本，然后出不同的 polyfill 资源，新的浏览器少一些，旧的浏览器肯定要多一些，项目中的代码就无须打补丁这一步，全部交给动态 polyfill。</p>\n<p>我们项目中之所以没有这么搞，是因为公司团队提供的 polyfill 还有一些问题，出于稳定考量，就先不趟坑了。</p>\n<h3 id=\"提供-es-module-版本部署\" style=\"position:relative;\"><a href=\"#%E6%8F%90%E4%BE%9B-es-module-%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2\" aria-label=\"提供 es module 版本部署 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>提供 es module 版本部署</h3>\n<p>上述的动态 polyfill 是一个思路，另一种是更激进的方案，直接在有条件的浏览器上部署 ES6+ 的代码，这比转换成 ES5+ 代码能减少大量资源。</p>\n<p>最新的 Chrome 浏览器已经支持 <code>&#x3C;script type=\"module\"></code>，但具体实践上我还没想过怎么操作，因为我们所有的静态资源都在 CDN 上，如果按这个思路的话，我们需要针对不同层次的浏览器构建多份资源，再去.....想想就觉得有点刺激，未来值得研究一下。</p>\n<h2 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<p>前端性能优化一直是一个不断精进的课题，它随着项目的迭代以及结构、技术的升级，有着不同的实践关键点。有很多理论在前端领域中不断地被提出，但只有把理论落地实际，结合具体场景做具体的实践，才能真正深入理解其中的原理。</p>\n<p>另一方面，技术和标准也在不断地进化，比如最新发布的 Lighthouse V8 版本就将 CLS 比重从 V6/V7 的 5% 升到了 15%：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkUlEQVQoz11S25bbIAzM//9i+5DtZm13Y+7YXARMBY7TbHQOBgtpNBpxwYu11tCOA6JVuN1umKYJ8zw/1+ftE8uyjNhnzuPc7YK3i3HJqxBBSol1XaGkgjEGUkjIu8S+7T9IvNplcHpzvgYTFdRax38pBZTpeT79/4kMhmNHzAkxRqTEewjYI42EFMPwnQBSO9x1gLVu+N8JXE5yfnOjRakUvLNwW4awGWYjeL+Nu252b/haI4M/GDJA7sVQHxo+bPceqxDQrFXlAL8TZkm4mwLrPCz7qTQuUrDqzpiQc0ZkPRe5YFIGjTEvRA0pN/jooJhdZyilgNAejkGJhxPDzkPR2FPFJAo+/kYGozE4rw3M8htaqBF7tMyftNnBrrfmrAVxtV8z4YsBpDrk6KE2NC6UOaWicMt6S9DrHwR1Pad8WGDdesv9mXSGbou4fndAwnV20FrBuYRkDQIXTr2ot6j7hlbS0LMNwOMlIwXWiYP6cgyujMei69CqcoJljRsDwPDgpm9EsaJogSrvrF07x4x/zQsKe6/CbqkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"a82bcc26.png\"\n        title=\"a82bcc26.png\"\n        src=\"/static/fdf73511ed716d3ea2500703d4331305/00d43/a82bcc26.png\"\n        srcset=\"/static/fdf73511ed716d3ea2500703d4331305/63868/a82bcc26.png 250w,\n/static/fdf73511ed716d3ea2500703d4331305/0b533/a82bcc26.png 500w,\n/static/fdf73511ed716d3ea2500703d4331305/00d43/a82bcc26.png 1000w,\n/static/fdf73511ed716d3ea2500703d4331305/aa440/a82bcc26.png 1500w,\n/static/fdf73511ed716d3ea2500703d4331305/e8950/a82bcc26.png 2000w,\n/static/fdf73511ed716d3ea2500703d4331305/c27e7/a82bcc26.png 2144w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQoz2WSjW7qMAyFef9XvBJMsA0hmqT5aZrEbs9OyrjrhiXLUhV/Pj7uAYx1Xf9nD50izm9vOJ5OuFwuOLGez2ccj0cMw4Bnz74+47D/sIeKCFprW6oqWmlY5Vfvi5BeD39B+6nS6gZ+DkgpodaKnPMv2AtQFoHzI/zo4XtNM1MwzRXTNCHG2J9jpsqbLYQWLMvyHL/lg/kNXLiSNQP9MZjnjFIFn6bhagUhRA7xW2vIC4zn6qtuigMVDylDZflRGGNCLpkKLYyxcJbVEZK6f481Q/BQ9nwaocJKAYJKte7+AXP9R3/zD7A2hdL46B2cG5kOwu7LoHg3SmDESCv6RqIr0iyEK0opCJb23AjM7s9R+MC7h0JLhWnK+CDsahWjD5vClJWAgBICWgwAD9Y3ENq1P+Q3kAdIAX39xAN03+5e0dU3HqB7hTZjfL/BXu9Y3AC1w8tf0esX9QS9teVv0kwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"72380826.png\"\n        title=\"72380826.png\"\n        src=\"/static/bde4996fbf6e5c98d7a9c5b97279aa0d/00d43/72380826.png\"\n        srcset=\"/static/bde4996fbf6e5c98d7a9c5b97279aa0d/63868/72380826.png 250w,\n/static/bde4996fbf6e5c98d7a9c5b97279aa0d/0b533/72380826.png 500w,\n/static/bde4996fbf6e5c98d7a9c5b97279aa0d/00d43/72380826.png 1000w,\n/static/bde4996fbf6e5c98d7a9c5b97279aa0d/aa440/72380826.png 1500w,\n/static/bde4996fbf6e5c98d7a9c5b97279aa0d/e8950/72380826.png 2000w,\n/static/bde4996fbf6e5c98d7a9c5b97279aa0d/f5aa5/72380826.png 2312w\"\n        sizes=\"(max-width: 1000px) 100vw, 1000px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>那么实践的侧重点也要随着标准的发展而做出调整，结合具体的场景业务，调整不同的模块。这样才能高效地做好性能优化这一重点课题。</p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://web.dev/long-tasks-devtools/#what-is-causing-my-long-tasks\">Are long JavaScript tasks delaying your Time to Interactive?</a></li>\n<li><a href=\"https://web.dev/fcp/\">First Contentful Paint (FCP)</a></li>\n<li><a href=\"https://web.dev/lcp/\">Largest Contentful Paint (LCP)</a></li>\n<li><a href=\"https://web.dev/fid/\">First Input Delay (FID)</a></li>\n<li><a href=\"https://web.dev/tti/\">Time to Interactive (TTI)</a></li>\n<li><a href=\"https://web.dev/tbt/\">Total Blocking Time (TBT)</a></li>\n<li><a href=\"https://web.dev/cls/\">Cumulative Layout Shift (CLS)</a></li>\n</ul>","frontmatter":{"title":"前端页面性能优化实践-SEO性能优化","category":"EnginnExpe","tags":"practice","date":"2021-07-01","uninqueid":"cfa0b1e49db05c37b776d25900dc8025"}}},"pageContext":{"uninqueid":"cfa0b1e49db05c37b776d25900dc8025"}},"staticQueryHashes":["3649515864"]}